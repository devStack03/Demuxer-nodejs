{"version":3,"file":"demuxer.ts.esm.js","sources":["../src/enum/events.ts","../src/util/event-emitter.ts","../src/types/globals.ts","../src/util/is.ts","../src/util/cache-buffer.ts","../src/util/multi-map.ts","../src/util/event-manager.ts","../src/util/global.ts","../src/util/logger.ts","../src/util/stream.ts","../src/demux-facade.ts","../src/mux-error-code.ts","../src/m2t/structs/patSection.ts","../src/m2t/structs/pmtSection.ts","../src/enum/m2t-pid.ts","../src/m2t/psi.ts","../src/m2t/streams/complex.js","../src/codec/aac/aac-config.ts","../src/codec/aac/aac.ts","../src/codec/adts.ts","../src/m2t/streams/adts.ts","../src/util/dv.ts","../src/codec/avc/ep3b.ts","../src/util/exp-golumb.ts","../src/codec/avc/sps.ts","../src/codec/avc/pps.ts","../src/codec/avc/sei.ts","../src/codec/avc/nalu.ts","../src/codec/avc.ts","../src/codec/avc/avc-config.ts","../src/m2t/streams/avc.ts","../src/m2t/streams/elementary.ts","../src/m2t/structs/pes.ts","../src/m2t/streams/pes.ts","../src/m2t/structs/packet.ts","../src/m2t/demux.ts"],"sourcesContent":["/**\r\n * @file= events.js, created at Monday, 23rd December 2019 3=47=23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\nexport enum Events {\r\n    ERROR = 'ERROR',\r\n    INFO = 'INFO',\r\n    DATA = 'DATA',\r\n    DEMUX_DATA = 'DEMUX_DATA',\r\n    DONE = 'DONE'\r\n}\r\n","/**\r\n * @copyright https://github.com/nodejs/node/blob/master/lib/events.js\r\n */\r\n/* eslint-disable */\r\n// Copyright Joyent, Inc. and other Node contributors.\r\n//\r\n// Permission is hereby granted, free of charge, to any person obtaining a\r\n// copy of this software and associated documentation files (the\r\n// \"Software\"), to deal in the Software without restriction, including\r\n// without limitation the rights to use, copy, modify, merge, publish,\r\n// distribute, sublicense, and/or sell copies of the Software, and to permit\r\n// persons to whom the Software is furnished to do so, subject to the\r\n// following conditions:\r\n//\r\n// The above copyright notice and this permission notice shall be included\r\n// in all copies or substantial portions of the Software.\r\n//\r\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\r\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\r\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\r\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\r\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\r\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\r\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\r\n\r\nvar objectCreate = Object.create || objectCreatePolyfill;\r\nvar objectKeys = Object.keys || objectKeysPolyfill;\r\nvar bind = Function.prototype.bind || functionBindPolyfill;\r\n\r\n// By default Dispatchers will print a warning if more than 10 listeners are\r\n// added to it. This is a useful default which helps finding memory leaks.\r\nlet defaultMaxListeners = 10;\r\n\r\nexport default class EventEmitter {\r\n    static listenerCount(emitter, type) {\r\n        if (typeof emitter.listenerCount === 'function') {\r\n            return emitter.listenerCount(type);\r\n        } else {\r\n            return listenerCount.call(emitter, type);\r\n        }\r\n    }\r\n\r\n    static defaultMaxListeners: number;\r\n\r\n    _maxListeners?: number;\r\n    _eventsCount: number;\r\n    _events: any;\r\n\r\n    constructor() {\r\n        if (!this._events || !Object.prototype.hasOwnProperty.call(this, '_events')) {\r\n            this._events = objectCreate(null);\r\n            this._eventsCount = 0;\r\n        }\r\n\r\n        this._maxListeners = this._maxListeners || undefined;\r\n    }\r\n\r\n    // // Obviously not all Emitters should be limited to 10. This function allows\r\n    // // that to be increased. Set to zero for unlimited.\r\n    // setMaxListeners(n) {\r\n    //     if (typeof n !== 'number' || n < 0 || isNaN(n))\r\n    //         throw new TypeError('\"n\" argument must be a positive number');\r\n    //     this._maxListeners = n;\r\n    //     return this;\r\n    // }\r\n    //\r\n    // getMaxListeners() {\r\n    //     return $getMaxListeners(this);\r\n    // }\r\n\r\n    emit(type: string, ...rest) {\r\n        var er, handler, len, args, i, events;\r\n        var doError = type === 'error';\r\n\r\n        events = this._events;\r\n        if (events) doError = doError && events.error == null;\r\n        else if (!doError) return false;\r\n\r\n        // If there is no 'error' event listener then throw.\r\n        if (doError) {\r\n            if (arguments.length > 1) er = arguments[1];\r\n            if (er instanceof Error) {\r\n                throw er; // Unhandled 'error' event\r\n            } else {\r\n                // At least give some kind of context to the user\r\n                var err = new Error('Unhandled \"error\" event. (' + er + ')');\r\n                err['context'] = er;\r\n                throw err;\r\n            }\r\n        }\r\n\r\n        handler = events[type];\r\n\r\n        if (!handler) return false;\r\n\r\n        var isFn = typeof handler === 'function';\r\n        len = arguments.length;\r\n        switch (len) {\r\n            // fast cases\r\n            case 1:\r\n                emitNone(handler, isFn, this);\r\n                break;\r\n            case 2:\r\n                emitOne(handler, isFn, this, arguments[1]);\r\n                break;\r\n            case 3:\r\n                emitTwo(handler, isFn, this, arguments[1], arguments[2]);\r\n                break;\r\n            case 4:\r\n                emitThree(handler, isFn, this, arguments[1], arguments[2], arguments[3]);\r\n                break;\r\n            // slower\r\n            default:\r\n                args = new Array(len - 1);\r\n                for (i = 1; i < len; i++) args[i - 1] = arguments[i];\r\n                emitMany(handler, isFn, this, args);\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    on(type: string, listener: Function) {\r\n        return _addListener(this, type, listener);\r\n    }\r\n\r\n    once(type, listener) {\r\n        if (typeof listener !== 'function') throw new TypeError('\"listener\" argument must be a function');\r\n        this.on(type, _onceWrap(this, type, listener));\r\n        return this;\r\n    }\r\n\r\n    off(type, listener) {\r\n        return _removeListener.call(this, type, listener);\r\n    }\r\n\r\n    removeAllListeners(type) {\r\n        var listeners, events, i;\r\n\r\n        events = this._events;\r\n        if (!events) return this;\r\n\r\n        // not listening for off, no need to emit\r\n        if (!events.off) {\r\n            if (arguments.length === 0) {\r\n                this._events = objectCreate(null);\r\n                this._eventsCount = 0;\r\n            } else if (events[type]) {\r\n                if (--this._eventsCount === 0) this._events = objectCreate(null);\r\n                else delete events[type];\r\n            }\r\n            return this;\r\n        }\r\n\r\n        // emit off for all listeners on all events\r\n        if (arguments.length === 0) {\r\n            var keys = objectKeys(events);\r\n            var key;\r\n            for (i = 0; i < keys.length; ++i) {\r\n                key = keys[i];\r\n                if (key === 'off') continue;\r\n                this.removeAllListeners(key);\r\n            }\r\n            this.removeAllListeners('off');\r\n            this._events = objectCreate(null);\r\n            this._eventsCount = 0;\r\n            return this;\r\n        }\r\n\r\n        listeners = events[type];\r\n\r\n        if (typeof listeners === 'function') {\r\n            this.off(type, listeners);\r\n        } else if (listeners) {\r\n            // LIFO order\r\n            for (i = listeners.length - 1; i >= 0; i--) {\r\n                this.off(type, listeners[i]);\r\n            }\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    listeners(type) {\r\n        return _listeners(this, type, true);\r\n    }\r\n\r\n    rawListeners(type) {\r\n        return _listeners(this, type, false);\r\n    }\r\n\r\n    listenerCount() {\r\n        return EventEmitter.listenerCount.apply(this, arguments);\r\n    }\r\n}\r\n\r\nlet hasDefineProperty;\r\ntry {\r\n    var o = {};\r\n    if (Object.defineProperty) Object.defineProperty(o, 'x', { value: 0 });\r\n    hasDefineProperty = o['x'] === 0;\r\n} catch (err) {\r\n    hasDefineProperty = false;\r\n}\r\nif (hasDefineProperty) {\r\n    Object.defineProperty(EventEmitter, 'defaultMaxListeners', {\r\n        enumerable: true,\r\n        get: function () {\r\n            return defaultMaxListeners;\r\n        },\r\n        set: function (arg) {\r\n            // check whether the input is a positive number (whose value is zero or\r\n            // greater and not a NaN).\r\n            if (typeof arg !== 'number' || arg < 0 || arg !== arg)\r\n                throw new TypeError('\"defaultMaxListeners\" must be a positive number');\r\n            defaultMaxListeners = arg;\r\n        }\r\n    });\r\n} else {\r\n    EventEmitter.defaultMaxListeners = defaultMaxListeners;\r\n}\r\n\r\nfunction $getMaxListeners(that) {\r\n    if (that._maxListeners === undefined) return EventEmitter.defaultMaxListeners;\r\n    return that._maxListeners;\r\n}\r\n\r\n// These standalone emit* functions are used to optimize calling of event\r\n// handlers for fast cases because emit() itself often has a variable number of\r\n// arguments and can be deoptimized because of that. These functions always have\r\n// the same number of arguments and thus do not get deoptimized, so the code\r\n// inside them can execute faster.\r\nfunction emitNone(handler, isFn, self) {\r\n    if (isFn) handler.call(self);\r\n    else {\r\n        var len = handler.length;\r\n        var listeners = arrayClone(handler, len);\r\n        for (var i = 0; i < len; ++i) {\r\n            try {\r\n                listeners[i].call(self);\r\n            } catch (e) {\r\n                console.error(e);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction emitOne(handler, isFn, self, arg1) {\r\n    if (isFn) handler.call(self, arg1);\r\n    else {\r\n        var len = handler.length;\r\n        var listeners = arrayClone(handler, len);\r\n        for (var i = 0; i < len; ++i) {\r\n            try {\r\n                listeners[i].call(self, arg1);\r\n            } catch (e) {\r\n                console.error(e);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction emitTwo(handler, isFn, self, arg1, arg2) {\r\n    if (isFn) handler.call(self, arg1, arg2);\r\n    else {\r\n        var len = handler.length;\r\n        var listeners = arrayClone(handler, len);\r\n        for (var i = 0; i < len; ++i) {\r\n            try {\r\n                listeners[i].call(self, arg1, arg2);\r\n            } catch (e) {\r\n                console.error(e);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction emitThree(handler, isFn, self, arg1, arg2, arg3) {\r\n    if (isFn) handler.call(self, arg1, arg2, arg3);\r\n    else {\r\n        var len = handler.length;\r\n        var listeners = arrayClone(handler, len);\r\n        for (var i = 0; i < len; ++i) {\r\n            try {\r\n                listeners[i].call(self, arg1, arg2, arg3);\r\n            } catch (e) {\r\n                console.error(e);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction emitMany(handler, isFn, self, args) {\r\n    if (isFn) handler.apply(self, args);\r\n    else {\r\n        var len = handler.length;\r\n        var listeners = arrayClone(handler, len);\r\n        for (var i = 0; i < len; ++i) {\r\n            try {\r\n                listeners[i].apply(self, args);\r\n            } catch (e) {\r\n                console.error(e);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction _addListener(target: EventEmitter, type, listener: Function) {\r\n    var m;\r\n    var events;\r\n    var existing;\r\n\r\n    if (typeof listener !== 'function') throw new TypeError('\"listener\" argument must be a function');\r\n\r\n    events = target._events;\r\n    if (!events) {\r\n        events = target._events = objectCreate(null);\r\n        target._eventsCount = 0;\r\n    } else {\r\n        // To avoid recursion in the case that type === \"newListener\"! Before\r\n        // adding it to the listeners, first emit \"newListener\".\r\n        if (events.newListener) {\r\n            target.emit('newListener', type, listener['listener'] ? listener['listener'] : listener);\r\n\r\n            // Re-assign `events` because a newListener handler could have caused the\r\n            // this._events to be assigned to a new object\r\n            events = target._events;\r\n        }\r\n        existing = events[type];\r\n    }\r\n\r\n    if (!existing) {\r\n        // Optimize the case of one listener. Don't need the extra array object.\r\n        existing = events[type] = listener;\r\n        ++target._eventsCount;\r\n    } else {\r\n        if (typeof existing === 'function') {\r\n            // Adding the second element, need to change to array.\r\n            existing = events[type] = [existing, listener];\r\n        } else {\r\n            existing.push(listener);\r\n        }\r\n\r\n        // Check for listener leak\r\n        if (!existing.warned) {\r\n            m = $getMaxListeners(target);\r\n            if (m && m > 0 && existing.length > m) {\r\n                existing.warned = true;\r\n\r\n                class CustomError extends Error {\r\n                    emitter: any;\r\n                    type: string;\r\n                    count: number;\r\n                }\r\n                let w: CustomError = new CustomError(\r\n                    'Possible Dispatcher memory leak detected. ' +\r\n                        existing.length +\r\n                        ' \"' +\r\n                        String(type) +\r\n                        '\" listeners ' +\r\n                        'added. Use emitter.setMaxListeners() to ' +\r\n                        'increase limit.'\r\n                );\r\n                w.name = 'MaxListenersExceededWarning';\r\n                w.emitter = target;\r\n                w.type = type;\r\n                w.count = existing.length;\r\n\r\n                if (typeof console === 'object' && console.warn) {\r\n                    console.warn('%s: %s', w.name, w.message);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return target;\r\n}\r\n\r\nfunction _removeListener(type, listener) {\r\n    var list, events, position, i, originalListener;\r\n\r\n    if (typeof listener !== 'function') throw new TypeError('\"listener\" argument must be a function');\r\n\r\n    events = this._events;\r\n    if (!events) return this;\r\n\r\n    list = events[type];\r\n    if (!list) return this;\r\n\r\n    if (list === listener || list.listener === listener) {\r\n        if (--this._eventsCount === 0) this._events = objectCreate(null);\r\n        else {\r\n            delete events[type];\r\n            if (events.off) this.emit('off', type, list.listener || listener);\r\n        }\r\n    } else if (typeof list !== 'function') {\r\n        position = -1;\r\n\r\n        for (i = list.length - 1; i >= 0; i--) {\r\n            if (list[i] === listener || list[i].listener === listener) {\r\n                originalListener = list[i].listener;\r\n                position = i;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (position < 0) return this;\r\n\r\n        if (position === 0) list.shift();\r\n        else spliceOne(list, position);\r\n\r\n        if (list.length === 1) events[type] = list[0];\r\n\r\n        if (events.off) this.emit('off', type, originalListener || listener);\r\n    }\r\n\r\n    return this;\r\n}\r\n\r\nfunction onceWrapper() {\r\n    if (!this.fired) {\r\n        this.target.off(this.type, this.wrapFn);\r\n        this.fired = true;\r\n        switch (arguments.length) {\r\n            case 0:\r\n                return this.listener.call(this.target);\r\n            case 1:\r\n                return this.listener.call(this.target, arguments[0]);\r\n            case 2:\r\n                return this.listener.call(this.target, arguments[0], arguments[1]);\r\n            case 3:\r\n                return this.listener.call(this.target, arguments[0], arguments[1], arguments[2]);\r\n            default:\r\n                var args = new Array(arguments.length);\r\n                for (var i = 0; i < args.length; ++i) args[i] = arguments[i];\r\n                this.listener.apply(this.target, args);\r\n        }\r\n    }\r\n}\r\n\r\nfunction _onceWrap(target, type, listener) {\r\n    var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\r\n    var wrapped = bind.call(onceWrapper, state);\r\n    wrapped.listener = listener;\r\n    state.wrapFn = wrapped;\r\n    return wrapped;\r\n}\r\n\r\nfunction _listeners(target, type, unwrap) {\r\n    var events = target._events;\r\n\r\n    if (!events) return [];\r\n\r\n    var evlistener = events[type];\r\n    if (!evlistener) return [];\r\n\r\n    if (typeof evlistener === 'function') return unwrap ? [evlistener.listener || evlistener] : [evlistener];\r\n\r\n    return unwrap ? unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\r\n}\r\n\r\nfunction listenerCount(type) {\r\n    var events = this._events;\r\n\r\n    if (events) {\r\n        var evlistener = events[type];\r\n\r\n        if (typeof evlistener === 'function') {\r\n            return 1;\r\n        } else if (evlistener) {\r\n            return evlistener.length;\r\n        }\r\n    }\r\n\r\n    return 0;\r\n}\r\n\r\n// About 1.5x faster than the two-arg version of Array#splice().\r\nfunction spliceOne(list, index) {\r\n    for (var i = index, k = i + 1, n = list.length; k < n; i += 1, k += 1) list[i] = list[k];\r\n    list.pop();\r\n}\r\n\r\nfunction arrayClone(arr, n) {\r\n    var copy = new Array(n);\r\n    for (var i = 0; i < n; ++i) copy[i] = arr[i];\r\n    return copy;\r\n}\r\n\r\nfunction unwrapListeners(arr) {\r\n    var ret = new Array(arr.length);\r\n    for (var i = 0; i < ret.length; ++i) {\r\n        ret[i] = arr[i].listener || arr[i];\r\n    }\r\n    return ret;\r\n}\r\n\r\nfunction objectCreatePolyfill(proto) {\r\n    var F = function () {};\r\n    F.prototype = proto;\r\n    return new F();\r\n}\r\n\r\nfunction objectKeysPolyfill(obj) {\r\n    var keys = [];\r\n    for (var k in obj)\r\n        if (Object.prototype.hasOwnProperty.call(obj, k)) {\r\n            keys.push(k);\r\n        }\r\n    return k;\r\n}\r\n\r\nfunction functionBindPolyfill(context) {\r\n    var fn = this;\r\n    return function () {\r\n        return fn.apply(context, arguments);\r\n    };\r\n}\r\n","import EventEmitter from '../util/event-emitter';\r\n\r\nexport class Context extends EventEmitter {}\r\n\r\nexport type PushConf = Partial<{\r\n    done: boolean;\r\n    stubTime: number;\r\n    offsetPos: number; // Represents the start byte of the pushed data relative to the entire file\r\n}>;\r\n\r\nexport type GlobalOptions = Partial<{\r\n    debug: boolean;\r\n    decodeCodec: boolean;\r\n    config: PushConf;\r\n}>;\r\n\r\nexport interface IDemux {\r\n    /**\r\n     * Pipe the arrayBuffer to the demuxer.\r\n     * @param buf\r\n     * @param conf\r\n     */\r\n    push(buf: ArrayBuffer | Uint8Array, conf: PushConf): void;\r\n\r\n    reset(): void;\r\n\r\n    destroy(): void;\r\n}\r\n","/**\r\n * @file: is.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\n/**\r\n * Used to resolve the\r\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\r\n * of values.\r\n */\r\nvar objectToString = Object.prototype.toString;\r\n\r\n/**\r\n * Checks if `value` is object-like. A value is object-like if it's not `null`\r\n * and has a `typeof` result of \"object\".\r\n *\r\n * @param {*} value The value to check.\r\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\r\n * @example\r\n *\r\n * _.isObjectLike({});\r\n * // => true\r\n *\r\n * _.isObjectLike([1, 2, 3]);\r\n * // => true\r\n *\r\n * _.isObjectLike(_.noop);\r\n * // => false\r\n *\r\n * _.isObjectLike(null);\r\n * // => false\r\n */\r\nexport function isObjectLike(value: any): boolean {\r\n    return !!value && typeof value == 'object';\r\n}\r\n\r\nexport function isEmptyObject(obj: object): boolean {\r\n    for (var prop in obj) {\r\n        if (Object.prototype.hasOwnProperty.call(obj, prop)) {\r\n            return false;\r\n        }\r\n    }\r\n    return JSON.stringify(obj) === JSON.stringify({});\r\n}\r\n\r\n/**\r\n * @param url\r\n */\r\nexport function isHttps(url?: string): boolean {\r\n    return /^https/gi.test(url || window.location.protocol);\r\n}\r\n\r\n/**\r\n * @param num\r\n */\r\nexport function isNumber(num: any): boolean {\r\n    return typeof num === 'number' && !isNaN(num);\r\n}\r\n\r\n/**\r\n * @param value\r\n */\r\nexport function isArrayBuffer(value: any): boolean {\r\n    return isObjectLike(value) && objectToString.call(value).toLowerCase() === '[object arraybuffer]';\r\n}\r\n\r\n/**\r\n * @param value\r\n */\r\nexport function isUint8Array(value: any): boolean {\r\n    return isObjectLike(value) && objectToString.call(value).toLowerCase() === '[object uint8array]';\r\n}\r\n","/**\r\n * @file: cache-buffer.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\nimport { isNumber } from './is';\r\n\r\n/**\r\n * Cache Buffer util.\r\n * It's applicable for streaming data cutting and retaining the data,\r\n * the algorithm minimizes memory application as much as possible.\r\n */\r\n\r\nexport default class CacheBuffer {\r\n    get byteLength(): number {\r\n        if (!isNumber(this.byteLength_)) {\r\n            let len = 0;\r\n\r\n            for (let i = 0, item: Uint8Array; i < this.list_.length; i++) {\r\n                item = this.list_[i];\r\n                len += item.byteLength;\r\n            }\r\n            this.byteLength_ = len;\r\n        }\r\n\r\n        return this.byteLength_;\r\n    }\r\n\r\n    /**\r\n     * maybe return new allocated memory or original memory\r\n     */\r\n    get bytes(): Uint8Array | null {\r\n        const { bufferList } = this;\r\n        let bytes = null;\r\n\r\n        if (bufferList.length > 0) {\r\n            if (bufferList.length === 0) {\r\n                bytes = bufferList[0];\r\n            } else {\r\n                bytes = this.toNewBytes();\r\n            }\r\n        }\r\n\r\n        return bytes;\r\n    }\r\n\r\n    get empty() {\r\n        return this.list_.length === 0;\r\n    }\r\n\r\n    get bufferList() {\r\n        return this.list_;\r\n    }\r\n\r\n    /**\r\n     * Used to cache calculations, reduce the number of CPU calculations.\r\n     * When internal data changes, the value needs to be cleared and recalculated.\r\n     */\r\n    private byteLength_: number | null;\r\n\r\n    private list_: Array<Uint8Array> = [];\r\n\r\n    clear() {\r\n        let len = this.list_.length;\r\n        if (len > 0) {\r\n            this.list_.splice(0, len);\r\n        }\r\n        this.byteLength_ = null;\r\n    }\r\n\r\n    toNewBytes(): Uint8Array | null {\r\n        let bytes = null;\r\n        let tryCount: number = 0;\r\n        let maxTryCount: number = 50;\r\n\r\n        // The following retry strategies are provided for failed memory applications\r\n        // In terms of a better strategy, a failed memory application retry should be\r\n        // an asynchronous process, which does not return until the application succeeds.\r\n        // But the original design of the library is synchronous.\r\n        while (bytes === null) {\r\n            try {\r\n                tryCount++;\r\n                bytes = new Uint8Array(this.byteLength);\r\n            } catch (e) {\r\n                if (tryCount > maxTryCount) {\r\n                    throw e;\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let i = 0, offset = 0; i < this.list_.length; i++) {\r\n            let payload = this.list_[i];\r\n\r\n            bytes.set(payload, offset);\r\n            offset += payload.byteLength;\r\n        }\r\n\r\n        return bytes;\r\n    }\r\n\r\n    append(newBuffer: Uint8Array | CacheBuffer): void {\r\n        if (newBuffer instanceof CacheBuffer) {\r\n            this.list_ = this.list_.concat(newBuffer.bufferList);\r\n        } else {\r\n            this.list_.push(newBuffer);\r\n        }\r\n\r\n        this.byteLength_ = null;\r\n    }\r\n\r\n    /**\r\n     * This function cuts a complete TypedArray from CacheBuffer and retains the remainder of CacheBuffer.\r\n     * The following points should be noted when using this function:\r\n     * 1. If the cut needs to return the cut-out part, the cut length should be as small as possible to reduce the errors in memory application.\r\n     * 2. If the cutting is only to preserve the remaining parts, the cutting size is within the total number of bytes, without considering memory applications.\r\n     * @param {number} fixedLength\r\n     * @param {boolean} [needCutResult] - If not, just retain the remaining parts after cutting.\r\n     */\r\n    cut(fixedLength: number, needCutResult: boolean = true): Uint8Array {\r\n        let chunk = null;\r\n\r\n        if (fixedLength > 0 && !this.empty) {\r\n            let list = this.list_;\r\n\r\n            let offset = 0;\r\n            let loopIndex = 0;\r\n\r\n            while (list.length > 0) {\r\n                let cur = list.shift();\r\n\r\n                if (loopIndex === 0) {\r\n                    if (cur.byteLength >= fixedLength) {\r\n                        if (needCutResult) {\r\n                            // Here is the key point for optimize memory alloc\r\n                            chunk = cur.subarray(0, fixedLength);\r\n                        }\r\n\r\n                        if (cur.byteLength > fixedLength) {\r\n                            cur = cur.subarray(fixedLength);\r\n                            list.unshift(cur);\r\n                        }\r\n                        break;\r\n                    } else {\r\n                        if (needCutResult) {\r\n                            try {\r\n                                chunk = new Uint8Array(fixedLength);\r\n                            } catch (e) {\r\n                                throw `alloc_memory_error@ cache buffer: ${fixedLength} ${e.message}`;\r\n                            }\r\n\r\n                            chunk.set(cur, 0);\r\n                        }\r\n                        offset += cur.byteLength;\r\n                    }\r\n                } else {\r\n                    let subLen = fixedLength - offset;\r\n\r\n                    if (cur.byteLength >= subLen) {\r\n                        if (needCutResult) {\r\n                            chunk.set(cur.subarray(0, subLen), offset);\r\n                        }\r\n\r\n                        cur = cur.subarray(subLen);\r\n\r\n                        if (cur.byteLength > 0) {\r\n                            list.unshift(cur);\r\n                        }\r\n\r\n                        break;\r\n                    } else {\r\n                        if (needCutResult) {\r\n                            chunk.set(cur, offset);\r\n                        }\r\n                        offset += cur.byteLength;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                loopIndex++;\r\n            }\r\n\r\n            this.byteLength_ = null;\r\n        }\r\n\r\n        return chunk;\r\n    }\r\n}\r\n","/**\r\n * @fileOverview A simple multimap template.\r\n */\r\n\r\ninterface MapData {\r\n    [index: string]: Array<any>;\r\n}\r\n\r\nexport default class MultiMap {\r\n    private map_: MapData;\r\n\r\n    constructor() {\r\n        this.map_ = {};\r\n    }\r\n\r\n    /**\r\n     * Add a key, value pair to the map.\r\n     * @param key\r\n     * @param value\r\n     */\r\n    push(key: string, value: any) {\r\n        if (Object.prototype.hasOwnProperty.call(this.map_, key)) {\r\n            this.map_[key].push(value);\r\n        } else {\r\n            this.map_[key] = [value];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get a list of values by key.\r\n     * @param key\r\n     */\r\n    get(key: string): Array<any> {\r\n        let list = this.map_[key];\r\n        // slice() clones the list so that it and the map can each be modified\r\n        // without affecting the other.\r\n        return list ? list.slice() : null;\r\n    }\r\n\r\n    /**\r\n     * Get a list of all values.\r\n     */\r\n    getAll(): Array<any> {\r\n        let list = [];\r\n        for (let key in this.map_) {\r\n            list.push.apply(list, this.map_[key]);\r\n        }\r\n        return list;\r\n    }\r\n\r\n    /**\r\n     * Remove a specific value, if it exists.\r\n     * @param key\r\n     * @param value\r\n     */\r\n    remove(key: string, value: any): void {\r\n        let list = this.map_[key];\r\n        if (list) {\r\n            for (let i = 0; i < list.length; ++i) {\r\n                if (list[i] == value) {\r\n                    list.splice(i, 1);\r\n                    --i;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear all keys and values from the multimap.\r\n     */\r\n    clear(): void {\r\n        this.map_ = {};\r\n    }\r\n\r\n    /**\r\n     * @param callback\r\n     */\r\n    forEach(callback: Function): void {\r\n        for (let key in this.map_) {\r\n            callback(key, this.map_[key]);\r\n        }\r\n    }\r\n}\r\n","import MultiMap from './multi-map';\r\n\r\n/**\r\n * Creates a new Binding_ and attaches the event listener to the event target.\r\n */\r\nclass Binding_ {\r\n    target: any;\r\n    type: string;\r\n    listener: Function;\r\n\r\n    /**\r\n     * @param target - The event target.\r\n     * @param type - The event type.\r\n     * @param listener - The event listener.\r\n     */\r\n    constructor(target: any, type: string, listener: Function) {\r\n        this.target = target;\r\n        this.type = type;\r\n        this.listener = listener;\r\n\r\n        if (this.target.addEventListener) {\r\n            this.target.addEventListener(type, listener, false);\r\n        } else if (this.target.on) {\r\n            this.target.on(type, listener, false);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Detaches the event listener from the event target.\r\n     * This does nothing if the event listener is already detached.\r\n     */\r\n    off() {\r\n        if (this.target.removeEventListener) {\r\n            this.target.removeEventListener(this.type, this.listener, false);\r\n        } else if (this.target.off) {\r\n            this.target.off(this.type, this.listener, false);\r\n        }\r\n\r\n        this.target = null;\r\n        this.listener = null;\r\n    }\r\n}\r\n\r\n/**\r\n * Creates a new EventManager.\r\n * An EventManager maintains a collection of \"event bindings\" between event targets and event listeners.\r\n */\r\nexport default class EventManager {\r\n    private bindingMap_: MultiMap;\r\n    // static Binding_: Binding;\r\n\r\n    constructor() {\r\n        /**\r\n         * Maps an event type to an array of event bindings.\r\n         */\r\n        this.bindingMap_ = new MultiMap();\r\n    }\r\n\r\n    /**\r\n     * Detaches all event listeners.\r\n     * @override\r\n     */\r\n    destroy(): void {\r\n        this.removeAll();\r\n        this.bindingMap_ = null;\r\n    }\r\n\r\n    /**\r\n     * Attaches an event listener to an event target.\r\n     * @param target - The event target.\r\n     * @param type  - The event type.\r\n     * @param listener  - The event listener.\r\n     */\r\n    on(target: any, type: string, listener: Function): EventManager {\r\n        if (!this.bindingMap_) return;\r\n\r\n        let binding = new Binding_(target, type, listener);\r\n        this.bindingMap_.push(type, binding);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Attaches an event listener to an event target.\r\n     * The listener will be removed when the first instance of the event is fired.\r\n     * @param {EventTarget} target The event target.\r\n     * @param {string} type The event type.\r\n     * @param {function} listener The event listener.\r\n     */\r\n    once(target: any, type: string, listener: Function) {\r\n        // Install a shim listener that will stop listening after the first event.\r\n        this.on(\r\n            target,\r\n            type,\r\n            function (event: any) {\r\n                // Stop listening to this event.\r\n                this.off(target, type);\r\n                // Call the original listener.\r\n                listener(event);\r\n            }.bind(this)\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Detaches an event listener from an event target.\r\n     * @param {EventTarget} target The event target.\r\n     * @param {string} type The event type.\r\n     */\r\n    off(target: any, type: string): void {\r\n        if (!this.bindingMap_) return;\r\n\r\n        let list = this.bindingMap_.get(type) || [];\r\n\r\n        for (let i = 0; i < list.length; ++i) {\r\n            let binding = list[i];\r\n\r\n            if (binding.target == target) {\r\n                binding.off();\r\n                this.bindingMap_.remove(type, binding);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Detaches all event listeners from all targets.\r\n     */\r\n    removeAll(): void {\r\n        if (!this.bindingMap_) return;\r\n\r\n        let list = this.bindingMap_.getAll();\r\n\r\n        for (let i = 0; i < list.length; ++i) {\r\n            list[i].off();\r\n        }\r\n\r\n        this.bindingMap_.clear();\r\n    }\r\n}\r\n\r\n// EventManager.Binding_ = Binding;\r\n","/**\r\n * @file: global.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\n/**\r\n * @description provide global scope.\r\n */\r\nlet global: any;\r\n\r\n// see https://stackoverflow.com/a/11237259/589493\r\nif (typeof window === 'undefined') {\r\n    /* eslint-disable-next-line no-undef */\r\n    global = self;\r\n} else {\r\n    global = window;\r\n}\r\n\r\nexport default global;\r\n","/**\r\n * @file: logger.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\n/**\r\n * utils - logger\r\n */\r\n/* global WorkerGlobalScope */\r\nimport global from './global';\r\nimport EventEmitter from './event-emitter';\r\n\r\nlet console = global.console;\r\nconst isWorker =\r\n    typeof WorkerGlobalScope !== 'undefined' &&\r\n    self instanceof WorkerGlobalScope &&\r\n    typeof importScripts != 'undefined';\r\nconst prefix = '>>>';\r\n\r\nclass Logger extends EventEmitter {\r\n    private MSG_NAME: string;\r\n    private _enable: boolean;\r\n\r\n    get enable() {\r\n        return this._enable;\r\n    }\r\n\r\n    set enable(value: boolean) {\r\n        this._enable = value;\r\n\r\n        this.MSG_NAME = '__log__';\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n        this._enable = false;\r\n    }\r\n\r\n    log(...restArgs: any) {\r\n        if (isWorker) {\r\n            logger.emit(this.MSG_NAME, 'log', [...restArgs].join(''));\r\n        } else {\r\n            if (this._enable) {\r\n                console.log.call(console, prefix, ...restArgs);\r\n            }\r\n        }\r\n    }\r\n\r\n    debug(...restArgs: any) {\r\n        if (isWorker) {\r\n            logger.emit(this.MSG_NAME, 'debug', [...restArgs].join(''));\r\n        } else {\r\n            if (this._enable && console.debug) {\r\n                console.debug.call(console, prefix, ...restArgs);\r\n            }\r\n        }\r\n    }\r\n\r\n    assert(...restArgs: any) {\r\n        if (this._enable && console.assert) {\r\n            let condition = restArgs[0];\r\n            let sliceArgs = Array.prototype.slice.call(restArgs, 1);\r\n            sliceArgs.unshift(prefix);\r\n\r\n            console.assert.call(console, condition, ...sliceArgs);\r\n        }\r\n    }\r\n\r\n    warn(...restArgs: any) {\r\n        if (isWorker) {\r\n            logger.emit(this.MSG_NAME, 'warn', [...restArgs].join(''));\r\n        } else {\r\n            if (this._enable) {\r\n                console.warn.call(console, prefix, ...restArgs);\r\n            }\r\n        }\r\n    }\r\n\r\n    error(...restArgs: any) {\r\n        if (isWorker) {\r\n            logger.emit(this.MSG_NAME, 'error', [...restArgs].join(''));\r\n        } else {\r\n            if (this._enable) {\r\n                console.error.call(console, prefix, ...restArgs);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nlet logger = new Logger();\r\n\r\n/**\r\n * @param {Object} obj - custom logger\r\n */\r\nexport function setLogger(obj) {\r\n    console = obj;\r\n}\r\n\r\nexport function getLogger() {\r\n    return logger;\r\n}\r\n\r\nexport default logger;\r\n","/**\r\n * @file: stream.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\n/**\r\n * simple stream implementation.\r\n */\r\n\r\nimport { PushConf } from '../types/globals';\r\nimport EventEmitter from './event-emitter';\r\n\r\nclass Stream extends EventEmitter {\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    /**\r\n     * connect to the next pipeline stream.\r\n     * @param destination\r\n     */\r\n    pipe(destination: Stream): Stream {\r\n        this.on('reset', function () {\r\n            destination.reset();\r\n        });\r\n\r\n        this.on('data', function (data) {\r\n            destination.push(data);\r\n        });\r\n\r\n        this.on('done', function (flushSource) {\r\n            destination.flush(flushSource);\r\n        });\r\n\r\n        return destination;\r\n    }\r\n\r\n    /**\r\n     * detaches the next pipeline stream previously attached.\r\n     */\r\n    unpipe(): Stream {\r\n        this.removeAllListeners('reset');\r\n        this.removeAllListeners('data');\r\n        this.removeAllListeners('done');\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * push data to current pipeline.\r\n     * @param data\r\n     */\r\n    push(data: any, conf?: PushConf): void {\r\n        if (conf) {\r\n        }\r\n        this.emit('data', data);\r\n    }\r\n\r\n    /**\r\n     * flush current pipeline.\r\n     * @param flushSource\r\n     */\r\n    flush(flushSource: Stream): void {\r\n        this.emit('done', flushSource);\r\n    }\r\n\r\n    reset(): void {\r\n        this.emit('reset');\r\n    }\r\n}\r\n\r\nexport default Stream;\r\n","/**\r\n * @file: demuxer.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\nimport { Events } from './enum/events';\r\nimport { Context, GlobalOptions, IDemux, PushConf } from './types/globals';\r\nimport CacheBuffer from './util/cache-buffer';\r\nimport EventManager from './util/event-manager';\r\nimport { isArrayBuffer, isUint8Array } from './util/is';\r\nimport logger from './util/logger';\r\nimport Stream from './util/stream';\r\n\r\nexport default abstract class DemuxFacade extends Stream implements IDemux {\r\n    abstract readonly endStream?: Stream;\r\n    protected eventManager_: EventManager;\r\n    protected ctx_: Context;\r\n    protected options_: GlobalOptions;\r\n    protected cache_buffer_: CacheBuffer;\r\n\r\n    protected listenEndStream_(): void {\r\n        this.eventManager_ = new EventManager();\r\n\r\n        this.eventManager_\r\n            .on(this.endStream, 'data', (data) => {\r\n                this.emit(Events.DEMUX_DATA, data);\r\n            })\r\n            .on(this.endStream, 'done', (data) => {\r\n                this.emit(Events.DONE, data);\r\n            })\r\n            .on(this.ctx_, 'error', (data) => {\r\n                this.emit(Events.ERROR, data);\r\n            });\r\n    }\r\n\r\n    constructor(options: GlobalOptions = {}) {\r\n        super();\r\n\r\n        if (options.debug) {\r\n            logger.enable = true;\r\n        }\r\n\r\n        this.ctx_ = new Context();\r\n        this.options_ = options;\r\n        this.cache_buffer_ = new CacheBuffer();\r\n    }\r\n\r\n    /**\r\n     * Pipe the arrayBuffer to the demuxer.\r\n     * @param buf\r\n     * @param conf\r\n     */\r\n    abstract push(buf: ArrayBuffer | Uint8Array, conf: PushConf): void;\r\n\r\n    /**\r\n     * transfer data to Uint8Array\r\n     * @param buf\r\n     */\r\n    protected constraintPushData_(buf: ArrayBuffer | Uint8Array): Uint8Array | null {\r\n        let newBuf = null;\r\n        if (!isArrayBuffer(buf) && !isUint8Array(buf)) {\r\n            logger.error(`Data pushed is not an ArrayBuffer or Uint8Array: ${buf}`);\r\n            return newBuf;\r\n        }\r\n\r\n        if (isArrayBuffer(buf)) {\r\n            newBuf = new Uint8Array(buf);\r\n        } else {\r\n            newBuf = buf;\r\n        }\r\n\r\n        return newBuf;\r\n    }\r\n\r\n    reset(): void {}\r\n\r\n    destroy(): void {\r\n        this.unpipe();\r\n        this.endStream.unpipe();\r\n\r\n        this.eventManager_.removeAll();\r\n    }\r\n}\r\n","/**\r\n * @file: mux-error-code.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\n/**\r\n * @readonly\r\n * @enum {Number}\r\n */\r\nenum codes {\r\n    WORKER_EXCEPTION = 0,\r\n    WORKER_MSG_EXCEPTION,\r\n    TS_SYNC_BYTE,\r\n    FLV_HEAD_SIGNATURE,\r\n    FLV_NOT_EXPECTED_ADJACENT_DATA\r\n}\r\n\r\nexport default codes;\r\n","/**\r\n * @file: patSection.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\nimport logger from '../../util/logger';\r\n\r\n/**\r\n * Structure for pat.\r\n */\r\nexport class PATSection {\r\n    // table_id: number;\r\n    // section_syntax_indicator: number;\r\n    // section_length: number;\r\n    // transport_stream_id: number;\r\n    // version_number: number;\r\n    // current_next_indicator: number;\r\n    // section_number: number;\r\n    // last_section_number: number;\r\n    // network_PID: number;\r\n    pmtTable: Array<M2TS.PMTTableItem>;\r\n    // CRC_32: number;\r\n\r\n    constructor(buffer: Uint8Array) {\r\n        // program_association_section 0x00\r\n        // this.table_id = buffer[0];\r\n\r\n        // this.section_syntax_indicator = buffer[1] >> 7;\r\n\r\n        // this.zero = (buffer[1] >> 6) & 0x1;\r\n\r\n        // this.reserved_0 = (buffer[1] >> 4) & 0x3;\r\n\r\n        // the number of bytes of the section\r\n        // starting immediately following the section_length field, and including the CRC.\r\n        let section_length = ((buffer[1] & 0x0f) << 8) | buffer[2];\r\n\r\n        // this.transport_stream_id = (buffer[3] << 8) | buffer[4];\r\n\r\n        // this.reserved_1 = buffer[5] >> 6;\r\n\r\n        // this.version_number = (buffer[5] >> 1) & 0x1f;\r\n\r\n        // this.current_next_indicator = buffer[5] && 0x01;\r\n\r\n        // The section_number of the first section in the Program Association Table shall be 0x00.\r\n        // It shall be incremented by 1 with each additional section in the PAT.\r\n        // this.section_number = buffer[6];\r\n\r\n        // The number of the last section (that is, the section with the highest section_number) of the complete PAT.\r\n        // this.last_section_number = buffer[7];\r\n\r\n        // this.network_PID = 0x00;\r\n\r\n        var n = 0,\r\n            program_num;\r\n        // reserved_3;\r\n        var len = section_length - 4 - 5; // 4: crc32, 5: bytes followed by section_length\r\n\r\n        this.pmtTable = [];\r\n        /* loop by 4 bytes, during  */\r\n        for (; n < len; n += 4) {\r\n            program_num = (buffer[n + 8] << 8) | buffer[n + 9];\r\n            // reserved_3 = buffer[10 + n] >> 5;\r\n\r\n            if (program_num == 0x00) {\r\n                let network_PID = ((buffer[10 + n] & 0x1f) << 8) | buffer[11 + n];\r\n\r\n                // 记录该TS流的网络PID\r\n                // TS_network_Pid = this.network_PID;\r\n\r\n                logger.log('packet->network_PID %0x /n/n', network_PID);\r\n            } else {\r\n                this.pmtTable.push({\r\n                    programNum: program_num,\r\n                    program_map_PID: ((buffer[10 + n] & 0x1f) << 8) | buffer[11 + n]\r\n                });\r\n\r\n                // TS_PAT_Program\r\n                // PAT_program;\r\n                // PAT_program.program_map_PID = (buffer[10 + n] & 0x1F) << 8 | buffer[11 + n];\r\n                // PAT_program.program_number = program_num;\r\n                // this.program.push_back(PAT_program);\r\n                // TS_program.push_back(PAT_program);//向全局PAT节目数组中添加PAT节目信息\r\n            }\r\n        }\r\n\r\n        // var crcLength = this.section_length + 3;\r\n        // this.CRC_32 =\r\n        //     ((buffer[crcLength - 4] & 0x000000ff) << 24) |\r\n        //     ((buffer[crcLength - 3] & 0x000000ff) << 16) |\r\n        //     ((buffer[crcLength - 2] & 0x000000ff) << 8) |\r\n        //     (buffer[crcLength - 1] & 0x000000ff);\r\n    }\r\n}\r\n","/**\r\n * @file: pmtSection.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\n/**\r\n * Structure for pat.\r\n */\r\nimport logger from '../../util/logger';\r\n\r\n/**\r\n * Structure for PMT.\r\n */\r\nexport class PMTSection {\r\n    // table_id: number;\r\n    // section_syntax_indicator: number;\r\n    // section_length: number;\r\n    // program_number: number;\r\n    // version_number: number;\r\n    // current_next_indicator: number;\r\n    // section_number: number;\r\n    // last_section_number: number;\r\n    // PCR_PID: number;\r\n    pes_table: Array<M2TS.PESTableItem>;\r\n    // CRC_32: number;\r\n\r\n    constructor(buffer: Uint8Array) {\r\n        // program_map_section  0x02\r\n        // this.table_id = buffer[0];\r\n\r\n        // this.section_syntax_indicator = buffer[1] >> 7;\r\n\r\n        // this.zero = (buffer[1] >> 6) & 0x1;\r\n\r\n        // this.reserved_0 = (buffer[1] >> 4) & 0x3;\r\n\r\n        // the number of bytes of the section\r\n        // starting immediately following the section_length field, and including the CRC.\r\n        let section_length = ((buffer[1] & 0x0f) << 8) | buffer[2];\r\n\r\n        // It specifies the program to which the program_map_PID is applicable.\r\n        // this.program_number = (buffer[3] << 8) | buffer[4];\r\n\r\n        // this.reserved_1 = buffer[5] >> 6;\r\n\r\n        // this.version_number = (buffer[5] >> 1) & 0x1f;\r\n\r\n        // this.current_next_indicator = buffer[5] && 0x01;\r\n\r\n        // The section_number of the first section in the Program Association Table shall be 0x00.\r\n        // It shall be incremented by 1 with each additional section in the PAT.\r\n        // this.section_number = buffer[6];\r\n\r\n        // The number of the last section (that is, the section with the highest section_number) of the complete PAT.\r\n        // this.last_section_number = buffer[7];\r\n\r\n        // contain the PCR fields valid for the program specified by program_number.\r\n        // this.PCR_PID = ((buffer[8] & 0x1f) << 8) | buffer[9];\r\n\r\n        // this.reserved_2 = buffer[10] >> 4;\r\n\r\n        // The number of bytes of the descriptors immediately following the program_info_length field.\r\n        const program_info_length = ((buffer[10] & 0x0f) << 8) | buffer[11];\r\n\r\n        if (program_info_length < 0) {\r\n            return;\r\n        } else if (program_info_length > 2) {\r\n            let i = 0;\r\n\r\n            while (i < program_info_length) {\r\n                // let descriptor_tag = buffer[12 + i];\r\n                let descriptor_length = buffer[13 + i];\r\n\r\n                // \tlogger.log('descriptor_tag', descriptor_tag, descriptor_length);\r\n                i += descriptor_length;\r\n            }\r\n        }\r\n\r\n        var es_section_pos = 12 + program_info_length;\r\n        var es_section_len = section_length - program_info_length - 9 - 4; // 9: bytes followed by section_length, 4: crc32\r\n        var es_section_end = es_section_pos + es_section_len;\r\n\r\n        if (es_section_pos >= es_section_end) {\r\n            logger.warn(`es_section_pos < es_section_end ${es_section_pos}, ${es_section_end}`);\r\n            return;\r\n        }\r\n\r\n        this.pes_table = [];\r\n\r\n        let j = 0;\r\n        while (j < es_section_len) {\r\n            let basePos = es_section_pos + j;\r\n            let stream_type = buffer[basePos];\r\n            let elementary_PID = ((buffer[basePos + 1] << 8) | buffer[basePos + 2]) & 0x1fff;\r\n            let ES_info_length = ((buffer[basePos + 3] << 8) | buffer[basePos + 4]) & 0x0fff;\r\n\r\n            this.pes_table.push({\r\n                streamType: stream_type,\r\n                PID: elementary_PID\r\n            });\r\n\r\n            // if (ES_info_length > 2) {\r\n            //     let k = 0;\r\n            //     let es_pos = basePos + 5;\r\n\r\n            //     while (k < ES_info_length) {\r\n            //         // let descriptor_tag = buffer[es_pos + k];\r\n            //         let descriptor_length = buffer[es_pos + k];\r\n\r\n            //         // if (descriptor_tag === )\r\n            //         k += descriptor_length;\r\n            //     }\r\n            // }\r\n\r\n            j += ES_info_length + 5;\r\n        }\r\n\r\n        // var crcLength = this.section_length + 3;\r\n        // this.CRC_32 =\r\n        //     ((buffer[crcLength - 4] & 0x000000ff) << 24) |\r\n        //     ((buffer[crcLength - 3] & 0x000000ff) << 16) |\r\n        //     ((buffer[crcLength - 2] & 0x000000ff) << 8) |\r\n        //     (buffer[crcLength - 1] & 0x000000ff);\r\n    }\r\n}\r\n","/**\r\n * @file: m2t-pid.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\n/**\r\n * @overview Program and program element descriptors.\r\n * @see ISO/IEC 13818-1: Table 2-3 – PID table\r\n * @see DVB SI: 5.1.3 Coding of PID and table_id fields\r\n */\r\n\r\n/**\r\n * @readonly\r\n * @enum {number}\r\n * @export\r\n */\r\nexport const PAT_PID = 0x0000;\r\nexport const CAT_PID = 0x0001;\r\nexport const TSDT_PID = 0x0002;\r\n/* reserved 0x0003 to 0x000F */\r\nexport const SDT_PID = 0x0011;\r\n","/**\r\n * @file: psi.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\n/**\r\n * PSI(Program Specific Information)\r\n */\r\n// import { HevcPPSProps, HevcSPSProps, HevcVPSProps } from '../codec/avc';\r\nimport { PATSection } from './structs/patSection';\r\nimport { PMTSection } from './structs/pmtSection';\r\n// import { SDTSection } from './structs/sdtSection';\r\nimport { PAT_PID, CAT_PID, TSDT_PID, SDT_PID } from '../enum/m2t-pid';\r\n// import { Context } from '../types/globals';\r\nimport { Packet } from './structs/packet';\r\n// import StreamTypes from '../enum/stream-types';\r\nimport { StreamTypes } from '../enum/stream-types';\r\nimport { GOPVector, AACFrameVector } from './types/pipeline';\r\n\r\n// const MAX_PIDS_PER_PROGRAM = 64;\r\n\r\ntype TrackType = 'video' | 'audio' | 'caption';\r\n\r\nexport interface Track {\r\n    id: number;\r\n    type: TrackType;\r\n    stream_type: StreamTypes;\r\n    duration: number;\r\n    width?: number;\r\n    height?: number;\r\n    codec: string;\r\n    realCodec?: string;\r\n    firstDTS: number;\r\n    firstPTS: number;\r\n\r\n    // Video\r\n    gops: GOPVector;\r\n    profileIdc?: number;\r\n    profileCompatibility?: number;\r\n    levelIdc?: number;\r\n    pixelRatio?: [number, number];\r\n    timescale: number; // (in TS timescale = 90kHz)\r\n    inputTimeScale?: number;\r\n    sps: Array<Uint8Array>;\r\n    pps: Array<Uint8Array>;\r\n    vps: Array<Uint8Array>;\r\n    // hevc_vps: HevcVPSProps;\r\n    // hevc_sps: HevcSPSProps;\r\n    // hevc_pps: HevcPPSProps;\r\n\r\n    // Audio\r\n    isAAC?: boolean;\r\n    frames: AACFrameVector;\r\n    sampleRate?: number;\r\n    channelCount?: number;\r\n    config?: any;\r\n}\r\n\r\n// class Metadata {\r\n//     service_name: string;\r\n//     service_provider: string;\r\n// }\r\n\r\nexport class PSI {\r\n    constructor() {\r\n        // this.metadata = new Metadata();\r\n        this.pat_table = [];\r\n        this.pes_streams = [];\r\n    }\r\n\r\n    // private context: AVFormatContext;\r\n    // private metadata: Metadata; // Specify by SDT Packet\r\n    private pat_table: Array<M2TS.PATTableItem>; // Specify by PMT Packet\r\n    private pes_streams: Array<M2TS.PSI_PES_Stream>; // Specify by PES stream\r\n\r\n    /**\r\n     * program PID\r\n     */\r\n    get currentProgramPID(): number {\r\n        let _pmtIds = [];\r\n\r\n        for (let i = 0; i < this.pat_table.length; i++) {\r\n            _pmtIds.push(this.pat_table[i].pid);\r\n        }\r\n\r\n        return _pmtIds.length > 0 ? _pmtIds[0] : -1;\r\n    }\r\n\r\n    get tracks() {\r\n        return this.pes_streams;\r\n    }\r\n\r\n    // get pmtTable() {\r\n    //     return this.pat_table;\r\n    // }\r\n\r\n    /**\r\n     * 目前对于PSI的信息，持久化保留在内存中\r\n     * 对于同一个片子，HLS规范会规定只能有一个 PMT/PAT 表\r\n     * 所以一部片子的PSI信息应该是保持不变的，换片子后PSI信息的销毁通过 mux 重新实例化产生新的信息，不需要调用reset\r\n     * 有些 TS 文件在HLS切片器切割的时候，没有带上PAT/PMT等表，需要相邻 TS 给定的表信息\r\n     */\r\n    reset(): void {\r\n        // this.metadata = new Metadata();\r\n        this.pat_table.splice(0, this.pat_table.length);\r\n        this.pes_streams.splice(0, this.pes_streams.length);\r\n    }\r\n\r\n    /**\r\n     * @param packet\r\n     */\r\n    parse(packet: Packet): void {\r\n        const self = this;\r\n\r\n        // ISO13818-1: Table 2-3 – PID table\r\n        if (PAT_PID === packet.PID) {\r\n            /* PAT PID */\r\n            this._parsePat(packet);\r\n        } else if (CAT_PID === packet.PID) {\r\n            /* CAT PID */\r\n        } else if (TSDT_PID === packet.PID) {\r\n            /* Transport Stream Description Table */\r\n        } else if (0x0003 <= packet.PID && packet.PID <= 0x000f) {\r\n            /* Reserved */\r\n        } else if (SDT_PID === packet.PID) {\r\n            /* Service Description Table */\r\n            // this._parseSdt(packet);\r\n        } else if (packet.PID === self.currentProgramPID) {\r\n            /* PMT PID */\r\n            this._parsePmt(packet);\r\n        }\r\n        // else if (this.findTrack(packet.PID)) {\r\n        // \t/* Reserved */\r\n        // } else {\r\n        // \tlogger.warn(`psi unknown packet PID ${packet.PID}`);\r\n        // }\r\n    }\r\n\r\n    // findPmtProgram(PID) {\r\n    // \tlet program = null;\r\n    //\r\n    // \tfor (let i = 0; i < this.pat_table.length; i++) {\r\n    // \t\tif (this.pat_table[i].pid === PID) {\r\n    // \t\t\tprogram = this.pat_table[i].id;\r\n    // \t\t\tbreak;\r\n    // \t\t}\r\n    // \t}\r\n    //\r\n    // \treturn program;\r\n    // }\r\n\r\n    /**\r\n     * @param PID\r\n     */\r\n    findTrack(PID: number): Track {\r\n        let program = null;\r\n        let streams = this.pes_streams;\r\n\r\n        for (let i = 0; i < streams.length; i++) {\r\n            if (streams[i].id === PID) {\r\n                program = streams[i];\r\n                break;\r\n            }\r\n        }\r\n\r\n        return program;\r\n    }\r\n\r\n    /**\r\n     * Parse PAT Packet\r\n     * @param pack\r\n     */\r\n    private _parsePat(pack: Packet): PATSection {\r\n        let data: Uint8Array;\r\n\r\n        if (pack.payload_unit_start_indicator) {\r\n            // psi has pointer_field\r\n            let pointer = pack.payload[0];\r\n\r\n            data = pack.payload.subarray(pointer + 1);\r\n        } else {\r\n            data = pack.payload;\r\n        }\r\n\r\n        let pat = new PATSection(data);\r\n\r\n        // https://tools.ietf.org/html/rfc8216#section-3.2\r\n        // Transport Stream Segments MUST contain a single MPEG-2 Program;\r\n        for (var i = 0; i < pat.pmtTable.length; i++) {\r\n            this._add_pid_to_pmt(pat.pmtTable[i].programNum, pat.pmtTable[i].program_map_PID);\r\n        }\r\n\r\n        return pat;\r\n    }\r\n\r\n    /**\r\n     * Associates Program Number and Program Map Table(PMT) PID\r\n     * @param programId\r\n     * @param pid\r\n     */\r\n    private _add_pid_to_pmt(programId: number, pid: number): void {\r\n        let table = this.pat_table;\r\n\r\n        function get_pmt(id: number) {\r\n            for (let i = 0, item: M2TS.PATTableItem; i < table.length; i++) {\r\n                item = table[i];\r\n                if (item.id === id) {\r\n                    return {\r\n                        idx: i,\r\n                        item\r\n                    };\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n        let p = get_pmt(programId);\r\n        if (!p) {\r\n            table.push({\r\n                id: programId,\r\n                pid: pid\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Parse PMT Packet\r\n     * @param pack\r\n     */\r\n    private _parsePmt(pack: Packet): PMTSection {\r\n        let data: Uint8Array;\r\n\r\n        if (pack.payload_unit_start_indicator) {\r\n            // psi has pointer_field\r\n            let pointer = pack.payload[0];\r\n\r\n            data = pack.payload.subarray(pointer + 1);\r\n        } else {\r\n            data = pack.payload;\r\n        }\r\n\r\n        let pmt = new PMTSection(data);\r\n\r\n        for (var i = 0; i < pmt.pes_table.length; i++) {\r\n            this._add_pes_stream(pmt.pes_table[i]);\r\n        }\r\n\r\n        return pmt;\r\n    }\r\n\r\n    /**\r\n     * @param stream\r\n     * @param pmt\r\n     */\r\n    private _add_pes_stream(stream: M2TS.PESTableItem /*, pmt?: PMTSection*/): void {\r\n        let streams = this.pes_streams;\r\n\r\n        function get_program(id: number) {\r\n            for (let i = 0, item: M2TS.PSI_PES_Stream; i < streams.length; i++) {\r\n                item = streams[i];\r\n                if (item.id === id) {\r\n                    return {\r\n                        idx: i,\r\n                        item\r\n                    };\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n        let p = get_program(stream.PID);\r\n        if (!p) {\r\n            streams.push({\r\n                id: stream.PID,\r\n                stream_type: stream.streamType,\r\n                duration: 0,\r\n                sps: [],\r\n                pps: [],\r\n                pixelRatio: [1, 1],\r\n                timescale: 90000, // (in TS timescale = 90kHz)\r\n                width: 0,\r\n                height: 0\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Parse SDT Packet\r\n     * @param pack\r\n     */\r\n    // private _parseSdt(pack: Packet): SDTSection {\r\n    //     let data: Uint8Array;\r\n\r\n    //     if (pack.payload_unit_start_indicator) {\r\n    //         // psi has pointer_field\r\n    //         let pointer = pack.payload[0];\r\n\r\n    //         data = pack.payload.subarray(pointer + 1);\r\n    //     } else {\r\n    //         data = pack.payload;\r\n    //     }\r\n\r\n    //     let sdt = new SDTSection(data);\r\n\r\n    //     if (sdt.service_table.length > 0) {\r\n    //         this.metadata.service_name = sdt.service_table[0].name;\r\n    //         this.metadata.service_provider = sdt.service_table[0].provider_name;\r\n    //     }\r\n\r\n    //     return sdt;\r\n    // }\r\n}\r\n","/**\r\n * @file: complex.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\n/**\r\n * Complex Stream.\r\n *\r\n * Combine Video, Audio, Caption c and other data.\r\n */\r\nimport Stream from '../../util/stream';\r\n\r\nclass M2TSComplexStream extends Stream {\r\n    constructor(ctx, psi) {\r\n        super();\r\n\r\n        /** @private */\r\n        this.context = ctx;\r\n\r\n        /** @private {PSI} */\r\n        this.PSI = psi;\r\n\r\n        /** @private {Object} */\r\n        this.videoTrack = null;\r\n\r\n        /** @private {Object} */\r\n        this.audioTrack = null;\r\n\r\n        /** @private {Object} */\r\n        this.captionTrack = null;\r\n\r\n        // pipe specified by outside.\r\n    }\r\n\r\n    push(data) {\r\n        let tracks = data;\r\n\r\n        for (let i = 0, track; i < tracks.length; i++) {\r\n            track = tracks[i];\r\n\r\n            switch (track.type) {\r\n                case 'video':\r\n                    // data -> GOPs\r\n                    this._complexVideo(track);\r\n                    break;\r\n                case 'audio':\r\n                    this._complexAudio(track);\r\n                    break;\r\n                case 'caption':\r\n                    this._complexCaption(track);\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    flush() {\r\n        this.emit('done');\r\n\r\n        this._clearStream();\r\n    }\r\n\r\n    reset() {\r\n        this._clearStream();\r\n\r\n        // This is demux end stream, so don't emit reset.\r\n        // this.emit('reset');\r\n    }\r\n\r\n    _clearStream() {\r\n        this.videoTrack = null;\r\n        this.audioTrack = null;\r\n        this.captionTrack = null;\r\n    }\r\n\r\n    _complexVideo(gops) {\r\n        let track = this.PSI.findTrack(gops.trackId);\r\n\r\n        if (track) {\r\n            track.type = 'video';\r\n            track.gops = gops;\r\n            track.firstDTS = gops[0][0].dts;\r\n            track.firstPTS = gops[0][0].pts;\r\n            // set duration to Infinity(POSITIVE_INFINITY) can be useful for live.\r\n            // If Infinity it will loose the ability to seek.\r\n            track.duration = Number.POSITIVE_INFINITY;\r\n\r\n            this.videoTrack = track;\r\n\r\n            this.emit('data', {\r\n                videoTrack: this.videoTrack\r\n            });\r\n        }\r\n    }\r\n\r\n    _complexAudio(frames) {\r\n        let track = this.PSI.findTrack(frames.trackId);\r\n\r\n        if (track) {\r\n            track.type = 'audio';\r\n            track.frames = frames;\r\n            track.firstPTS = track.firstDTS = frames[0].dts;\r\n\r\n            // set duration to Infinity(POSITIVE_INFINITY) can be useful for live.\r\n            // If Infinity it will loose the ability to seek.\r\n            track.duration = Number.POSITIVE_INFINITY;\r\n\r\n            this.audioTrack = track;\r\n\r\n            this.emit('data', {\r\n                audioTrack: this.audioTrack\r\n            });\r\n        }\r\n    }\r\n\r\n    _complexCaption() {}\r\n}\r\n\r\nexport default M2TSComplexStream;\r\n","/**\r\n * @file: aac-config.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\n/**\r\n * Audio Config Helper\r\n * Accord audioObjectType/samplingFrequencyIndex/channelCount, generate mimeType info.\r\n */\r\nimport platform from '../../util/platform';\r\nimport logger from '../../util/logger';\r\n\r\n/*\r\n    sampling freq,\r\n    0: 96000 Hz\r\n    1: 88200 Hz\r\n    2: 64000 Hz\r\n    3: 48000 Hz\r\n    4: 44100 Hz\r\n    5: 32000 Hz\r\n    6: 24000 Hz\r\n    7: 22050 Hz\r\n    8: 16000 Hz\r\n    9: 12000 Hz\r\n    10: 11025 Hz\r\n    11: 8000 Hz\r\n    12: 7350 Hz\r\n    13: Reserved\r\n    14: Reserved\r\n    15: frequency is written explictly\r\n */\r\nconst samplingRates = [96000, 88200, 64000, 48000, 44100, 32000, 24000, 22050, 16000, 12000, 11025, 8000, 7350];\r\n\r\nexport default (audioObjectType: number, samplingFrequencyIndex: number, channelCount: number) => {\r\n    let adtsExtensionSamplingIndex;\r\n    let realAudioObjectType = audioObjectType;\r\n    let config;\r\n\r\n    if (samplingFrequencyIndex > samplingRates.length - 1) {\r\n        logger.error(`invalid sampling index:${samplingFrequencyIndex}`);\r\n        return;\r\n    }\r\n\r\n    audioObjectType = 5;\r\n    config = new Array(4);\r\n    // if (manifest codec is HE-AAC or HE-AACv2) OR (manifest codec not specified AND frequency less than 24kHz)\r\n    if (samplingFrequencyIndex >= 6) {\r\n        // HE-AAC uses SBR (Spectral Band Replication) , high frequencies are constructed from low frequencies\r\n        // there is a factor 2 between frame sample rate and output sample rate\r\n        // multiply frequency by 2 (see table below, equivalent to substract 3)\r\n        adtsExtensionSamplingIndex = samplingFrequencyIndex - 3;\r\n    } else {\r\n        // if (manifest codec is AAC) AND (frequency less than 24kHz AND nb channel is 1) OR (manifest codec not specified and mono audio)\r\n        // Chrome fails to play back with low frequency AAC LC mono when initialized with HE-AAC.  This is not a problem with stereo.\r\n        if (channelCount === 1) {\r\n            audioObjectType = 2;\r\n            config = new Array(2);\r\n        }\r\n        adtsExtensionSamplingIndex = samplingFrequencyIndex;\r\n    }\r\n    /* \r\n        refer to http://wiki.multimedia.cx/index.php?title=MPEG-4_Audio#Audio_Specific_Config ISO 14496-3 (AAC).pdf \r\n            - Table 1.13 — Syntax of AudioSpecificConfig()\r\n          Audio Profile / Audio Object Type\r\n          0: Null\r\n          1: AAC Main\r\n          2: AAC LC (Low Complexity)\r\n          3: AAC SSR (Scalable Sample Rate)\r\n          4: AAC LTP (Long Term Prediction)\r\n          5: SBR (Spectral Band Replication)\r\n          6: AAC Scalable\r\n\r\n          Channel Configurations\r\n          These are the channel configurations:\r\n          0: Defined in AOT Specifc Config\r\n          1: 1 channel: front-center\r\n          2: 2 channels: front-left, front-right\r\n        */\r\n    // audioObjectType = profile => profile, the MPEG-4 Audio Object Type minus 1\r\n    config[0] = audioObjectType << 3;\r\n    // samplingFrequencyIndex\r\n    config[0] |= (samplingFrequencyIndex & 0x0e) >> 1;\r\n    config[1] |= (samplingFrequencyIndex & 0x01) << 7;\r\n    // channelConfiguration\r\n    config[1] |= channelCount << 3;\r\n    if (audioObjectType === 5) {\r\n        // adtsExtensionSamplingIndex\r\n        config[1] |= (adtsExtensionSamplingIndex & 0x0e) >> 1;\r\n        config[2] = (adtsExtensionSamplingIndex & 0x01) << 7;\r\n        // audioObjectType (force to 2, chrome is checking that object type is less than 5 ???\r\n        //    https://chromium.googlesource.com/chromium/src.git/+/master/media/formats/mp4/aac.cc\r\n        config[2] |= 2 << 2;\r\n        config[3] = 0;\r\n    }\r\n\r\n    return {\r\n        config: config,\r\n        sampleRate: samplingRates[samplingFrequencyIndex],\r\n        channelCount: channelCount,\r\n        codec: 'mp4a.40.' + audioObjectType,\r\n        realCodec: 'mp4a.40.' + realAudioObjectType\r\n    };\r\n};\r\n","/**\r\n * @file: created at Saturday, 9th May 2020 11:13:19 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\n// The AudioSpecificConfig is explained in ISO 14496-3.\r\nexport interface AudioSpecificConfig {\r\n    audioObjectType: number;\r\n    sampleCount: number;\r\n    channelConfiguration: number;\r\n    sampleRate: number;\r\n    samplingFrequencyIndex: number;\r\n    // assume ISO/IEC 14496-12 AudioSampleEntry default of 16\r\n}\r\n\r\nexport interface AACFrame extends Omit<AudioSpecificConfig, 'channelConfiguration'> {\r\n    pts: number;\r\n    dts: number;\r\n    data: Uint8Array;\r\n    channelCount: number; // equal to channelConfiguration\r\n    sampleSize: number;\r\n}\r\n\r\nexport const AAC_SAMPLING_FREQUENCIES = [\r\n    96000,\r\n    88200,\r\n    64000,\r\n    48000,\r\n    44100,\r\n    32000,\r\n    24000,\r\n    22050,\r\n    16000,\r\n    12000,\r\n    11025,\r\n    8000,\r\n    7350\r\n];\r\n","/**\r\n * @file: adts.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\n/**\r\n * ADTS codec\r\n * Wiki Refer: https://wiki.multimedia.cx/index.php?title=ADTS\r\n */\r\nimport EventEmitter from '../util/event-emitter';\r\nimport { AACFrame, AAC_SAMPLING_FREQUENCIES } from './aac/aac';\r\n\r\nexport type AACCodecData = {\r\n    pts: number;\r\n    dts: number;\r\n    payload: Uint8Array;\r\n};\r\n\r\n/**\r\n * @extends EventEmitter\r\n */\r\nclass ADTSCodec extends EventEmitter {\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    push(data: AACCodecData) {\r\n        let { pts, dts, payload } = data;\r\n        let data_byte = payload;\r\n        let i = 0,\r\n            frameNum = 0,\r\n            frameLength,\r\n            protectionSkipBytes,\r\n            frameEnd,\r\n            sampleCount,\r\n            adtsFrameDuration;\r\n\r\n        while (i + 5 < data_byte.length) {\r\n            // Look for the start of an ADTS header..\r\n            if (data_byte[i] !== 0xff || (data_byte[i + 1] & 0xf6) !== 0xf0) {\r\n                // If a valid header was not found,  jump one forward and attempt to\r\n                // find a valid ADTS header starting at the next byte\r\n                i++;\r\n                continue;\r\n            }\r\n\r\n            // The protection skip bit tells us if we have 2 bytes of CRC data at the\r\n            // end of the ADTS header\r\n            protectionSkipBytes = (~data_byte[i + 1] & 0x01) * 2;\r\n\r\n            // Frame length is a 13 bit integer starting 16 bits from the\r\n            // end of the sync sequence\r\n            frameLength =\r\n                ((data_byte[i + 3] & 0x03) << 11) | (data_byte[i + 4] << 3) | ((data_byte[i + 5] & 0xe0) >> 5);\r\n\r\n            sampleCount = ((data_byte[i + 6] & 0x03) + 1) * 1024;\r\n            adtsFrameDuration = (sampleCount * 90000) / AAC_SAMPLING_FREQUENCIES[(data_byte[i + 2] & 0x3c) >>> 2];\r\n\r\n            frameEnd = i + frameLength;\r\n\r\n            // If we don't have enough data to actually finish this ADTS frame, return\r\n            // and wait for more data\r\n            if (data_byte.byteLength < frameEnd) {\r\n                return;\r\n            }\r\n\r\n            let aacFrame: AACFrame = {\r\n                pts: pts + frameNum * adtsFrameDuration,\r\n                dts: dts + frameNum * adtsFrameDuration,\r\n                sampleCount: sampleCount,\r\n                audioObjectType: ((data_byte[i + 2] >>> 6) & 0x03) + 1,\r\n                channelCount: ((data_byte[i + 2] & 1) << 2) | ((data_byte[i + 3] & 0xc0) >>> 6),\r\n                sampleRate: AAC_SAMPLING_FREQUENCIES[(data_byte[i + 2] & 0x3c) >>> 2],\r\n                samplingFrequencyIndex: (data_byte[i + 2] & 0x3c) >>> 2,\r\n                // assume ISO/IEC 14496-12 AudioSampleEntry default of 16\r\n                sampleSize: 16,\r\n                data: data_byte.subarray(i + 7 + protectionSkipBytes, frameEnd)\r\n            };\r\n            // Otherwise, deliver the complete AAC frame\r\n            this.emit('frame', aacFrame);\r\n\r\n            // If the data_byte is empty, clear it and return\r\n            if (data_byte.byteLength === frameEnd) {\r\n                data_byte = undefined;\r\n\r\n                this.emit('done');\r\n                return;\r\n            }\r\n\r\n            frameNum++;\r\n\r\n            // Remove the finished frame from the data_byte and start the process again\r\n            data_byte = data_byte.subarray(frameEnd);\r\n        }\r\n    }\r\n}\r\n\r\nexport default ADTSCodec;\r\n","/**\r\n * @file: adts.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\n/**\r\n * ADTS(Audio Data Transport Stream) Stream.\r\n */\r\nimport { AACFrame } from '../../codec/aac/aac';\r\nimport getAudioConfig from '../../codec/aac/aac-config';\r\nimport ADTSCodec from '../../codec/adts';\r\nimport { StreamTypes } from '../../enum/stream-types';\r\nimport Stream from '../../util/stream';\r\nimport { PSI } from '../psi';\r\nimport { AACFrameVector, PESStreamEmitData } from '../types/pipeline';\r\n\r\nclass ADTSStream extends Stream {\r\n    private PSI: PSI;\r\n    private trackId?: number;\r\n    private codec: ADTSCodec;\r\n    private frames: AACFrameVector;\r\n\r\n    constructor(psi: PSI) {\r\n        super();\r\n\r\n        this.PSI = psi;\r\n        this.trackId = null;\r\n\r\n        /** @private {ADTSCodec} */\r\n        this.codec = new ADTSCodec();\r\n\r\n        this.codec.on('frame', (frame: AACFrame) => {\r\n            this.frames.push(frame);\r\n            this.frames.byteLength += frame.data.byteLength;\r\n            this.frames.trackId = this.trackId;\r\n        });\r\n\r\n        this._newFrames();\r\n    }\r\n\r\n    push(data: PESStreamEmitData) {\r\n        if (data.stream_type === StreamTypes.ADTS) {\r\n            this.trackId = data.pid;\r\n\r\n            this.codec.push({\r\n                dts: data.pes.DTS,\r\n                pts: data.pes.PTS,\r\n                payload: data.pes.data_byte\r\n            });\r\n        }\r\n    }\r\n\r\n    flush() {\r\n        if (this.frames.length > 0) {\r\n            let count = this.frames.length;\r\n            let firstFrame = this.frames[0];\r\n            let lastFrame = this.frames[count - 1];\r\n            let lastDuration = (lastFrame.sampleRate * lastFrame.sampleCount) / 90000;\r\n\r\n            this.frames.firstDTS = firstFrame.dts;\r\n            this.frames.firstPTS = firstFrame.pts;\r\n\r\n            if (count === 1) {\r\n                this.frames.duration = lastDuration;\r\n            } else {\r\n                this.frames.duration = lastDuration + (lastFrame.pts - firstFrame.pts);\r\n            }\r\n\r\n            // To prevent information mismatch leading to next pipeline decoding errors\r\n            // Every audio frame list assembly needs to update track meta.\r\n            this._updateTrackMeta(firstFrame);\r\n\r\n            this.emit('data', this.frames);\r\n\r\n            this.reset();\r\n            this.emit('done');\r\n        }\r\n    }\r\n\r\n    reset() {\r\n        this.trackId = null;\r\n        this._newFrames();\r\n    }\r\n\r\n    _newFrames() {\r\n        this.frames = []; // aac frames\r\n        this.frames.type = 'audio';\r\n        this.frames.byteLength = 0;\r\n        this.frames.duration = 0;\r\n        this.frames.firstDTS = 0;\r\n        this.frames.firstPTS = 0;\r\n    }\r\n\r\n    /**\r\n     * @param {Object} frame\r\n     */\r\n    _updateTrackMeta(frame: AACFrame) {\r\n        let track = this.PSI.findTrack(this.trackId);\r\n        let config = getAudioConfig(frame.audioObjectType, frame.samplingFrequencyIndex, frame.channelCount);\r\n        track.config = config.config;\r\n        track.sampleRate = config.sampleRate;\r\n        track.inputTimeScale = track.inputTimeScale || track.timescale;\r\n        track.timescale = config.sampleRate;\r\n        track.channelCount = config.channelCount;\r\n        track.codec = config.codec;\r\n        track.realCodec = config.realCodec;\r\n        track.isAAC = true;\r\n    }\r\n}\r\n\r\nexport default ADTSStream;\r\n","/**\r\n * @file: dv.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\n/**\r\n * Bit buffer reader like DataView.\r\n */\r\n\r\nfunction read(buf: ArrayBuffer | Uint8Array): DataView {\r\n    let byteOffset = 0;\r\n\r\n    if (ArrayBuffer.isView(buf)) {\r\n        byteOffset = buf.byteOffset;\r\n        buf = buf.buffer;\r\n    }\r\n\r\n    return new DataView(buf, byteOffset);\r\n}\r\n\r\nclass DataViewReader {\r\n    constructor() {}\r\n\r\n    /**\r\n     * Gets an unsigned 8-bit integer (unsigned byte).\r\n     * @param buffer\r\n     * @param byteOffset    The offset, in byte, from the start of the view where to read the data.\r\n     * @returns {number}    An unsigned 8-bit integer number.\r\n     */\r\n    readUint8(buffer: ArrayBuffer | Uint8Array, byteOffset: number): number {\r\n        return read(buffer).getUint8(byteOffset);\r\n    }\r\n\r\n    /**\r\n     * Gets an unsigned 16-bit integer (unsigned long).\r\n     * @param buffer\r\n     * @param byteOffset     The offset, in byte, from the start of the view where to read the data.\r\n     * @param littleEndian   Indicates whether the 16-bit int is stored in little- or big-endian format.\r\n     * @returns {number}     An unsigned 16-bit integer number.\r\n     */\r\n    readUint16(buffer: ArrayBuffer | Uint8Array, byteOffset, littleEndian: boolean = false): number {\r\n        return read(buffer).getUint16(byteOffset, littleEndian);\r\n    }\r\n\r\n    /**\r\n     * Gets an unsigned 32-bit integer (unsigned long).\r\n     * @param buffer\r\n     * @param byteOffset        The offset, in byte, from the start of the view where to read the data.\r\n     * @param littleEndian      Indicates whether the 32-bit int is stored in little- or big-endian format.\r\n     * @returns {number}        An unsigned 32-bit integer number.\r\n     */\r\n    readUint32(buffer: ArrayBuffer | Uint8Array, byteOffset: number, littleEndian: boolean = false): number {\r\n        return read(buffer).getUint32(byteOffset, littleEndian);\r\n    }\r\n}\r\n\r\nexport default DataViewReader;\r\n","/**\r\n * @file: ep3b.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\n/**\r\n * discard the emulation_prevention_three_byte\r\n * @param data\r\n */\r\nexport default function discardEP3B(data: Uint8Array): Uint8Array {\r\n    let length = data.byteLength,\r\n        emulationPreventionBytesPositions = [],\r\n        i = 1,\r\n        newLength: number,\r\n        newData = new Uint8Array(0);\r\n\r\n    // Find all `Emulation Prevention Bytes`\r\n    while (i < length - 2) {\r\n        if (data[i] === 0 && data[i + 1] === 0 && data[i + 2] === 0x03) {\r\n            emulationPreventionBytesPositions.push(i + 2);\r\n            i += 2;\r\n        } else {\r\n            i++;\r\n        }\r\n    }\r\n\r\n    // If no Emulation Prevention Bytes were found just return the original\r\n    // array\r\n    if (emulationPreventionBytesPositions.length === 0) {\r\n        return data;\r\n    }\r\n\r\n    // Create a new array to hold the NAL unit data\r\n    newLength = length - emulationPreventionBytesPositions.length;\r\n\r\n    try {\r\n        newData = new Uint8Array(newLength);\r\n    } catch (e) {\r\n        throw `epsb alloc mem error ${newLength}`;\r\n    }\r\n    let sourceIndex = 0;\r\n\r\n    for (i = 0; i < newLength; sourceIndex++, i++) {\r\n        if (sourceIndex === emulationPreventionBytesPositions[0]) {\r\n            // Skip this byte\r\n            sourceIndex++;\r\n            // Remove this position index\r\n            emulationPreventionBytesPositions.shift();\r\n        }\r\n        newData[i] = data[sourceIndex];\r\n    }\r\n\r\n    return newData;\r\n}\r\n","/**\r\n * @file: exp-golumb.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\n/**\r\n * exp golumb algorithm.\r\n * codeNum = 2leadingZeroBits – 1 + read_bits( leadingZeroBits )\r\n * @see https://en.wikipedia.org/wiki/Exponential-Golomb_coding\r\n */\r\n\r\n/**\r\n * read n bit.\r\n * @param buffer\r\n * @param bitOffset\r\n * @param length\r\n * @private\r\n */\r\nexport function readBit(buffer: Uint8Array, bitOffset: number = 0, length: number = 1): number {\r\n    let startByte = 0;\r\n    let startByteBitPos = 0;\r\n    let val = 0;\r\n    let bitStr = '',\r\n        bitVal = 0;\r\n\r\n    for (let j = bitOffset; j < bitOffset + length; j++) {\r\n        startByte = Math.floor(j / 8);\r\n        startByteBitPos = 7 - (j % 8);\r\n        bitVal = (buffer[startByte] >> startByteBitPos) & 0x01;\r\n\r\n        bitStr += bitVal;\r\n    }\r\n\r\n    val = parseInt(bitStr, 2);\r\n\r\n    return val;\r\n}\r\n\r\n/**\r\n * read 1 byte.\r\n * @param buffer\r\n * @param bitOffset\r\n */\r\nexport function readByte(buffer: Uint8Array, bitOffset: number = 0) {\r\n    return readBit(buffer, bitOffset, 8);\r\n}\r\n\r\n/**\r\n * Unsigned Integer Exp-Golomb Coded.\r\n * @param buffer\r\n * @param bitOffset\r\n */\r\nexport function readUEV(buffer: Uint8Array, bitOffset: number = 0) {\r\n    let leadingZeros = [];\r\n    let bitLength = buffer.byteLength * 8;\r\n    let readBit1 = false;\r\n    let startByte = 0;\r\n    let startByteBitPos = 0;\r\n    let bitVal = 0;\r\n    let value = '';\r\n\r\n    // 1. 计算 leadingZeros\r\n    for (let i = bitOffset; i < bitLength; i++) {\r\n        startByte = Math.floor(i / 8);\r\n        startByteBitPos = 7 - (i % 8);\r\n\r\n        bitVal = (buffer[startByte] >> startByteBitPos) & 0x01;\r\n\r\n        if (!readBit1) {\r\n            if (bitVal === 0) {\r\n                leadingZeros.push(0);\r\n            } else {\r\n                readBit1 = true;\r\n                bitOffset = i;\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    let codeNumLength = leadingZeros.length + 1;\r\n\r\n    // 2. 计算有效位数值\r\n    for (let j = bitOffset; j < bitOffset + codeNumLength; j++) {\r\n        startByte = Math.floor(j / 8);\r\n        startByteBitPos = 7 - (j % 8);\r\n        bitVal = (buffer[startByte] >> startByteBitPos) & 0x01;\r\n\r\n        value += bitVal;\r\n    }\r\n\r\n    return {\r\n        bitLength: leadingZeros.length + codeNumLength,\r\n        value: parseInt(value, 2) - 1\r\n    };\r\n}\r\n\r\n/**\r\n * Signed Integer Exp-Golomb Coded.\r\n * @param buffer\r\n * @param bitOffset\r\n */\r\nexport function readSEV(buffer: Uint8Array, bitOffset: number = 0) {\r\n    let uev = readUEV(buffer, bitOffset);\r\n    let codeNum = uev.value;\r\n\r\n    let signedValue = Math.pow(-1, codeNum + 1) * Math.ceil(codeNum / 2);\r\n\r\n    return {\r\n        bitLength: uev.bitLength,\r\n        value: signedValue\r\n    };\r\n}\r\n\r\nexport default {\r\n    readUEV,\r\n    readSEV,\r\n    readBit,\r\n    readByte\r\n};\r\n","/**\r\n * @file: sps.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\nimport ExpGolomb from '../../util/exp-golumb';\r\n\r\nlet bitOffset = 0;\r\n\r\nexport type SPSProps = {\r\n    profile_idc: number;\r\n    profile_compatibility: number;\r\n    level_idc: number;\r\n    sps_id: number;\r\n    log2_max_frame_num_minus4: number;\r\n    pic_order_cnt_type: number;\r\n    log2_max_pic_order_cnt_lsb_minus4: number;\r\n\r\n    width: number;\r\n    height: number;\r\n\r\n    pixelRatio: [number, number];\r\n    payload: Uint8Array;\r\n\r\n    video_format: number;\r\n\r\n    fps: number;\r\n    fixedFPS: boolean;\r\n};\r\n\r\n/**\r\n * 7.3.2.1.1.1 Scaling list syntax\r\n * @param scalingList\r\n * @param size\r\n */\r\nfunction scaling_list(scalingList, size) {\r\n    let lastScale = 8;\r\n    let nextScale = 8;\r\n    let delta_scale;\r\n\r\n    for (var j = 0; j < size; j++) {\r\n        if (nextScale != 0) {\r\n            delta_scale = ExpGolomb.readUEV(scalingList, bitOffset);\r\n            bitOffset += delta_scale.bitLength;\r\n\r\n            nextScale = (lastScale + delta_scale.value + 256) % 256;\r\n        }\r\n\r\n        lastScale = scalingList[j];\r\n    }\r\n}\r\n\r\n/**\r\n * decode (SPS)Sequence parameter set\r\n * @param payload\r\n */\r\nexport function decodeSPS(payload: Uint8Array): SPSProps {\r\n    bitOffset = 0;\r\n\r\n    let profile_idc = payload[0];\r\n    let profile_compatibility = payload[1];\r\n    let level_idc = payload[2];\r\n    let golombBuffer = payload.subarray(3);\r\n    let //separate_colour_plane_flag = 0,\r\n        // qpprime_y_zero_transform_bypass_flag = 0,\r\n        seq_scaling_matrix_present_flag = 0;\r\n    let lmpoclmUEV;\r\n    let //delta_pic_order_always_zero_flag = 0,\r\n        ofnrpSEV,\r\n        ofttbfSEV,\r\n        nrfipoccUEV;\r\n    let pixelRatio: [number, number] = [1, 1],\r\n        pixelScale = 1;\r\n    let video_format: number;\r\n    let fps = 0,\r\n        num_units_in_tick: number,\r\n        time_scale: number,\r\n        fixed_frame_rate_flag: boolean = true;\r\n\r\n    // seq_parameter_set_id\r\n    let spsUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n    bitOffset += spsUEV.bitLength;\r\n\r\n    if (\r\n        profile_idc == 100 ||\r\n        profile_idc == 110 ||\r\n        profile_idc == 122 ||\r\n        profile_idc == 244 ||\r\n        profile_idc == 44 ||\r\n        profile_idc == 83 ||\r\n        profile_idc == 86 ||\r\n        profile_idc == 118 ||\r\n        profile_idc == 128\r\n    ) {\r\n        // chroma_format_idc\r\n        let chromaFIUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n        bitOffset += chromaFIUEV.bitLength;\r\n\r\n        if (chromaFIUEV.value == 3) {\r\n            // separate_colour_plane_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\r\n            bitOffset += 1;\r\n        }\r\n\r\n        // bit_depth_luma_minus8\r\n        let bitdlmUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n        bitOffset += bitdlmUEV.bitLength;\r\n\r\n        // bit_depth_chroma_minus8\r\n        let bitdcmUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n        bitOffset += bitdcmUEV.bitLength;\r\n\r\n        // qpprime_y_zero_transform_bypass_flag\r\n        // qpprime_y_zero_transform_bypass_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\r\n        bitOffset += 1;\r\n\r\n        // seq_scaling_matrix_present_flag\r\n        seq_scaling_matrix_present_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\r\n        bitOffset += 1;\r\n\r\n        if (seq_scaling_matrix_present_flag) {\r\n            for (let i = 0; i < (chromaFIUEV.value != 3 ? 8 : 12); i++) {\r\n                let seq_scaling_list_present_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\r\n                bitOffset += 1;\r\n\r\n                if (seq_scaling_list_present_flag) {\r\n                    if (i < 6) {\r\n                        scaling_list(golombBuffer, 16);\r\n                    } else {\r\n                        scaling_list(golombBuffer, 64);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // log2_max_frame_num_minus4\r\n    let lmfnmUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n    bitOffset += lmfnmUEV.bitLength;\r\n\r\n    // pic_order_cnt_type\r\n    let poctUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n    let pic_order_cnt_type = poctUEV.value;\r\n    bitOffset += poctUEV.bitLength;\r\n\r\n    if (pic_order_cnt_type === 0) {\r\n        // log2_max_pic_order_cnt_lsb_minus4\r\n        lmpoclmUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n        bitOffset += lmpoclmUEV.bitLength;\r\n    } else if (pic_order_cnt_type === 1) {\r\n        // delta_pic_order_always_zero_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\r\n        bitOffset += 1;\r\n\r\n        // offset_for_non_ref_pic\r\n        ofnrpSEV = ExpGolomb.readSEV(golombBuffer, bitOffset);\r\n        bitOffset += ofnrpSEV.bitLength;\r\n\r\n        // offset_for_top_to_bottom_field\r\n        ofttbfSEV = ExpGolomb.readSEV(golombBuffer, bitOffset);\r\n        bitOffset += ofttbfSEV.bitLength;\r\n\r\n        // num_ref_frames_in_pic_order_cnt_cycle\r\n        nrfipoccUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n        bitOffset += nrfipoccUEV.bitLength;\r\n\r\n        // let offset_for_ref_frames = [];\r\n        for (let i = 0, item; i < nrfipoccUEV.value; i++) {\r\n            item = ExpGolomb.readSEV(golombBuffer, bitOffset);\r\n            bitOffset += item.bitLength;\r\n\r\n            // offset_for_ref_frames.push(item);\r\n        }\r\n    }\r\n\r\n    // max_num_ref_frames\r\n    // 指定参考帧队列可能达到的最大长度，解码器依照这个句法元素的值开辟存储区，这个存储区用于存放已解码的参考帧，\r\n    // H.264 规定最多可用 16 个参考帧，本句法元素的值最大为 16。值得注意的是这个长度以帧为单位，如果在场模式下，应该相应地扩展一倍\r\n    let mnrfUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n    bitOffset += mnrfUEV.bitLength;\r\n\r\n    // gaps_in_frame_num_value_allowed_flag\r\n    // let gaps_in_frame_num_value_allowed_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\r\n    bitOffset += 1;\r\n\r\n    // pic_width_in_mbs_minus1\r\n    let picWidthUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n    bitOffset += picWidthUEV.bitLength;\r\n\r\n    // pic_height_in_map_units_minus1\r\n    let picHeightUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n    bitOffset += picHeightUEV.bitLength;\r\n\r\n    // frame_mbs_only_flag\r\n    // 本句法元素等于 1 时, 表示本序列中所有图像的编码模式都是帧编码；\r\n    // 本句法元素等于 0 时, 表示本序列中图像的编码模式可能是帧，也可能是场或帧场自适应，某个图像具体是哪一种要由其他句法元素决定。\r\n    let frame_mbs_only_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\r\n    bitOffset += 1;\r\n\r\n    if (!frame_mbs_only_flag) {\r\n        // mb_adaptive_frame_field_flag (Unused, Unnecessary to read it.)\r\n        // ExpGolomb.readBit(golombBuffer, bitOffset);\r\n        bitOffset += 1;\r\n    }\r\n\r\n    // direct_8x8_inference_flag,  用于指明 B 片的直接 和 skip 模式下运动矢量的预测方法\r\n    // let direct_8x8_inference_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\r\n    bitOffset += 1;\r\n\r\n    // frame_cropping_flag, 用于指明解码器是否要将图像裁剪后输出，如果是的话，后面紧跟着的四个句法元素分别指出左右、上下裁剪的宽度\r\n    let frame_cropping_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\r\n    bitOffset += 1;\r\n\r\n    let cropLeft = 0,\r\n        cropRight = 0,\r\n        cropTop = 0,\r\n        cropBottom = 0;\r\n    if (frame_cropping_flag) {\r\n        let fcloUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n        bitOffset += fcloUEV.bitLength;\r\n        cropLeft = fcloUEV.value;\r\n\r\n        let fcroUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n        bitOffset += fcroUEV.bitLength;\r\n        cropRight = fcroUEV.value;\r\n\r\n        let fctoUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n        bitOffset += fctoUEV.bitLength;\r\n        cropTop = fctoUEV.value;\r\n\r\n        let fcboUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n        bitOffset += fcboUEV.bitLength;\r\n        cropBottom = fcboUEV.value;\r\n    }\r\n\r\n    // vui_parameters_present_flag\r\n    let vui_parameters_present_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\r\n    bitOffset += 1;\r\n\r\n    if (vui_parameters_present_flag) {\r\n        // Annex E, E.1.1 VUI parameters syntax\r\n        // VUI 用以表征视频格式等额外信息\r\n        // aspect_ratio, video_format\r\n\r\n        let aspect_ratio_info_present_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\r\n        bitOffset += 1;\r\n\r\n        if (aspect_ratio_info_present_flag) {\r\n            const aspectRatioIdc = ExpGolomb.readByte(golombBuffer, bitOffset);\r\n            bitOffset += 8;\r\n\r\n            switch (aspectRatioIdc) {\r\n                case 1:\r\n                    pixelRatio = [1, 1];\r\n                    break;\r\n                case 2:\r\n                    pixelRatio = [12, 11];\r\n                    break;\r\n                case 3:\r\n                    pixelRatio = [10, 11];\r\n                    break;\r\n                case 4:\r\n                    pixelRatio = [16, 11];\r\n                    break;\r\n                case 5:\r\n                    pixelRatio = [40, 33];\r\n                    break;\r\n                case 6:\r\n                    pixelRatio = [24, 11];\r\n                    break;\r\n                case 7:\r\n                    pixelRatio = [20, 11];\r\n                    break;\r\n                case 8:\r\n                    pixelRatio = [32, 11];\r\n                    break;\r\n                case 9:\r\n                    pixelRatio = [80, 33];\r\n                    break;\r\n                case 10:\r\n                    pixelRatio = [18, 11];\r\n                    break;\r\n                case 11:\r\n                    pixelRatio = [15, 11];\r\n                    break;\r\n                case 12:\r\n                    pixelRatio = [64, 33];\r\n                    break;\r\n                case 13:\r\n                    pixelRatio = [160, 99];\r\n                    break;\r\n                case 14:\r\n                    pixelRatio = [4, 3];\r\n                    break;\r\n                case 15:\r\n                    pixelRatio = [3, 2];\r\n                    break;\r\n                case 16:\r\n                    pixelRatio = [2, 1];\r\n                    break;\r\n                case 255: {\r\n                    let width0 = ExpGolomb.readByte(golombBuffer, bitOffset);\r\n                    bitOffset += 8;\r\n                    let width1 = ExpGolomb.readByte(golombBuffer, bitOffset);\r\n                    bitOffset += 8;\r\n                    let height0 = ExpGolomb.readByte(golombBuffer, bitOffset);\r\n                    bitOffset += 8;\r\n                    let height1 = ExpGolomb.readByte(golombBuffer, bitOffset);\r\n                    bitOffset += 8;\r\n                    pixelRatio = [(width0 << 8) | width1, (height0 << 8) | height1];\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (pixelRatio) {\r\n                pixelScale = pixelRatio[0] / pixelRatio[1];\r\n            }\r\n\r\n            if (aspectRatioIdc === 255) {\r\n                // sar_width\r\n                bitOffset += 16;\r\n                // sar_height\r\n                bitOffset += 16;\r\n            }\r\n        }\r\n\r\n        let overscan_info_present_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\r\n        bitOffset += 1;\r\n\r\n        if (overscan_info_present_flag) {\r\n            bitOffset += 1;\r\n            // overscan_appropriate_flag;\r\n        }\r\n\r\n        let video_signal_type_present_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\r\n        bitOffset += 1;\r\n\r\n        if (video_signal_type_present_flag) {\r\n            /*\r\n                Table E-2 – Meaning of video_format\r\n                video_format    Meaning\r\n                0               Component\r\n                1               PAL\r\n                2               NTSC\r\n                3               SECAM\r\n                4               MAC\r\n                5               Unspecified video format\r\n                6               Reserved\r\n                7               Reserved\r\n             */\r\n            video_format = ExpGolomb.readBit(golombBuffer, bitOffset, 3);\r\n            bitOffset += 3;\r\n\r\n            // switch (video_format) {\r\n            // }\r\n\r\n            // let video_full_range_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\r\n            bitOffset += 1;\r\n\r\n            let colour_description_present_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\r\n            bitOffset += 1;\r\n\r\n            if (colour_description_present_flag) {\r\n                // colour_primaries            u(8)\r\n                // transfer_characteristics    u(8)\r\n                // matrix_coefficients         u(8)\r\n                bitOffset += 24;\r\n            }\r\n        }\r\n\r\n        let chroma_loc_info_present_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\r\n        bitOffset += 1;\r\n\r\n        if (chroma_loc_info_present_flag) {\r\n            let chroma_sample_loc_type_top_field = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n            bitOffset += chroma_sample_loc_type_top_field.bitLength;\r\n\r\n            let chroma_sample_loc_type_bottom_field = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n            bitOffset += chroma_sample_loc_type_bottom_field.bitLength;\r\n        }\r\n\r\n        let timing_info_present_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\r\n        bitOffset += 1;\r\n\r\n        if (timing_info_present_flag) {\r\n            num_units_in_tick = ExpGolomb.readBit(golombBuffer, bitOffset, 32);\r\n            bitOffset += 32;\r\n\r\n            time_scale = ExpGolomb.readBit(golombBuffer, bitOffset, 32);\r\n            bitOffset += 32;\r\n\r\n            fixed_frame_rate_flag = !!ExpGolomb.readBit(golombBuffer, bitOffset);\r\n            bitOffset += 1;\r\n\r\n            fps = time_scale / (num_units_in_tick * 2);\r\n        }\r\n\r\n        // There is left VUI other's parameters to be decoded ...\r\n        // For now, it is useless, so don't pass them.\r\n    }\r\n\r\n    // let FrameHeightInMbs = (2 - frame_mbs_only_flag) * (picHeightUEV.value + 1);\r\n    // PicSizeInMapUnits = PicWidthInMbs * PicHeightInMapUnits\r\n\r\n    return {\r\n        payload: golombBuffer,\r\n\r\n        profile_idc,\r\n        profile_compatibility,\r\n        level_idc,\r\n        sps_id: spsUEV.value, // ue(v)\r\n        log2_max_frame_num_minus4: poctUEV.value, // ue(v)\r\n        pic_order_cnt_type, // ue(v)\r\n        log2_max_pic_order_cnt_lsb_minus4: lmpoclmUEV ? lmpoclmUEV.value : 0, // ue(v)\r\n\r\n        width: Math.ceil(((picWidthUEV.value + 1) * 16 - cropLeft * 2 - cropRight * 2) * pixelScale), // PicWidthInSamplesL = PicWidthInMbs * 16\r\n        height: (2 - frame_mbs_only_flag) * (picHeightUEV.value + 1) * 16 - cropTop * 2 - cropBottom * 2,\r\n\r\n        pixelRatio,\r\n        video_format,\r\n\r\n        fps,\r\n        fixedFPS: fixed_frame_rate_flag\r\n    };\r\n}\r\n","/**\r\n * @file: pps.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\nimport ExpGolomb from '../../util/exp-golumb';\r\n\r\nexport type PPSProps = {\r\n    sliceGroupNum: number;\r\n};\r\n\r\n/**\r\n * decode (PPS)Picture parameter set\r\n * @param payload\r\n */\r\nexport function decodePPS(payload: Uint8Array): PPSProps {\r\n    let bitOffset = 0;\r\n\r\n    let golombBuffer = payload;\r\n    let //slice_group_change_direction_flag = 0,\r\n        sliceGroupIds = [];\r\n    let sgcdfUEV, picSizeUEV;\r\n    let i = 0;\r\n\r\n    // pic_parameter_set_id\r\n    let ppsUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n    bitOffset += ppsUEV.bitLength;\r\n\r\n    // seq_parameter_set_id\r\n    let spsUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n    bitOffset += spsUEV.bitLength;\r\n\r\n    // entropy_coding_mode_flag\r\n    // 0: Exp-Golomb coded, see subclause 9.1 or CAVLC, see subclause 9.2\r\n    // 1: CABAC, see subclause 9.3\r\n    // let entropy_coding_mode_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\r\n    bitOffset += 1;\r\n\r\n    // bottom_field_pic_order_in_frame_present_flag\r\n    // let bottom_field_pic_order_in_frame_present_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\r\n    bitOffset += 1;\r\n\r\n    // num_slice_groups_minus1,\r\n    let sliceGroupUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n    bitOffset += sliceGroupUEV.bitLength;\r\n\r\n    if (sliceGroupUEV.value > 0) {\r\n        // slice_group_map_type\r\n        let sgmtUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n        bitOffset += sgmtUEV.bitLength;\r\n\r\n        let iGroup = 0,\r\n            itemUev;\r\n\r\n        switch (sgmtUEV.value) {\r\n            case 0:\r\n                for (iGroup = 0; iGroup <= sgmtUEV.value; iGroup++) {\r\n                    // run_length_minus1\r\n                    itemUev = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n                    bitOffset += itemUev.bitLength;\r\n                }\r\n                break;\r\n            case 2:\r\n                for (iGroup = 0; iGroup <= sgmtUEV.value; iGroup++) {\r\n                    // top_left\r\n                    itemUev = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n                    bitOffset += itemUev.bitLength;\r\n                    // bottom_right\r\n                    itemUev = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n                    bitOffset += itemUev.bitLength;\r\n                }\r\n                break;\r\n            case 3:\r\n            case 4:\r\n            case 5:\r\n                // slice_group_change_direction_flag\r\n                // slice_group_change_direction_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\r\n                bitOffset += 1;\r\n                // slice_group_change_rate_minus1\r\n                sgcdfUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n                bitOffset += sgcdfUEV.bitLength;\r\n                break;\r\n            case 6:\r\n                {\r\n                    // pic_size_in_map_units_minus1\r\n                    picSizeUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n                    bitOffset += picSizeUEV.bitLength;\r\n\r\n                    let length = Math.ceil(Math.log2(sliceGroupUEV.value + 1));\r\n                    for (i = 0; i <= picSizeUEV.value; i++) {\r\n                        // pic_size_in_map_units_minus1\r\n                        sliceGroupIds.push(ExpGolomb.readBit(golombBuffer, bitOffset, length));\r\n                        bitOffset += length;\r\n                    }\r\n                }\r\n                break;\r\n        }\r\n    }\r\n\r\n    // num_ref_idx_l0_default_active_minus1\r\n    let nril0dcmUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n    bitOffset += nril0dcmUEV.bitLength;\r\n\r\n    // num_ref_idx_l1_default_active_minus1\r\n    let nril1dcmUEV = ExpGolomb.readUEV(golombBuffer, bitOffset);\r\n    bitOffset += nril1dcmUEV.bitLength;\r\n\r\n    // weighted_pred_flag\r\n    // let weighted_pred_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\r\n    bitOffset += 1;\r\n\r\n    // weighted_bipred_idc\r\n    // let weighted_bipred_idc = ExpGolomb.readBit(golombBuffer, bitOffset, 2);\r\n    bitOffset += 1;\r\n\r\n    // pic_init_qp_minus26\r\n    let piqpSEV = ExpGolomb.readSEV(golombBuffer, bitOffset);\r\n    bitOffset += piqpSEV.bitLength;\r\n    // pic_init_qs_minus26\r\n    let piqsSEV = ExpGolomb.readSEV(golombBuffer, bitOffset);\r\n    bitOffset += piqsSEV.bitLength;\r\n    // chroma_qp_index_offset\r\n    let cqioSEV = ExpGolomb.readSEV(golombBuffer, bitOffset);\r\n    bitOffset += cqioSEV.bitLength;\r\n\r\n    // let deblocking_filter_control_present_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\r\n    bitOffset += 1;\r\n    // let constrained_intra_pred_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\r\n    bitOffset += 1;\r\n    // let redundant_pic_cnt_present_flag = ExpGolomb.readBit(golombBuffer, bitOffset);\r\n    bitOffset += 1;\r\n\r\n    // if( more_rbsp_data( ) ) {\r\n    //     // Unused data...\r\n    // }\r\n\r\n    return {\r\n        sliceGroupNum: sliceGroupUEV.value + 1\r\n    };\r\n}\r\n","/**\r\n * @file: pps.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\nexport type SEIProps = {};\r\n\r\n/**\r\n * decode (SEI)Supplemental enhancement information\r\n * @param payload\r\n */\r\nexport function decodeSEI(payload: Uint8Array): SEIProps {\r\n    payload;\r\n    return {};\r\n}\r\n","/**\r\n * @file: nalu.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\nimport DataViewReader from '../../util/dv';\r\nimport NaluTypes from '../../enum/nalu-types';\r\nimport discardEP3B from './ep3b';\r\nimport { decodeSPS, SPSProps } from './sps';\r\nimport { decodePPS, PPSProps } from './pps';\r\nimport { decodeSEI, SEIProps } from './sei';\r\n\r\n/**\r\n * decode (AUD)Access unit delimiter\r\n * @param payload\r\n * @private\r\n */\r\nfunction _decodeAUD(payload: Uint8Array): number {\r\n    // var primary_pic_type_table = {\r\n    //     0x084, // 2, 7\r\n    //     0x0a5, // 0, 2, 5, 7\r\n    //     0x0e7, // 0, 1, 2, 5, 6, 7\r\n    //     0x210, // 4, 9\r\n    //     0x318, // 3, 4, 8, 9\r\n    //     0x294, // 2, 4, 7, 9\r\n    //     0x3bd, // 0, 2, 3, 4, 5, 7, 8, 9\r\n    //     0x3ff, // 0, 1, 2, 3, 4, 5, 6, 7, 8, 9\r\n    // }\r\n\r\n    return payload[0] >> 5;\r\n}\r\n\r\nexport default class NALU extends DataViewReader {\r\n    forbidden_zero_bit: number;\r\n    ref_idc: number;\r\n    unit_type: number;\r\n    data: Uint8Array;\r\n    rawData: Uint8Array;\r\n    sps: SPSProps;\r\n    pps: PPSProps;\r\n    sei: SEIProps;\r\n    primary_pic_type: number;\r\n    pts?: number;\r\n    dts?: number;\r\n\r\n    constructor(buffer: Uint8Array) {\r\n        super();\r\n\r\n        this.forbidden_zero_bit = buffer[0] >> 7;\r\n\r\n        // nalu priority.\r\n        this.ref_idc = (buffer[0] >> 5) & 0x03;\r\n\r\n        // specifies the type of RBSP data structure. see in mux-nalu-types.js\r\n        this.unit_type = buffer[0] & 0x1f;\r\n\r\n        this.data = discardEP3B(buffer.subarray(1));\r\n        this.rawData = buffer;\r\n\r\n        switch (this.unit_type) {\r\n            case NaluTypes.NON_IDR_SLICE:\r\n                break;\r\n            case NaluTypes.DPA_SLICE:\r\n            case NaluTypes.DPB_SLICE:\r\n            case NaluTypes.DPC_SLICE:\r\n                // TODO decode A/B/C Partition Slice.\r\n                break;\r\n            case NaluTypes.IDR_SLICE:\r\n                // this.data = decodeSlice(this.data).data;\r\n                break;\r\n            case NaluTypes.SPS:\r\n                this.sps = decodeSPS(this.data);\r\n                break;\r\n            case NaluTypes.PPS:\r\n                this.pps = decodePPS(this.data);\r\n                break;\r\n            case NaluTypes.SEI:\r\n                this.sei = decodeSEI(this.data);\r\n                break;\r\n            case NaluTypes.AUD:\r\n                this.primary_pic_type = _decodeAUD(this.data);\r\n                break;\r\n        }\r\n    }\r\n}\r\n","/**\r\n * @file: avc.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\n/**\r\n * h.264/AVC codec\r\n */\r\nimport CacheBuffer from '../util/cache-buffer';\r\nimport EventEmitter from '../util/event-emitter';\r\nimport logger from '../util/logger';\r\nimport NALU from './avc/nalu';\r\n\r\nexport type AVCCodecData = {\r\n    pts: number;\r\n    dts: number;\r\n    naluSizeLength?: number;\r\n    payload: Uint8Array;\r\n};\r\n\r\nexport interface AVCDecoderConfigurationRecord {\r\n    version: number;\r\n    profile: number;\r\n    profileCompatibility: number;\r\n    level: number;\r\n    naluSizeLength: number;\r\n    spsNalus: Uint8Array[];\r\n    ppsNalus: Uint8Array[];\r\n}\r\n\r\ntype ParsePesState = 0 | 1 | 2 | 3;\r\n\r\nexport class AVCCodec extends EventEmitter {\r\n    private lastState: ParsePesState = null;\r\n    private lastNALu: NALU = null;\r\n    private lastNALuState: ParsePesState = null;\r\n\r\n    private spitNalu_(bytes: Uint8Array, pts: number, dts: number) {\r\n        let nalu: NALU = new NALU(bytes);\r\n\r\n        nalu.pts = pts;\r\n        nalu.dts = dts;\r\n\r\n        this.lastNALu = nalu;\r\n        this.emit('nalu', nalu);\r\n    }\r\n\r\n    push(data: AVCCodecData) {\r\n        const { lastState, lastNALuState } = this;\r\n        let i = 0,\r\n            lastNALuOffset = -1,\r\n            { pts, dts, payload, naluSizeLength } = data;\r\n\r\n        if (!naluSizeLength) {\r\n            // Start parse Annex-B Byte stream format\r\n            let j = payload.byteLength - 1;\r\n            let dropZerosLength = 0;\r\n\r\n            // Collect tailing zeros.\r\n            // end with 0x000000 and more...\r\n            do {\r\n                if (payload[j] === 0x00) {\r\n                    dropZerosLength++;\r\n                } else {\r\n                    break;\r\n                }\r\n\r\n                j--;\r\n            } while (j > 0);\r\n\r\n            if (dropZerosLength >= 3) {\r\n                // drop tailing zeros.\r\n                payload = payload.subarray(0, j + 1);\r\n            }\r\n\r\n            const len = payload.length;\r\n\r\n            let state: ParsePesState = 0;\r\n            do {\r\n                let value = payload[i++];\r\n\r\n                // loop optimization.\r\n                if (state === 0) {\r\n                    state = value ? 0 : 1;\r\n                    continue;\r\n                } else if (state === 1) {\r\n                    state = value ? 0 : 2;\r\n                    continue;\r\n                }\r\n\r\n                // value will be 2 or 3\r\n                if (!value) {\r\n                    state = 3;\r\n                } else if (value === 1) {\r\n                    if (lastNALuOffset >= 0) {\r\n                        this.lastNALuState = state;\r\n                        this.spitNalu_(payload.subarray(lastNALuOffset, i - 1 - state), pts, dts);\r\n                    } else {\r\n                        // naluOffset is undefined => this is the first start code found in this PES packet\r\n                        // first check if start code delimiter is overlapping between 2 PES packets,\r\n                        // ie it started in last packet (lastState not zero)\r\n                        // and ended at the beginning of this PES packet (i <= 4 - lastState)\r\n                        const lastUnit = this.lastNALu;\r\n                        if (lastUnit) {\r\n                            if (lastState && i <= 4 - lastState) {\r\n                                // start delimiter overlapping between PES packets\r\n                                // strip start delimiter bytes from the end of last NAL unit\r\n                                // check if lastUnit had a state different from zero\r\n                                if (lastNALuState) {\r\n                                    // strip last bytes\r\n                                    lastUnit.rawData = lastUnit.rawData.subarray(\r\n                                        0,\r\n                                        lastUnit.rawData.byteLength - lastState\r\n                                    );\r\n                                }\r\n                            }\r\n\r\n                            // If NAL units are not starting right at the\r\n                            // beginning of the PES packet, push preceding data\r\n                            // into previous NAL unit.\r\n                            let overflow = i - state - 1;\r\n                            if (overflow > 0) {\r\n                                logger.log(`overflow NALU found: ${overflow}/${pts}/${dts}`);\r\n                                let cb = new CacheBuffer();\r\n\r\n                                cb.append(lastUnit.rawData);\r\n                                cb.append(payload.subarray(0, overflow));\r\n                                let bytes = cb.toNewBytes();\r\n                                cb.clear(); // gc\r\n\r\n                                lastUnit.rawData = bytes;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // reset state & record last unit start byte offset.\r\n                    if (i < len) {\r\n                        // console.log(`'find NALU @ offset: ${i}`);\r\n                        lastNALuOffset = i;\r\n                        state = 0;\r\n                    }\r\n                } else {\r\n                    state = 0;\r\n                }\r\n            } while (i < len);\r\n\r\n            if (lastNALuOffset >= 0 && state >= 0) {\r\n                this.lastNALuState = state;\r\n                this.spitNalu_(payload.subarray(lastNALuOffset, len), pts, dts);\r\n            }\r\n\r\n            this.lastState = state;\r\n        } else {\r\n            let startPos = 0,\r\n                size = 0,\r\n                endPos = 0,\r\n                byteLength = payload.length;\r\n            do {\r\n                size = 0;\r\n                for (let k = 0; k < naluSizeLength; k++) {\r\n                    size = size | (payload[startPos + k] << ((naluSizeLength - k - 1) * 8));\r\n                }\r\n                // size = (data_byte[i] << 24) | (data_byte[i + 1] << 16) | (data_byte[i + 2] << 8) | data_byte[i + 3];\r\n                startPos += naluSizeLength;\r\n                endPos = startPos + size;\r\n                if (endPos > byteLength) {\r\n                    endPos = byteLength;\r\n                }\r\n\r\n                this.spitNalu_(payload.subarray(startPos, endPos), pts, dts);\r\n                startPos = endPos;\r\n            } while (startPos < byteLength);\r\n        }\r\n\r\n        this.emit('done');\r\n    }\r\n\r\n    reset() {\r\n        this.lastState = null;\r\n        this.lastNALu = null;\r\n        this.lastNALuState = null;\r\n    }\r\n}\r\n","/**\r\n * @file: avc-config.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\nimport { SPSProps } from './sps';\r\n// import { PPSProps } from './pps';\r\n\r\n/**\r\n * AVC Config Helper\r\n * Accord sps/pps, generate mimeType info.\r\n */\r\nexport default (sps: SPSProps /*, pps?: PPSProps*/) => {\r\n    let profile_idc = sps.profile_idc;\r\n    let profile_compatibility = sps.profile_compatibility;\r\n    let level_idc = sps.level_idc;\r\n    let codecString = 'avc1.';\r\n\r\n    let arr = [profile_idc, profile_compatibility, level_idc];\r\n    for (let j = 0; j < arr.length; j++) {\r\n        let h = arr[j].toString(16);\r\n        if (h.length < 2) {\r\n            h = '0' + h;\r\n        }\r\n        codecString += h;\r\n    }\r\n\r\n    return {\r\n        codec: codecString\r\n    };\r\n};\r\n","/**\r\n * @file: avc.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\n/**\r\n * H.264/AVC/HEVC Stream.\r\n */\r\nimport { AVCCodec, AVCCodecData } from '../../codec/avc';\r\nimport getAVCConfig from '../../codec/avc/avc-config';\r\nimport NALU from '../../codec/avc/nalu';\r\nimport NaluTypes from '../../enum/nalu-types';\r\nimport { StreamTypes } from '../../enum/stream-types';\r\nimport logger from '../../util/logger';\r\nimport Stream from '../../util/stream';\r\nimport { PSI } from '../psi';\r\nimport { AVCFrame, GOP, GOPVector, PESStreamEmitData } from '../types/pipeline';\r\n\r\nclass H264Stream extends Stream {\r\n    private PSI: PSI;\r\n    private trackId?: number;\r\n    private currentFrame: AVCFrame;\r\n    private prevFrame: AVCFrame;\r\n    private codec: AVCCodec;\r\n    private gop: GOP;\r\n    private gops: GOPVector;\r\n\r\n    constructor(psi: PSI) {\r\n        super();\r\n\r\n        this.PSI = psi;\r\n        this.trackId = null;\r\n\r\n        /** @private {Array} */\r\n        this.currentFrame = []; // a group of nalu\r\n\r\n        /** @private {AVCCodec} */\r\n        this.codec = new AVCCodec();\r\n\r\n        this._newGop();\r\n        this._newGops();\r\n\r\n        this.codec.on('nalu', (nalu: NALU) => {\r\n            if (nalu.unit_type === NaluTypes.SPS) {\r\n                let track = this.PSI.findTrack(this.trackId);\r\n                let config = getAVCConfig(nalu.sps);\r\n\r\n                // write sps info to video track.\r\n                track.codec = config.codec;\r\n                track.width = nalu.sps.width;\r\n                track.height = nalu.sps.height;\r\n                track.profileIdc = nalu.sps.profile_idc;\r\n                track.profileCompatibility = nalu.sps.profile_compatibility;\r\n                track.levelIdc = nalu.sps.level_idc;\r\n                track.pixelRatio = nalu.sps.pixelRatio;\r\n                track.sps = [nalu.rawData];\r\n            } else if (nalu.unit_type === NaluTypes.PPS) {\r\n                let track = this.PSI.findTrack(this.trackId);\r\n                track.pps = [nalu.rawData];\r\n            }\r\n\r\n            this._grouping(nalu);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Push a complete pes\r\n     * @param data\r\n     */\r\n    push(data: PESStreamEmitData) {\r\n        const { stream_type, pes, pid } = data;\r\n        if (stream_type === StreamTypes.H264 || stream_type === StreamTypes.HEVC) {\r\n            this.trackId = pid;\r\n\r\n            let rawData: AVCCodecData = {\r\n                pts: pes.PTS,\r\n                dts: pes.DTS,\r\n                payload: pes.data_byte\r\n            };\r\n\r\n            this.codec.push(rawData);\r\n        }\r\n    }\r\n\r\n    flush() {\r\n        // Push last frame into gop.\r\n        if (this.currentFrame.length > 0) {\r\n            // If the last frame has valid duration, use the duration of the previous frame\r\n            if (!this.currentFrame.duration || this.currentFrame.duration <= 0) {\r\n                this.currentFrame.duration = this.prevFrame.duration || 0;\r\n            }\r\n\r\n            this._pushFrameIntoGop();\r\n            this.currentFrame = [];\r\n        }\r\n\r\n        // Push last gop.\r\n        if (this.gop.length > 0) {\r\n            this._pushGopIntoGroup();\r\n        }\r\n    }\r\n\r\n    reset() {\r\n        this.codec.reset();\r\n\r\n        this.currentFrame = [];\r\n        this._newGop();\r\n        this._newGops();\r\n    }\r\n\r\n    /**\r\n     * Group nalu into frame & gop.\r\n     * @param currentNal\r\n     * @private\r\n     */\r\n    _grouping(currentNal) {\r\n        if (currentNal.unit_type === NaluTypes.AUD) {\r\n            if (this.currentFrame.length > 0) {\r\n                this.currentFrame.duration = currentNal.dts - this.currentFrame.dts;\r\n\r\n                if (this.gop.length > 0 && this.currentFrame.keyframe) {\r\n                    this.gop.trackId = this.trackId;\r\n\r\n                    this._pushGopIntoGroup();\r\n                }\r\n\r\n                // the gop should commence with a key frame,\r\n                // or the frame will be dropped until finding one that contains a key frame.\r\n                if (this.currentFrame.keyframe || this.gop.length > 0) {\r\n                    this._pushFrameIntoGop();\r\n                } else {\r\n                    logger.warn(`h264 codec drop frame`);\r\n                }\r\n            }\r\n\r\n            this.prevFrame = this.currentFrame;\r\n\r\n            // end a frame.\r\n            this.currentFrame = [];\r\n            this.currentFrame.keyframe = false;\r\n            this.currentFrame.byteLength = 0;\r\n            this.currentFrame.naluCount = 0;\r\n            this.currentFrame.pts = currentNal.pts;\r\n            this.currentFrame.dts = currentNal.dts;\r\n        } else {\r\n            if (currentNal.unit_type === NaluTypes.IDR_SLICE) {\r\n                this.currentFrame.keyframe = true;\r\n            }\r\n\r\n            this.currentFrame.byteLength += currentNal.rawData.byteLength;\r\n            this.currentFrame.naluCount++;\r\n            this.currentFrame.push(currentNal);\r\n        }\r\n\r\n        this.currentFrame.duration = currentNal.dts - this.currentFrame.dts;\r\n    }\r\n\r\n    _newGop() {\r\n        this.gop = []; // a group of idr-start-frame sequence\r\n\r\n        this.gop.duration = 0;\r\n        this.gop.naluCount = 0;\r\n        this.gop.byteLength = 0;\r\n    }\r\n\r\n    _pushFrameIntoGop() {\r\n        // Gop\r\n        this.gop.push(this.currentFrame);\r\n        this.gop.duration += this.currentFrame.duration;\r\n        this.gop.byteLength += this.currentFrame.byteLength;\r\n        this.gop.naluCount += this.currentFrame.naluCount;\r\n    }\r\n\r\n    _newGops() {\r\n        this.gops = []; // a group of gop\r\n        this.gops.type = 'video';\r\n        this.gops.duration = 0;\r\n        this.gops.naluCount = 0;\r\n        this.gops.byteLength = 0;\r\n        this.gops.frameLength = 0;\r\n        this.gops.firstDTS = 0;\r\n    }\r\n\r\n    _pushGopIntoGroup() {\r\n        let firstFrame = this.gop[0];\r\n        // GOPs\r\n        this.gops.trackId = this.trackId;\r\n        this.gops.duration += this.gop.duration;\r\n        this.gops.byteLength += this.gop.byteLength;\r\n        this.gops.naluCount += this.gop.naluCount;\r\n        this.gops.frameLength += this.gop.length;\r\n        this.gops.firstDTS = firstFrame.dts;\r\n        this.gops.firstPTS = firstFrame.pts;\r\n\r\n        this.gops.push(this.gop);\r\n\r\n        this.emit('data', this.gops);\r\n\r\n        this._newGop();\r\n        this._newGops();\r\n\r\n        this.emit('done');\r\n    }\r\n}\r\n\r\nexport default H264Stream;\r\n","/**\r\n * @file: elementary.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\n/**\r\n * Elementary Stream.\r\n * @summary An elementary stream (ES) as defined by the MPEG communication protocol is usually the output of an audio or video encoder.\r\n *      ES contains only one kind of data, e.g. audio, video or closed caption.\r\n * @description  https://en.wikipedia.org/wiki/Elementary_stream\r\n */\r\nimport { StreamTypes } from '../../enum/stream-types';\r\nimport { Context, GlobalOptions } from '../../types/globals';\r\nimport { isNumber } from '../../util/is';\r\nimport logger from '../../util/logger';\r\nimport Stream from '../../util/stream';\r\nimport { PSI } from '../psi';\r\nimport { PESStreamEmitData, GOPVector } from '../types/pipeline';\r\nimport ADTSStream from './adts';\r\nimport AVCStream from './avc';\r\n\r\nclass ElementaryStream extends Stream {\r\n    private context: Context;\r\n    private PSI: PSI;\r\n    private options: GlobalOptions;\r\n    private tracks: Array<GOPVector>;\r\n    private adtsStream: ADTSStream;\r\n    private avcStream: AVCStream;\r\n    private streams: [ADTSStream, AVCStream];\r\n\r\n    constructor(ctx: Context, psi: PSI, options: GlobalOptions = {}) {\r\n        super();\r\n\r\n        this.context = ctx;\r\n        this.PSI = psi;\r\n        this.options = options;\r\n        this.tracks = [];\r\n        this.adtsStream = new ADTSStream(psi);\r\n        this.avcStream = new AVCStream(psi);\r\n        this.streams = [this.adtsStream, this.avcStream];\r\n\r\n        if (options.decodeCodec) {\r\n            this.avcStream.on('data', (data: GOPVector) => {\r\n                let stubTime = options.config.stubTime;\r\n\r\n                if (isNumber(stubTime)) {\r\n                    let end = (data.firstPTS + data.duration) / 90000;\r\n                    if (end < stubTime) {\r\n                        logger.warn(`drop avc gop, start/end/stubTime(${data.firstPTS}/${end}/${stubTime})`);\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                this.tracks.push(data);\r\n                this.emit('data', this.tracks);\r\n                this.tracks = [];\r\n                this.adtsStream.flush();\r\n            });\r\n\r\n            this.adtsStream.on('data', (data) => {\r\n                let stubTime = options.config.stubTime;\r\n\r\n                if (isNumber(stubTime)) {\r\n                    let end = (data.firstPTS + data.duration) / 90000;\r\n                    if (end < stubTime) {\r\n                        logger.warn(`drop adts, start/end/stubTime(${data.firstPTS}/${end}/${stubTime})`);\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                this.tracks.push(data);\r\n                this.emit('data', this.tracks);\r\n                this.tracks = [];\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Push a complete pes\r\n     * @param data\r\n     */\r\n    push(data: PESStreamEmitData): void {\r\n        const { options, adtsStream, avcStream } = this;\r\n        let { stream_type } = data;\r\n\r\n        if (options.decodeCodec) {\r\n            switch (stream_type) {\r\n                case StreamTypes.H264:\r\n                case StreamTypes.HEVC:\r\n                    avcStream.push(data);\r\n                    break;\r\n                case StreamTypes.ADTS:\r\n                    adtsStream.push(data);\r\n                    break;\r\n                default:\r\n                    logger.warn(`ts elementary encounter unknown stream type ${stream_type}`);\r\n            }\r\n        } else {\r\n            this.emit('data', data);\r\n        }\r\n    }\r\n\r\n    flush(): void {\r\n        let { streams, tracks } = this;\r\n        for (let i = 0; i < this.streams.length; i++) {\r\n            let stream = streams[i];\r\n\r\n            stream.flush();\r\n        }\r\n\r\n        if (tracks.length > 0) {\r\n            this.emit('data', tracks);\r\n        }\r\n\r\n        this.emit('done');\r\n\r\n        tracks.splice(0, tracks.length);\r\n    }\r\n\r\n    reset(): void {\r\n        this.tracks = [];\r\n\r\n        for (let i = 0; i < this.streams.length; i++) {\r\n            let stream = this.streams[i];\r\n\r\n            stream.reset();\r\n        }\r\n\r\n        this.emit('reset');\r\n    }\r\n}\r\n\r\nexport default ElementaryStream;\r\n","/**\r\n * @file: pes.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\n/**\r\n * Structure for Pes.\r\n */\r\nexport class Pes {\r\n    // private start_code_prefix: number;\r\n    // stream_id: number;\r\n    // packet_length: number;\r\n    // data_alignment_indicator: number;\r\n    // copyright: number;\r\n    // ESCR_flag: number;\r\n    // ES_rate_flag: number;\r\n    // trick_mode_flag: number;\r\n    // additional_copy_info_flag: number;\r\n    // CRC_flag: number;\r\n    // extension_flag: number;\r\n    PTS: number;\r\n    DTS: number;\r\n    data_byte: Uint8Array;\r\n\r\n    constructor(buffer: Uint8Array) {\r\n        // The packet_start_code_prefix is a 24-bit code.\r\n        // this.start_code_prefix = (buffer[0] << 16) | (buffer[1] << 8) | buffer[2];\r\n\r\n        // In Transport Streams,\r\n        // the stream_id may be set to any valid value which correctly describes the elementary stream type.\r\n        // the elementary stream type is specified in the PSI(Program Specific Information).\r\n        // this.stream_id = buffer[3];\r\n\r\n        // A 16-bit field specifying the number of bytes in the PES packet.\r\n        // this.packet_length = (buffer[4] << 8) | buffer[5];\r\n\r\n        // this.data_alignment_indicator = buffer[6] & 0x04;\r\n\r\n        // this.copyright = buffer[6] & 0x02;\r\n\r\n        // PTS (presentation time stamp)\r\n        // DTS (decoding time stamp)\r\n        let PTS_DTS_flags = buffer[7] >> 6;\r\n\r\n        // ESCR (Elementary Stream Clock Reference system):\r\n        // A time stamp in the PES Stream from which decoders of PES streams may derive timing.\r\n        // this.ESCR_flag = buffer[7] & 0x20;\r\n\r\n        // this.ES_rate_flag = buffer[7] & 0x10;\r\n\r\n        // this.trick_mode_flag = buffer[7] & 0x08;\r\n\r\n        // this.additional_copy_info_flag = buffer[7] & 0x04;\r\n\r\n        // this.CRC_flag = buffer[7] & 0x02;\r\n\r\n        // this.extension_flag = buffer[7] & 0x01;\r\n\r\n        let header_data_length = buffer[8];\r\n\r\n        this.PTS = 0;\r\n        if ((PTS_DTS_flags & 0x02) == 0x02) {\r\n            this.PTS = this.calcTimestamp_(buffer, 9);\r\n        }\r\n\r\n        // if there is no dts, let DTS=PTS\r\n        // See Annex D - D.0.2 Audio and Video Presentation Synchronization\r\n        this.DTS = this.PTS;\r\n\r\n        if ((PTS_DTS_flags & 0x01) == 0x01) {\r\n            this.DTS = this.calcTimestamp_(buffer, 14);\r\n        }\r\n\r\n        // if (this.ESCR_flag === 1) {\r\n        // }\r\n        //\r\n        // if (this.ES_rate_flag === 1) {\r\n        // }\r\n        //\r\n        //\r\n        // if (this.trick_mode_flag === 1) {\r\n        //\r\n        // }\r\n        //\r\n        // if (this.ESCR_flag === 1) {\r\n        // }\r\n\r\n        this.data_byte = buffer.subarray(9 + header_data_length);\r\n\r\n        // this.isStartPes = (buffer[0] << 16 | buffer[1] << 8 | buffer[2]) & 0xffffff === 0x000001;\r\n    }\r\n\r\n    /**\r\n     * @param buffer\r\n     * @param start\r\n     */\r\n    private calcTimestamp_(buffer: Uint8Array, start: number): number {\r\n        // PTS / DTS is 33 bit\r\n        return (\r\n            // JS Bitwise operators treat their operands as a sequence of 32 bits,\r\n            // We cannot use bitwise operator in JS beyond 32bits\r\n            (buffer[start] & 0x0e) * 536870912 + // Math.pow(2, 29) === 536870912\r\n            (buffer[start + 1] << 22) +\r\n            ((buffer[start + 2] >> 1) << 15) +\r\n            (buffer[start + 3] << 7) +\r\n            (buffer[start + 4] >> 1)\r\n        );\r\n    }\r\n\r\n    // valid(): boolean {\r\n    //     let start_code_prefix = this.start_code_prefix;\r\n\r\n    //     return (\r\n    //         start_code_prefix[0] === 0x00 &&\r\n    //         start_code_prefix[1] === 0x00 &&\r\n    //         start_code_prefix[2] === 0x01\r\n    //     );\r\n    // }\r\n}\r\n","/**\r\n * @file: pes.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\n/**\r\n * Packetized Elementary Stream.\r\n */\r\nimport { Context } from '../../types/globals';\r\nimport CacheBuffer from '../../util/cache-buffer';\r\nimport Stream from '../../util/stream';\r\nimport { PSI } from '../psi';\r\nimport { Packet } from '../structs/packet';\r\nimport { Pes } from '../structs/pes';\r\nimport { PESStreamEmitData } from '../types/pipeline';\r\n\r\nclass PesStream extends Stream {\r\n    private context: Context;\r\n    private PSI: PSI;\r\n    private PID?: number;\r\n    private cache_buffer: CacheBuffer;\r\n\r\n    constructor(ctx: Context, psi: PSI) {\r\n        super();\r\n\r\n        this.context = ctx;\r\n        this.PSI = psi;\r\n        this.PID = null;\r\n        this.cache_buffer = new CacheBuffer();\r\n    }\r\n\r\n    /**\r\n     * @param packet\r\n     */\r\n    push(packet: Packet) {\r\n        const self = this;\r\n\r\n        // PES PID\r\n        // 0x20 - 0xff is reserved for dvb etc. (https://en.wikipedia.org/wiki/Program-specific_information#PSI_labels)\r\n        // but this is not strict restriction.\r\n        if (packet.PID > 0x001f && packet.PID < 0x1fff) {\r\n            if (this.PSI.currentProgramPID == -1) {\r\n                self._pushPacket(packet);\r\n            } else if (this.PSI.currentProgramPID !== packet.PID) {\r\n                if (packet.payload_unit_start_indicator === 1) {\r\n                    self._assembleOnePES();\r\n                }\r\n\r\n                self._pushPacket(packet);\r\n            }\r\n        }\r\n    }\r\n\r\n    flush() {\r\n        const self = this;\r\n\r\n        // 组装最后一个PES\r\n        self._assembleOnePES();\r\n\r\n        self.emit('done');\r\n    }\r\n\r\n    reset() {\r\n        this._clearCached();\r\n\r\n        this.emit('reset');\r\n    }\r\n\r\n    _clearCached() {\r\n        this.PID = null;\r\n        this.cache_buffer.clear();\r\n    }\r\n\r\n    _pushPacket(p) {\r\n        let empty = this.cache_buffer.empty;\r\n\r\n        // Make first packet in cache is start unit.\r\n        if (empty && p.payload_unit_start_indicator === 0) {\r\n            return;\r\n        }\r\n\r\n        if (empty) {\r\n            this.PID = p.PID;\r\n        }\r\n\r\n        this.cache_buffer.append(p.payload);\r\n    }\r\n\r\n    _assembleOnePES() {\r\n        const self = this;\r\n\r\n        if (!this.cache_buffer.empty) {\r\n            let bytes;\r\n\r\n            try {\r\n                bytes = this.cache_buffer.toNewBytes();\r\n            } catch (e) {\r\n                throw `pes alloc mem err ${this.cache_buffer.byteLength}`;\r\n            }\r\n\r\n            let pesData = new Pes(bytes);\r\n            let track = this.PSI.findTrack(this.PID);\r\n\r\n            // console.log(`stream_id: ${pesData.stream_id}, PTS: ${pesData.PTS}, DTS: ${pesData.DTS}`);\r\n\r\n            if (track) {\r\n                let data: PESStreamEmitData = {\r\n                    pid: track.id,\r\n                    stream_type: track.stream_type,\r\n                    // pcr_pid: track.pcr_pid,\r\n                    pes: pesData\r\n                };\r\n                // Assemble one pes packet, emit it to next stream.\r\n                self.emit('data', data);\r\n            }\r\n\r\n            self._clearCached();\r\n        }\r\n    }\r\n}\r\n\r\nexport default PesStream;\r\n","/**\r\n * @file: packet.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\nconst SYNC_BYTE = 0x47; // The sync_byte is a fixed 8-bit field whose value is '0100 0111' (0x47).\r\n\r\n/**\r\n * packet structure.\r\n */\r\nexport class Packet {\r\n    sync_byte: number;\r\n    // transport_error_indicator: number;\r\n    payload_unit_start_indicator: number;\r\n    // transport_priority: number;\r\n    PID: number;\r\n    // tsc: number;\r\n    afc: number;\r\n    // continuity_counter: number;\r\n    has_payload: number;\r\n    has_adaptation: number;\r\n    // is_discontinuity: boolean;\r\n    payload: Uint8Array;\r\n\r\n    /**\r\n     * @param buffer\r\n     */\r\n    constructor(buffer: Uint8Array) {\r\n        this.sync_byte = buffer[0];\r\n\r\n        // this.transport_error_indicator = buffer[1] >> 7;\r\n\r\n        // Indicating transport stream packets carry PES packets or PSI data\r\n        // PES: 1 -> commence with the first byte of a PES packet,  0 -> no PES packet shall start in this packet.\r\n        // PSI: 1 -> carries the first byte of a PSI section, 0 -> no pointer_field in the payload.\r\n        this.payload_unit_start_indicator = (buffer[1] >> 6) & 1;\r\n\r\n        // this.transport_priority = (buffer[1] >>> 5) & 1;\r\n\r\n        // The PID(Packet ID) is a 13-bit field, indicating the type of the data stored in the packet payload.\r\n        // NOTE – The transport packets with PID values 0x0000, 0x0001, and 0x0010-0x1FFE are allowed to carry a PCR.\r\n        // ISO/IEC 13818-1 : 2000 (E)\r\n        // Value                  Description\r\n        // 0x0000                 Program Association Table\r\n        // 0x0001                 Conditional Access Table\r\n        // 0x0002                 Transport Stream Description Table\r\n        // 0x0003-0x000F          Reserved\r\n        // 0x0010 ... 0x1FFE      May be assigned as network_PID, Program_map_PID, elementary_PID, or for other purposes\r\n        // https://www.dvb.org/resources/public/standards/a38_dvb-si_specification.pdf\r\n        // 0x0040                 Network_information_section-actual_network\r\n        // 0x0041                 Network_information_section-other_network\r\n        // 0x0042                 Service_description_section-actual_transport_stream\r\n        // 0x0043                 TO 0x45 Reserved for future use\r\n        // 0x0046                 Service_description_section-other_transport_stream\r\n        // 0x0047                 TO 0x49 Reserved for future use\r\n        // 0x004A                 Bouquet_association_section\r\n        // 0x004B                 TO 0x4D Reserved for future use\r\n        // 0x004E                 Event_information_section-actual_transport_stream,P/F\r\n        // 0x004F                 Event_information_section-other_transport_stream,P/F\r\n        // 0x0050                 TO 0x5F Event_information_section-actual_transport_stream,schedule\r\n        // 0x0060                 TO 0x6F Event_information_section-other_transport_stream,schedule\r\n        // 0x0070                 Time_data_section\r\n        // 0x0071                 Running_status_section\r\n        // 0x0072                 Stuffing_section\r\n        // 0x0073                 Time_offset_section\r\n        // 0x0074                 TO 0x007D Reserved for future use\r\n        // 0x007E                 Discontinuity_information_section\r\n        // 0x007F                 Selection_information_section\r\n        // 0x0080                 TO 0x00FE User defined\r\n        // 0x00FF                 Reserved\r\n        // 0x1FFF                 Null packet\r\n        this.PID = ((buffer[1] << 8) | buffer[2]) & 0x1fff;\r\n\r\n        // transport_scrambling_control\r\n        // this.tsc = buffer[3] >> 6;\r\n\r\n        // adaptation_field_control\r\n        // Value  Description\r\n        // 00     Reserved for future use by ISO/IEC\r\n        // 01     No adaptation_field, payload only\r\n        // 10     Adaptation_field only, no payload\r\n        // 11     Adaptation_field followed by payload\r\n        this.afc = (buffer[3] >> 4) & 3;\r\n\r\n        // '1' indicates that the discontinuity state is true for the current Transport Stream packet.\r\n        // this.continuity_counter = buffer[3] & 0xf;\r\n\r\n        // self defines.\r\n        this.has_payload = this.afc & 1;\r\n        this.has_adaptation = this.afc & 2;\r\n        // this.is_discontinuity = this.has_adaptation && buffer[4] != 0 /* with length > 0 */ && buffer[5] & 0x80;\r\n        /* and discontinuity indicated */\r\n\r\n        if (this.has_payload) {\r\n            if (this.has_adaptation) {\r\n                let adaptation_field_length = buffer[4];\r\n                this.payload = buffer.subarray(5 + adaptation_field_length);\r\n            } else {\r\n                this.payload = buffer.subarray(4);\r\n            }\r\n        }\r\n    }\r\n\r\n    valid() {\r\n        return this.sync_byte === SYNC_BYTE && this.has_payload === 1;\r\n    }\r\n}\r\n","/**\r\n * @file: demux.js, created at Monday, 23rd December 2019 3:47:23 pm\r\n * @copyright Copyright (c) 2020\r\n * @author gem <gems.xu@gmail.com>\r\n */\r\n\r\n/**\r\n * MPEG-2 transport stream demuxer.\r\n */\r\nimport DemuxFacade from '../demux-facade';\r\nimport muxErrorCode from '../mux-error-code';\r\nimport { GlobalOptions, PushConf } from '../types/globals';\r\nimport logger from '../util/logger';\r\nimport { PSI } from './psi';\r\nimport M2TSComplexStream from './streams/complex';\r\nimport ElementaryStream from './streams/elementary';\r\nimport PesStream from './streams/pes';\r\nimport { Packet } from './structs/packet';\r\n\r\nconst CHUNK_BYTE_LENGTH = 188; // Transport Stream chunks shall be 188 bytes long.\r\n\r\ntype InterfaceStream = M2TSComplexStream | ElementaryStream;\r\n\r\nexport class TSDemux extends DemuxFacade {\r\n    private psi_: PSI;\r\n    private pesStream_: PesStream;\r\n    private elementaryStream_: ElementaryStream;\r\n    private complexStream_: M2TSComplexStream;\r\n\r\n    constructor(options: GlobalOptions = {}) {\r\n        super(options);\r\n\r\n        this.psi_ = new PSI();\r\n        this.pesStream_ = new PesStream(this.ctx_, this.psi_);\r\n        this.elementaryStream_ = new ElementaryStream(this.ctx_, this.psi_, options);\r\n        this.complexStream_ = new M2TSComplexStream(this.ctx_, this.psi_);\r\n\r\n        // Compose pipeline\r\n        this.pipe(this.pesStream_);\r\n        this.pesStream_.pipe(this.elementaryStream_);\r\n        this.elementaryStream_.pipe(this.complexStream_);\r\n\r\n        super.listenEndStream_();\r\n    }\r\n\r\n    /**\r\n     * This is end pipeline stream\r\n     */\r\n    get endStream(): InterfaceStream {\r\n        let stream: InterfaceStream = this.elementaryStream_;\r\n\r\n        if (this.options_.decodeCodec) {\r\n            stream = this.complexStream_;\r\n        }\r\n\r\n        return stream;\r\n    }\r\n\r\n    /**\r\n     * TS push support streaming incomplete data push.\r\n     * @param buffer\r\n     * @param conf\r\n     * @param conf.done - If you need the done event, this boolean needs to be set\r\n     */\r\n    push(buffer: ArrayBuffer | Uint8Array, conf: PushConf = {}) {\r\n        const { done } = conf;\r\n        const { options_, ctx_, cache_buffer_, psi_ } = this;\r\n        let newBuf: Uint8Array = super.constraintPushData_(buffer);\r\n        let cacheByteLength = cache_buffer_.byteLength;\r\n        let byteOffset = null;\r\n\r\n        options_.config = conf;\r\n\r\n        logger.log(\r\n            `hls demux received ${newBuf.byteLength} bytes, cache ${cacheByteLength} bytes. ${done ? 'chunk done' : ''}`\r\n        );\r\n\r\n        cache_buffer_.append(newBuf);\r\n\r\n        while (cache_buffer_.byteLength >= CHUNK_BYTE_LENGTH) {\r\n            let chunk = cache_buffer_.cut(CHUNK_BYTE_LENGTH);\r\n\r\n            // The pushed buffer may be so small that can't cut a ts chunk.\r\n            if (chunk) {\r\n                let packet = new Packet(chunk);\r\n\r\n                if (packet.valid()) {\r\n                    psi_.parse(packet);\r\n\r\n                    this.emit('data', packet);\r\n                } else {\r\n                    let errMsg = `Encounter invalid ts packet, packet_length(${chunk.length}), cache_length(${this.cache_buffer_.byteLength}), has_payload(${packet.has_payload}), data(${chunk})`;\r\n\r\n                    logger.error(errMsg);\r\n\r\n                    this.reset();\r\n\r\n                    ctx_.emit('error', muxErrorCode.TS_SYNC_BYTE, errMsg, {\r\n                        startByte: byteOffset,\r\n                        endByte: byteOffset + chunk.byteLength\r\n                    });\r\n                    break;\r\n                }\r\n\r\n                byteOffset += chunk.byteLength;\r\n            }\r\n        }\r\n\r\n        if (cache_buffer_.empty && done) {\r\n            // logger.log('mux packet done!');\r\n            this.emit('done');\r\n        }\r\n    }\r\n\r\n    reset() {\r\n        this.cache_buffer_.clear();\r\n\r\n        this.emit('reset');\r\n    }\r\n}\r\n"],"names":["console","global","AVCStream"],"mappings":";;AAAA;;;;AAIG;IAES,OAMX;AAND,CAAA,UAAY,MAAM,EAAA;AACd,IAAA,MAAA,CAAA,OAAA,CAAA,GAAA,OAAe,CAAA;AACf,IAAA,MAAA,CAAA,MAAA,CAAA,GAAA,MAAa,CAAA;AACb,IAAA,MAAA,CAAA,MAAA,CAAA,GAAA,MAAa,CAAA;AACb,IAAA,MAAA,CAAA,YAAA,CAAA,GAAA,YAAyB,CAAA;AACzB,IAAA,MAAA,CAAA,MAAA,CAAA,GAAA,MAAa,CAAA;AACjB,CAAC,EANW,MAAM,KAAN,MAAM,GAMjB,EAAA,CAAA,CAAA;;ACZD;;AAEG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,IAAI,YAAY,GAAG,MAAM,CAAC,MAAM,IAAI,oBAAoB,CAAC;AACzD,IAAI,UAAU,GAAG,MAAM,CAAC,IAAI,IAAI,kBAAkB,CAAC;AACnD,IAAI,IAAI,GAAG,QAAQ,CAAC,SAAS,CAAC,IAAI,IAAI,oBAAoB,CAAC;AAE3D;AACA;AACA,IAAI,mBAAmB,GAAG,EAAE,CAAC;AAEf,MAAO,YAAY,CAAA;AAC7B,IAAA,OAAO,aAAa,CAAC,OAAO,EAAE,IAAI,EAAA;AAC9B,QAAA,IAAI,OAAO,OAAO,CAAC,aAAa,KAAK,UAAU,EAAE;AAC7C,YAAA,OAAO,OAAO,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;AACtC,SAAA;AAAM,aAAA;YACH,OAAO,aAAa,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;AAC5C,SAAA;KACJ;IAED,OAAO,mBAAmB,CAAS;AAEnC,IAAA,aAAa,CAAU;AACvB,IAAA,YAAY,CAAS;AACrB,IAAA,OAAO,CAAM;AAEb,IAAA,WAAA,GAAA;AACI,QAAA,IAAI,CAAC,IAAI,CAAC,OAAO,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,EAAE,SAAS,CAAC,EAAE;AACzE,YAAA,IAAI,CAAC,OAAO,GAAG,YAAY,CAAC,IAAI,CAAC,CAAC;AAClC,YAAA,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC;AACzB,SAAA;QAED,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,aAAa,IAAI,SAAS,CAAC;KACxD;;;;;;;;;;;;;AAeD,IAAA,IAAI,CAAC,IAAY,EAAE,GAAG,IAAI,EAAA;QACtB,IAAI,EAAE,EAAE,OAAO,EAAE,GAAG,EAAE,IAAI,EAAE,CAAC,EAAE,MAAM,CAAC;AACtC,QAAA,IAAI,OAAO,GAAG,IAAI,KAAK,OAAO,CAAC;AAE/B,QAAA,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC;AACtB,QAAA,IAAI,MAAM;YAAE,OAAO,GAAG,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,IAAI,CAAC;AACjD,aAAA,IAAI,CAAC,OAAO;AAAE,YAAA,OAAO,KAAK,CAAC;;AAGhC,QAAA,IAAI,OAAO,EAAE;AACT,YAAA,IAAI,SAAS,CAAC,MAAM,GAAG,CAAC;AAAE,gBAAA,EAAE,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;YAC5C,IAAI,EAAE,YAAY,KAAK,EAAE;gBACrB,MAAM,EAAE,CAAC;AACZ,aAAA;AAAM,iBAAA;;gBAEH,IAAI,GAAG,GAAG,IAAI,KAAK,CAAC,4BAA4B,GAAG,EAAE,GAAG,GAAG,CAAC,CAAC;AAC7D,gBAAA,GAAG,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC;AACpB,gBAAA,MAAM,GAAG,CAAC;AACb,aAAA;AACJ,SAAA;AAED,QAAA,OAAO,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;AAEvB,QAAA,IAAI,CAAC,OAAO;AAAE,YAAA,OAAO,KAAK,CAAC;AAE3B,QAAA,IAAI,IAAI,GAAG,OAAO,OAAO,KAAK,UAAU,CAAC;AACzC,QAAA,GAAG,GAAG,SAAS,CAAC,MAAM,CAAC;AACvB,QAAA,QAAQ,GAAG;;AAEP,YAAA,KAAK,CAAC;AACF,gBAAA,QAAQ,CAAC,OAAO,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;gBAC9B,MAAM;AACV,YAAA,KAAK,CAAC;AACF,gBAAA,OAAO,CAAC,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC3C,MAAM;AACV,YAAA,KAAK,CAAC;AACF,gBAAA,OAAO,CAAC,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,SAAS,CAAC,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;gBACzD,MAAM;AACV,YAAA,KAAK,CAAC;gBACF,SAAS,CAAC,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,SAAS,CAAC,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;gBACzE,MAAM;;AAEV,YAAA;gBACI,IAAI,GAAG,IAAI,KAAK,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;gBAC1B,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE;oBAAE,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;gBACrD,QAAQ,CAAC,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;AAC3C,SAAA;AAED,QAAA,OAAO,IAAI,CAAC;KACf;IAED,EAAE,CAAC,IAAY,EAAE,QAAkB,EAAA;QAC/B,OAAO,YAAY,CAAC,IAAI,EAAE,IAAI,EAAE,QAAQ,CAAC,CAAC;KAC7C;IAED,IAAI,CAAC,IAAI,EAAE,QAAQ,EAAA;QACf,IAAI,OAAO,QAAQ,KAAK,UAAU;AAAE,YAAA,MAAM,IAAI,SAAS,CAAC,wCAAwC,CAAC,CAAC;AAClG,QAAA,IAAI,CAAC,EAAE,CAAC,IAAI,EAAE,SAAS,CAAC,IAAI,EAAE,IAAI,EAAE,QAAQ,CAAC,CAAC,CAAC;AAC/C,QAAA,OAAO,IAAI,CAAC;KACf;IAED,GAAG,CAAC,IAAI,EAAE,QAAQ,EAAA;QACd,OAAO,eAAe,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,EAAE,QAAQ,CAAC,CAAC;KACrD;AAED,IAAA,kBAAkB,CAAC,IAAI,EAAA;AACnB,QAAA,IAAI,SAAS,EAAE,MAAM,EAAE,CAAC,CAAC;AAEzB,QAAA,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC;AACtB,QAAA,IAAI,CAAC,MAAM;AAAE,YAAA,OAAO,IAAI,CAAC;;AAGzB,QAAA,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE;AACb,YAAA,IAAI,SAAS,CAAC,MAAM,KAAK,CAAC,EAAE;AACxB,gBAAA,IAAI,CAAC,OAAO,GAAG,YAAY,CAAC,IAAI,CAAC,CAAC;AAClC,gBAAA,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC;AACzB,aAAA;AAAM,iBAAA,IAAI,MAAM,CAAC,IAAI,CAAC,EAAE;AACrB,gBAAA,IAAI,EAAE,IAAI,CAAC,YAAY,KAAK,CAAC;AAAE,oBAAA,IAAI,CAAC,OAAO,GAAG,YAAY,CAAC,IAAI,CAAC,CAAC;;AAC5D,oBAAA,OAAO,MAAM,CAAC,IAAI,CAAC,CAAC;AAC5B,aAAA;AACD,YAAA,OAAO,IAAI,CAAC;AACf,SAAA;;AAGD,QAAA,IAAI,SAAS,CAAC,MAAM,KAAK,CAAC,EAAE;AACxB,YAAA,IAAI,IAAI,GAAG,UAAU,CAAC,MAAM,CAAC,CAAC;AAC9B,YAAA,IAAI,GAAG,CAAC;AACR,YAAA,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE;AAC9B,gBAAA,GAAG,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;gBACd,IAAI,GAAG,KAAK,KAAK;oBAAE,SAAS;AAC5B,gBAAA,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC;AAChC,aAAA;AACD,YAAA,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC;AAC/B,YAAA,IAAI,CAAC,OAAO,GAAG,YAAY,CAAC,IAAI,CAAC,CAAC;AAClC,YAAA,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC;AACtB,YAAA,OAAO,IAAI,CAAC;AACf,SAAA;AAED,QAAA,SAAS,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;AAEzB,QAAA,IAAI,OAAO,SAAS,KAAK,UAAU,EAAE;AACjC,YAAA,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;AAC7B,SAAA;AAAM,aAAA,IAAI,SAAS,EAAE;;AAElB,YAAA,KAAK,CAAC,GAAG,SAAS,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;gBACxC,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;AAChC,aAAA;AACJ,SAAA;AAED,QAAA,OAAO,IAAI,CAAC;KACf;AAED,IAAA,SAAS,CAAC,IAAI,EAAA;QACV,OAAO,UAAU,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;KACvC;AAED,IAAA,YAAY,CAAC,IAAI,EAAA;QACb,OAAO,UAAU,CAAC,IAAI,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;KACxC;IAED,aAAa,GAAA;QACT,OAAO,YAAY,CAAC,aAAa,CAAC,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;KAC5D;AACJ,CAAA;AAED,IAAI,iBAAiB,CAAC;AACtB,IAAI;IACA,IAAI,CAAC,GAAG,EAAE,CAAC;IACX,IAAI,MAAM,CAAC,cAAc;AAAE,QAAA,MAAM,CAAC,cAAc,CAAC,CAAC,EAAE,GAAG,EAAE,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC;AACvE,IAAA,iBAAiB,GAAG,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;AACpC,CAAA;AAAC,OAAO,GAAG,EAAE;IACV,iBAAiB,GAAG,KAAK,CAAC;AAC7B,CAAA;AACD,IAAI,iBAAiB,EAAE;AACnB,IAAA,MAAM,CAAC,cAAc,CAAC,YAAY,EAAE,qBAAqB,EAAE;AACvD,QAAA,UAAU,EAAE,IAAI;AAChB,QAAA,GAAG,EAAE,YAAA;AACD,YAAA,OAAO,mBAAmB,CAAC;SAC9B;QACD,GAAG,EAAE,UAAU,GAAG,EAAA;;;YAGd,IAAI,OAAO,GAAG,KAAK,QAAQ,IAAI,GAAG,GAAG,CAAC,IAAI,GAAG,KAAK,GAAG;AACjD,gBAAA,MAAM,IAAI,SAAS,CAAC,iDAAiD,CAAC,CAAC;YAC3E,mBAAmB,GAAG,GAAG,CAAC;SAC7B;AACJ,KAAA,CAAC,CAAC;AACN,CAAA;AAAM,KAAA;AACH,IAAA,YAAY,CAAC,mBAAmB,GAAG,mBAAmB,CAAC;AAC1D,CAAA;AAED,SAAS,gBAAgB,CAAC,IAAI,EAAA;AAC1B,IAAA,IAAI,IAAI,CAAC,aAAa,KAAK,SAAS;QAAE,OAAO,YAAY,CAAC,mBAAmB,CAAC;IAC9E,OAAO,IAAI,CAAC,aAAa,CAAC;AAC9B,CAAC;AAED;AACA;AACA;AACA;AACA;AACA,SAAS,QAAQ,CAAC,OAAO,EAAE,IAAI,EAAE,IAAI,EAAA;AACjC,IAAA,IAAI,IAAI;AAAE,QAAA,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AACxB,SAAA;AACD,QAAA,IAAI,GAAG,GAAG,OAAO,CAAC,MAAM,CAAC;QACzB,IAAI,SAAS,GAAG,UAAU,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC;QACzC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,EAAE,EAAE,CAAC,EAAE;YAC1B,IAAI;gBACA,SAAS,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AAC3B,aAAA;AAAC,YAAA,OAAO,CAAC,EAAE;AACR,gBAAA,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;AACpB,aAAA;AACJ,SAAA;AACJ,KAAA;AACL,CAAC;AAED,SAAS,OAAO,CAAC,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAA;AACtC,IAAA,IAAI,IAAI;AAAE,QAAA,OAAO,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;AAC9B,SAAA;AACD,QAAA,IAAI,GAAG,GAAG,OAAO,CAAC,MAAM,CAAC;QACzB,IAAI,SAAS,GAAG,UAAU,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC;QACzC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,EAAE,EAAE,CAAC,EAAE;YAC1B,IAAI;gBACA,SAAS,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;AACjC,aAAA;AAAC,YAAA,OAAO,CAAC,EAAE;AACR,gBAAA,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;AACpB,aAAA;AACJ,SAAA;AACJ,KAAA;AACL,CAAC;AAED,SAAS,OAAO,CAAC,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAA;AAC5C,IAAA,IAAI,IAAI;QAAE,OAAO,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;AACpC,SAAA;AACD,QAAA,IAAI,GAAG,GAAG,OAAO,CAAC,MAAM,CAAC;QACzB,IAAI,SAAS,GAAG,UAAU,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC;QACzC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,EAAE,EAAE,CAAC,EAAE;YAC1B,IAAI;AACA,gBAAA,SAAS,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;AACvC,aAAA;AAAC,YAAA,OAAO,CAAC,EAAE;AACR,gBAAA,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;AACpB,aAAA;AACJ,SAAA;AACJ,KAAA;AACL,CAAC;AAED,SAAS,SAAS,CAAC,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAA;AACpD,IAAA,IAAI,IAAI;QAAE,OAAO,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;AAC1C,SAAA;AACD,QAAA,IAAI,GAAG,GAAG,OAAO,CAAC,MAAM,CAAC;QACzB,IAAI,SAAS,GAAG,UAAU,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC;QACzC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,EAAE,EAAE,CAAC,EAAE;YAC1B,IAAI;AACA,gBAAA,SAAS,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;AAC7C,aAAA;AAAC,YAAA,OAAO,CAAC,EAAE;AACR,gBAAA,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;AACpB,aAAA;AACJ,SAAA;AACJ,KAAA;AACL,CAAC;AAED,SAAS,QAAQ,CAAC,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAA;AACvC,IAAA,IAAI,IAAI;AAAE,QAAA,OAAO,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;AAC/B,SAAA;AACD,QAAA,IAAI,GAAG,GAAG,OAAO,CAAC,MAAM,CAAC;QACzB,IAAI,SAAS,GAAG,UAAU,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC;QACzC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,EAAE,EAAE,CAAC,EAAE;YAC1B,IAAI;gBACA,SAAS,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;AAClC,aAAA;AAAC,YAAA,OAAO,CAAC,EAAE;AACR,gBAAA,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;AACpB,aAAA;AACJ,SAAA;AACJ,KAAA;AACL,CAAC;AAED,SAAS,YAAY,CAAC,MAAoB,EAAE,IAAI,EAAE,QAAkB,EAAA;AAChE,IAAA,IAAI,CAAC,CAAC;AACN,IAAA,IAAI,MAAM,CAAC;AACX,IAAA,IAAI,QAAQ,CAAC;IAEb,IAAI,OAAO,QAAQ,KAAK,UAAU;AAAE,QAAA,MAAM,IAAI,SAAS,CAAC,wCAAwC,CAAC,CAAC;AAElG,IAAA,MAAM,GAAG,MAAM,CAAC,OAAO,CAAC;IACxB,IAAI,CAAC,MAAM,EAAE;QACT,MAAM,GAAG,MAAM,CAAC,OAAO,GAAG,YAAY,CAAC,IAAI,CAAC,CAAC;AAC7C,QAAA,MAAM,CAAC,YAAY,GAAG,CAAC,CAAC;AAC3B,KAAA;AAAM,SAAA;;;QAGH,IAAI,MAAM,CAAC,WAAW,EAAE;YACpB,MAAM,CAAC,IAAI,CAAC,aAAa,EAAE,IAAI,EAAE,QAAQ,CAAC,UAAU,CAAC,GAAG,QAAQ,CAAC,UAAU,CAAC,GAAG,QAAQ,CAAC,CAAC;;;AAIzF,YAAA,MAAM,GAAG,MAAM,CAAC,OAAO,CAAC;AAC3B,SAAA;AACD,QAAA,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;AAC3B,KAAA;IAED,IAAI,CAAC,QAAQ,EAAE;;AAEX,QAAA,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,GAAG,QAAQ,CAAC;QACnC,EAAE,MAAM,CAAC,YAAY,CAAC;AACzB,KAAA;AAAM,SAAA;AACH,QAAA,IAAI,OAAO,QAAQ,KAAK,UAAU,EAAE;;YAEhC,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;AAClD,SAAA;AAAM,aAAA;AACH,YAAA,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;AAC3B,SAAA;;AAGD,QAAA,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE;AAClB,YAAA,CAAC,GAAG,gBAAgB,CAAC,MAAM,CAAC,CAAC;YAC7B,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE;AACnC,gBAAA,QAAQ,CAAC,MAAM,GAAG,IAAI,CAAC;gBAEvB,MAAM,WAAY,SAAQ,KAAK,CAAA;AAC3B,oBAAA,OAAO,CAAM;AACb,oBAAA,IAAI,CAAS;AACb,oBAAA,KAAK,CAAS;AACjB,iBAAA;AACD,gBAAA,IAAI,CAAC,GAAgB,IAAI,WAAW,CAChC,4CAA4C;AACxC,oBAAA,QAAQ,CAAC,MAAM;oBACf,IAAI;oBACJ,MAAM,CAAC,IAAI,CAAC;oBACZ,cAAc;oBACd,0CAA0C;AAC1C,oBAAA,iBAAiB,CACxB,CAAC;AACF,gBAAA,CAAC,CAAC,IAAI,GAAG,6BAA6B,CAAC;AACvC,gBAAA,CAAC,CAAC,OAAO,GAAG,MAAM,CAAC;AACnB,gBAAA,CAAC,CAAC,IAAI,GAAG,IAAI,CAAC;AACd,gBAAA,CAAC,CAAC,KAAK,GAAG,QAAQ,CAAC,MAAM,CAAC;gBAE1B,IAAI,OAAO,OAAO,KAAK,QAAQ,IAAI,OAAO,CAAC,IAAI,EAAE;AAC7C,oBAAA,OAAO,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC;AAC7C,iBAAA;AACJ,aAAA;AACJ,SAAA;AACJ,KAAA;AAED,IAAA,OAAO,MAAM,CAAC;AAClB,CAAC;AAED,SAAS,eAAe,CAAC,IAAI,EAAE,QAAQ,EAAA;IACnC,IAAI,IAAI,EAAE,MAAM,EAAE,QAAQ,EAAE,CAAC,EAAE,gBAAgB,CAAC;IAEhD,IAAI,OAAO,QAAQ,KAAK,UAAU;AAAE,QAAA,MAAM,IAAI,SAAS,CAAC,wCAAwC,CAAC,CAAC;AAElG,IAAA,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC;AACtB,IAAA,IAAI,CAAC,MAAM;AAAE,QAAA,OAAO,IAAI,CAAC;AAEzB,IAAA,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;AACpB,IAAA,IAAI,CAAC,IAAI;AAAE,QAAA,OAAO,IAAI,CAAC;IAEvB,IAAI,IAAI,KAAK,QAAQ,IAAI,IAAI,CAAC,QAAQ,KAAK,QAAQ,EAAE;AACjD,QAAA,IAAI,EAAE,IAAI,CAAC,YAAY,KAAK,CAAC;AAAE,YAAA,IAAI,CAAC,OAAO,GAAG,YAAY,CAAC,IAAI,CAAC,CAAC;AAC5D,aAAA;AACD,YAAA,OAAO,MAAM,CAAC,IAAI,CAAC,CAAC;YACpB,IAAI,MAAM,CAAC,GAAG;AAAE,gBAAA,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,EAAE,IAAI,CAAC,QAAQ,IAAI,QAAQ,CAAC,CAAC;AACrE,SAAA;AACJ,KAAA;AAAM,SAAA,IAAI,OAAO,IAAI,KAAK,UAAU,EAAE;QACnC,QAAQ,GAAG,CAAC,CAAC,CAAC;AAEd,QAAA,KAAK,CAAC,GAAG,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;AACnC,YAAA,IAAI,IAAI,CAAC,CAAC,CAAC,KAAK,QAAQ,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,QAAQ,KAAK,QAAQ,EAAE;AACvD,gBAAA,gBAAgB,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC;gBACpC,QAAQ,GAAG,CAAC,CAAC;gBACb,MAAM;AACT,aAAA;AACJ,SAAA;QAED,IAAI,QAAQ,GAAG,CAAC;AAAE,YAAA,OAAO,IAAI,CAAC;QAE9B,IAAI,QAAQ,KAAK,CAAC;YAAE,IAAI,CAAC,KAAK,EAAE,CAAC;;AAC5B,YAAA,SAAS,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;AAE/B,QAAA,IAAI,IAAI,CAAC,MAAM,KAAK,CAAC;YAAE,MAAM,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;QAE9C,IAAI,MAAM,CAAC,GAAG;YAAE,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,EAAE,gBAAgB,IAAI,QAAQ,CAAC,CAAC;AACxE,KAAA;AAED,IAAA,OAAO,IAAI,CAAC;AAChB,CAAC;AAED,SAAS,WAAW,GAAA;AAChB,IAAA,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;AACb,QAAA,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;AACxC,QAAA,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;QAClB,QAAQ,SAAS,CAAC,MAAM;AACpB,YAAA,KAAK,CAAC;gBACF,OAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;AAC3C,YAAA,KAAK,CAAC;AACF,gBAAA,OAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;AACzD,YAAA,KAAK,CAAC;gBACF,OAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,SAAS,CAAC,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;AACvE,YAAA,KAAK,CAAC;gBACF,OAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,SAAS,CAAC,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;AACrF,YAAA;gBACI,IAAI,IAAI,GAAG,IAAI,KAAK,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;AACvC,gBAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,EAAE,CAAC;oBAAE,IAAI,CAAC,CAAC,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;gBAC7D,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;AAC9C,SAAA;AACJ,KAAA;AACL,CAAC;AAED,SAAS,SAAS,CAAC,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAA;IACrC,IAAI,KAAK,GAAG,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,SAAS,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,QAAQ,EAAE,QAAQ,EAAE,CAAC;IAChG,IAAI,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,KAAK,CAAC,CAAC;AAC5C,IAAA,OAAO,CAAC,QAAQ,GAAG,QAAQ,CAAC;AAC5B,IAAA,KAAK,CAAC,MAAM,GAAG,OAAO,CAAC;AACvB,IAAA,OAAO,OAAO,CAAC;AACnB,CAAC;AAED,SAAS,UAAU,CAAC,MAAM,EAAE,IAAI,EAAE,MAAM,EAAA;AACpC,IAAA,IAAI,MAAM,GAAG,MAAM,CAAC,OAAO,CAAC;AAE5B,IAAA,IAAI,CAAC,MAAM;AAAE,QAAA,OAAO,EAAE,CAAC;AAEvB,IAAA,IAAI,UAAU,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;AAC9B,IAAA,IAAI,CAAC,UAAU;AAAE,QAAA,OAAO,EAAE,CAAC;IAE3B,IAAI,OAAO,UAAU,KAAK,UAAU;AAAE,QAAA,OAAO,MAAM,GAAG,CAAC,UAAU,CAAC,QAAQ,IAAI,UAAU,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;AAEzG,IAAA,OAAO,MAAM,GAAG,eAAe,CAAC,UAAU,CAAC,GAAG,UAAU,CAAC,UAAU,EAAE,UAAU,CAAC,MAAM,CAAC,CAAC;AAC5F,CAAC;AAED,SAAS,aAAa,CAAC,IAAI,EAAA;AACvB,IAAA,IAAI,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC;AAE1B,IAAA,IAAI,MAAM,EAAE;AACR,QAAA,IAAI,UAAU,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;AAE9B,QAAA,IAAI,OAAO,UAAU,KAAK,UAAU,EAAE;AAClC,YAAA,OAAO,CAAC,CAAC;AACZ,SAAA;AAAM,aAAA,IAAI,UAAU,EAAE;YACnB,OAAO,UAAU,CAAC,MAAM,CAAC;AAC5B,SAAA;AACJ,KAAA;AAED,IAAA,OAAO,CAAC,CAAC;AACb,CAAC;AAED;AACA,SAAS,SAAS,CAAC,IAAI,EAAE,KAAK,EAAA;IAC1B,KAAK,IAAI,CAAC,GAAG,KAAK,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC;QAAE,IAAI,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;IACzF,IAAI,CAAC,GAAG,EAAE,CAAC;AACf,CAAC;AAED,SAAS,UAAU,CAAC,GAAG,EAAE,CAAC,EAAA;AACtB,IAAA,IAAI,IAAI,GAAG,IAAI,KAAK,CAAC,CAAC,CAAC,CAAC;IACxB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,EAAE,CAAC;QAAE,IAAI,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC;AAC7C,IAAA,OAAO,IAAI,CAAC;AAChB,CAAC;AAED,SAAS,eAAe,CAAC,GAAG,EAAA;IACxB,IAAI,GAAG,GAAG,IAAI,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;AAChC,IAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE;AACjC,QAAA,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,QAAQ,IAAI,GAAG,CAAC,CAAC,CAAC,CAAC;AACtC,KAAA;AACD,IAAA,OAAO,GAAG,CAAC;AACf,CAAC;AAED,SAAS,oBAAoB,CAAC,KAAK,EAAA;AAC/B,IAAA,IAAI,CAAC,GAAG,YAAa,GAAC,CAAC;AACvB,IAAA,CAAC,CAAC,SAAS,GAAG,KAAK,CAAC;IACpB,OAAO,IAAI,CAAC,EAAE,CAAC;AACnB,CAAC;AAED,SAAS,kBAAkB,CAAC,GAAG,EAAA;IAE3B,KAAK,IAAI,CAAC,IAAI,GAAG;AACb,QAAA,IAAI,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC,EAAE,CAEjD;AACL,IAAA,OAAO,CAAC,CAAC;AACb,CAAC;AAED,SAAS,oBAAoB,CAAC,OAAO,EAAA;IACjC,IAAI,EAAE,GAAG,IAAI,CAAC;IACd,OAAO,YAAA;QACH,OAAO,EAAE,CAAC,KAAK,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;AACxC,KAAC,CAAC;AACN;;AClgBM,MAAO,OAAQ,SAAQ,YAAY,CAAA;AAAG;;ACF5C;;;;AAIG;AAEH;;;;AAIG;AACH,IAAI,cAAc,GAAG,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC;AAE/C;;;;;;;;;;;;;;;;;;;AAmBG;AACG,SAAU,YAAY,CAAC,KAAU,EAAA;IACnC,OAAO,CAAC,CAAC,KAAK,IAAI,OAAO,KAAK,IAAI,QAAQ,CAAC;AAC/C,CAAC;AAkBD;;AAEG;AACG,SAAU,QAAQ,CAAC,GAAQ,EAAA;IAC7B,OAAO,OAAO,GAAG,KAAK,QAAQ,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;AAClD,CAAC;AAED;;AAEG;AACG,SAAU,aAAa,CAAC,KAAU,EAAA;AACpC,IAAA,OAAO,YAAY,CAAC,KAAK,CAAC,IAAI,cAAc,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,WAAW,EAAE,KAAK,sBAAsB,CAAC;AACtG,CAAC;AAED;;AAEG;AACG,SAAU,YAAY,CAAC,KAAU,EAAA;AACnC,IAAA,OAAO,YAAY,CAAC,KAAK,CAAC,IAAI,cAAc,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,WAAW,EAAE,KAAK,qBAAqB,CAAC;AACrG;;ACxEA;;;;AAIG;AAIH;;;;AAIG;AAEW,MAAO,WAAW,CAAA;AAC5B,IAAA,IAAI,UAAU,GAAA;AACV,QAAA,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE;YAC7B,IAAI,GAAG,GAAG,CAAC,CAAC;AAEZ,YAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,IAAgB,EAAE,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AAC1D,gBAAA,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;AACrB,gBAAA,GAAG,IAAI,IAAI,CAAC,UAAU,CAAC;AAC1B,aAAA;AACD,YAAA,IAAI,CAAC,WAAW,GAAG,GAAG,CAAC;AAC1B,SAAA;QAED,OAAO,IAAI,CAAC,WAAW,CAAC;KAC3B;AAED;;AAEG;AACH,IAAA,IAAI,KAAK,GAAA;AACL,QAAA,MAAM,EAAE,UAAU,EAAE,GAAG,IAAI,CAAC;QAC5B,IAAI,KAAK,GAAG,IAAI,CAAC;AAEjB,QAAA,IAAI,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE;AACvB,YAAA,IAAI,UAAU,CAAC,MAAM,KAAK,CAAC,EAAE;AACzB,gBAAA,KAAK,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC;AACzB,aAAA;AAAM,iBAAA;AACH,gBAAA,KAAK,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;AAC7B,aAAA;AACJ,SAAA;AAED,QAAA,OAAO,KAAK,CAAC;KAChB;AAED,IAAA,IAAI,KAAK,GAAA;AACL,QAAA,OAAO,IAAI,CAAC,KAAK,CAAC,MAAM,KAAK,CAAC,CAAC;KAClC;AAED,IAAA,IAAI,UAAU,GAAA;QACV,OAAO,IAAI,CAAC,KAAK,CAAC;KACrB;AAED;;;AAGG;AACK,IAAA,WAAW,CAAgB;IAE3B,KAAK,GAAsB,EAAE,CAAC;IAEtC,KAAK,GAAA;AACD,QAAA,IAAI,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC;QAC5B,IAAI,GAAG,GAAG,CAAC,EAAE;YACT,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;AAC7B,SAAA;AACD,QAAA,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;KAC3B;IAED,UAAU,GAAA;QACN,IAAI,KAAK,GAAG,IAAI,CAAC;QACjB,IAAI,QAAQ,GAAW,CAAC,CAAC;QACzB,IAAI,WAAW,GAAW,EAAE,CAAC;;;;;QAM7B,OAAO,KAAK,KAAK,IAAI,EAAE;YACnB,IAAI;AACA,gBAAA,QAAQ,EAAE,CAAC;gBACX,KAAK,GAAG,IAAI,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;AAC3C,aAAA;AAAC,YAAA,OAAO,CAAC,EAAE;gBACR,IAAI,QAAQ,GAAG,WAAW,EAAE;AACxB,oBAAA,MAAM,CAAC,CAAC;AACX,iBAAA;AACJ,aAAA;AACJ,SAAA;AAED,QAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,MAAM,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACpD,IAAI,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;AAE5B,YAAA,KAAK,CAAC,GAAG,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;AAC3B,YAAA,MAAM,IAAI,OAAO,CAAC,UAAU,CAAC;AAChC,SAAA;AAED,QAAA,OAAO,KAAK,CAAC;KAChB;AAED,IAAA,MAAM,CAAC,SAAmC,EAAA;QACtC,IAAI,SAAS,YAAY,WAAW,EAAE;AAClC,YAAA,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;AACxD,SAAA;AAAM,aAAA;AACH,YAAA,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;AAC9B,SAAA;AAED,QAAA,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;KAC3B;AAED;;;;;;;AAOG;AACH,IAAA,GAAG,CAAC,WAAmB,EAAE,aAAA,GAAyB,IAAI,EAAA;QAClD,IAAI,KAAK,GAAG,IAAI,CAAC;QAEjB,IAAI,WAAW,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;AAChC,YAAA,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC;YAEtB,IAAI,MAAM,GAAG,CAAC,CAAC;YACf,IAAI,SAAS,GAAG,CAAC,CAAC;AAElB,YAAA,OAAO,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE;AACpB,gBAAA,IAAI,GAAG,GAAG,IAAI,CAAC,KAAK,EAAE,CAAC;gBAEvB,IAAI,SAAS,KAAK,CAAC,EAAE;AACjB,oBAAA,IAAI,GAAG,CAAC,UAAU,IAAI,WAAW,EAAE;AAC/B,wBAAA,IAAI,aAAa,EAAE;;4BAEf,KAAK,GAAG,GAAG,CAAC,QAAQ,CAAC,CAAC,EAAE,WAAW,CAAC,CAAC;AACxC,yBAAA;AAED,wBAAA,IAAI,GAAG,CAAC,UAAU,GAAG,WAAW,EAAE;AAC9B,4BAAA,GAAG,GAAG,GAAG,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;AAChC,4BAAA,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;AACrB,yBAAA;wBACD,MAAM;AACT,qBAAA;AAAM,yBAAA;AACH,wBAAA,IAAI,aAAa,EAAE;4BACf,IAAI;AACA,gCAAA,KAAK,GAAG,IAAI,UAAU,CAAC,WAAW,CAAC,CAAC;AACvC,6BAAA;AAAC,4BAAA,OAAO,CAAC,EAAE;AACR,gCAAA,MAAM,qCAAqC,WAAW,CAAA,CAAA,EAAI,CAAC,CAAC,OAAO,EAAE,CAAC;AACzE,6BAAA;AAED,4BAAA,KAAK,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;AACrB,yBAAA;AACD,wBAAA,MAAM,IAAI,GAAG,CAAC,UAAU,CAAC;AAC5B,qBAAA;AACJ,iBAAA;AAAM,qBAAA;AACH,oBAAA,IAAI,MAAM,GAAG,WAAW,GAAG,MAAM,CAAC;AAElC,oBAAA,IAAI,GAAG,CAAC,UAAU,IAAI,MAAM,EAAE;AAC1B,wBAAA,IAAI,aAAa,EAAE;AACf,4BAAA,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,EAAE,MAAM,CAAC,EAAE,MAAM,CAAC,CAAC;AAC9C,yBAAA;AAED,wBAAA,GAAG,GAAG,GAAG,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;AAE3B,wBAAA,IAAI,GAAG,CAAC,UAAU,GAAG,CAAC,EAAE;AACpB,4BAAA,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;AACrB,yBAAA;wBAED,MAAM;AACT,qBAAA;AAAM,yBAAA;AACH,wBAAA,IAAI,aAAa,EAAE;AACf,4BAAA,KAAK,CAAC,GAAG,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;AAC1B,yBAAA;AACD,wBAAA,MAAM,IAAI,GAAG,CAAC,UAAU,CAAC;wBACzB,MAAM;AACT,qBAAA;AACJ,iBAAA;AAED,gBAAA,SAAS,EAAE,CAAC;AACf,aAAA;AAED,YAAA,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;AAC3B,SAAA;AAED,QAAA,OAAO,KAAK,CAAC;KAChB;AACJ;;AC3LD;;AAEG;AAMW,MAAO,QAAQ,CAAA;AACjB,IAAA,IAAI,CAAU;AAEtB,IAAA,WAAA,GAAA;AACI,QAAA,IAAI,CAAC,IAAI,GAAG,EAAE,CAAC;KAClB;AAED;;;;AAIG;IACH,IAAI,CAAC,GAAW,EAAE,KAAU,EAAA;AACxB,QAAA,IAAI,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,CAAC,EAAE;YACtD,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;AAC9B,SAAA;AAAM,aAAA;YACH,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;AAC5B,SAAA;KACJ;AAED;;;AAGG;AACH,IAAA,GAAG,CAAC,GAAW,EAAA;QACX,IAAI,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;;;AAG1B,QAAA,OAAO,IAAI,GAAG,IAAI,CAAC,KAAK,EAAE,GAAG,IAAI,CAAC;KACrC;AAED;;AAEG;IACH,MAAM,GAAA;QACF,IAAI,IAAI,GAAG,EAAE,CAAC;AACd,QAAA,KAAK,IAAI,GAAG,IAAI,IAAI,CAAC,IAAI,EAAE;AACvB,YAAA,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;AACzC,SAAA;AACD,QAAA,OAAO,IAAI,CAAC;KACf;AAED;;;;AAIG;IACH,MAAM,CAAC,GAAW,EAAE,KAAU,EAAA;QAC1B,IAAI,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AAC1B,QAAA,IAAI,IAAI,EAAE;AACN,YAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE;AAClC,gBAAA,IAAI,IAAI,CAAC,CAAC,CAAC,IAAI,KAAK,EAAE;AAClB,oBAAA,IAAI,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;AAClB,oBAAA,EAAE,CAAC,CAAC;AACP,iBAAA;AACJ,aAAA;AACJ,SAAA;KACJ;AAED;;AAEG;IACH,KAAK,GAAA;AACD,QAAA,IAAI,CAAC,IAAI,GAAG,EAAE,CAAC;KAClB;AAED;;AAEG;AACH,IAAA,OAAO,CAAC,QAAkB,EAAA;AACtB,QAAA,KAAK,IAAI,GAAG,IAAI,IAAI,CAAC,IAAI,EAAE;YACvB,QAAQ,CAAC,GAAG,EAAE,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;AACjC,SAAA;KACJ;AACJ;;AChFD;;AAEG;AACH,MAAM,QAAQ,CAAA;AACV,IAAA,MAAM,CAAM;AACZ,IAAA,IAAI,CAAS;AACb,IAAA,QAAQ,CAAW;AAEnB;;;;AAIG;AACH,IAAA,WAAA,CAAY,MAAW,EAAE,IAAY,EAAE,QAAkB,EAAA;AACrD,QAAA,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;AACrB,QAAA,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;AACjB,QAAA,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;AAEzB,QAAA,IAAI,IAAI,CAAC,MAAM,CAAC,gBAAgB,EAAE;YAC9B,IAAI,CAAC,MAAM,CAAC,gBAAgB,CAAC,IAAI,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC;AACvD,SAAA;AAAM,aAAA,IAAI,IAAI,CAAC,MAAM,CAAC,EAAE,EAAE;YACvB,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,IAAI,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC;AACzC,SAAA;KACJ;AAED;;;AAGG;IACH,GAAG,GAAA;AACC,QAAA,IAAI,IAAI,CAAC,MAAM,CAAC,mBAAmB,EAAE;AACjC,YAAA,IAAI,CAAC,MAAM,CAAC,mBAAmB,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;AACpE,SAAA;AAAM,aAAA,IAAI,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE;AACxB,YAAA,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;AACpD,SAAA;AAED,QAAA,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;AACnB,QAAA,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;KACxB;AACJ,CAAA;AAED;;;AAGG;AACW,MAAO,YAAY,CAAA;AACrB,IAAA,WAAW,CAAW;;AAG9B,IAAA,WAAA,GAAA;AACI;;AAEG;AACH,QAAA,IAAI,CAAC,WAAW,GAAG,IAAI,QAAQ,EAAE,CAAC;KACrC;AAED;;;AAGG;IACH,OAAO,GAAA;QACH,IAAI,CAAC,SAAS,EAAE,CAAC;AACjB,QAAA,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;KAC3B;AAED;;;;;AAKG;AACH,IAAA,EAAE,CAAC,MAAW,EAAE,IAAY,EAAE,QAAkB,EAAA;QAC5C,IAAI,CAAC,IAAI,CAAC,WAAW;YAAE,OAAO;QAE9B,IAAI,OAAO,GAAG,IAAI,QAAQ,CAAC,MAAM,EAAE,IAAI,EAAE,QAAQ,CAAC,CAAC;QACnD,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;AAErC,QAAA,OAAO,IAAI,CAAC;KACf;AAED;;;;;;AAMG;AACH,IAAA,IAAI,CAAC,MAAW,EAAE,IAAY,EAAE,QAAkB,EAAA;;QAE9C,IAAI,CAAC,EAAE,CACH,MAAM,EACN,IAAI,EACJ,UAAU,KAAU,EAAA;;AAEhB,YAAA,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;;YAEvB,QAAQ,CAAC,KAAK,CAAC,CAAC;AACpB,SAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CACf,CAAC;KACL;AAED;;;;AAIG;IACH,GAAG,CAAC,MAAW,EAAE,IAAY,EAAA;QACzB,IAAI,CAAC,IAAI,CAAC,WAAW;YAAE,OAAO;AAE9B,QAAA,IAAI,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;AAE5C,QAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE;AAClC,YAAA,IAAI,OAAO,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;AAEtB,YAAA,IAAI,OAAO,CAAC,MAAM,IAAI,MAAM,EAAE;gBAC1B,OAAO,CAAC,GAAG,EAAE,CAAC;gBACd,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;AAC1C,aAAA;AACJ,SAAA;KACJ;AAED;;AAEG;IACH,SAAS,GAAA;QACL,IAAI,CAAC,IAAI,CAAC,WAAW;YAAE,OAAO;QAE9B,IAAI,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC;AAErC,QAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE;AAClC,YAAA,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC;AACjB,SAAA;AAED,QAAA,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE,CAAC;KAC5B;AACJ,CAAA;AAED;;AC3IA;;;;AAIG;AAEH;;AAEG;AACH,IAAI,MAAW,CAAC;AAEhB;AACA,IAAI,OAAO,MAAM,KAAK,WAAW,EAAE;;IAE/B,MAAM,GAAG,IAAI,CAAC;AACjB,CAAA;AAAM,KAAA;IACH,MAAM,GAAG,MAAM,CAAC;AACnB,CAAA;AAED,eAAe,MAAM;;ACnBrB;;;;AAIG;AASH,IAAIA,SAAO,GAAGC,QAAM,CAAC,OAAO,CAAC;AAC7B,MAAM,QAAQ,GACV,OAAO,iBAAiB,KAAK,WAAW;AACxC,IAAA,IAAI,YAAY,iBAAiB;IACjC,OAAO,aAAa,IAAI,WAAW,CAAC;AACxC,MAAM,MAAM,GAAG,KAAK,CAAC;AAErB,MAAM,MAAO,SAAQ,YAAY,CAAA;AACrB,IAAA,QAAQ,CAAS;AACjB,IAAA,OAAO,CAAU;AAEzB,IAAA,IAAI,MAAM,GAAA;QACN,OAAO,IAAI,CAAC,OAAO,CAAC;KACvB;IAED,IAAI,MAAM,CAAC,KAAc,EAAA;AACrB,QAAA,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;AAErB,QAAA,IAAI,CAAC,QAAQ,GAAG,SAAS,CAAC;KAC7B;AAED,IAAA,WAAA,GAAA;AACI,QAAA,KAAK,EAAE,CAAC;AACR,QAAA,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;KACxB;IAED,GAAG,CAAC,GAAG,QAAa,EAAA;AAChB,QAAA,IAAI,QAAQ,EAAE;AACV,YAAA,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,KAAK,EAAE,CAAC,GAAG,QAAQ,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC;AAC7D,SAAA;AAAM,aAAA;YACH,IAAI,IAAI,CAAC,OAAO,EAAE;AACd,gBAAAD,SAAO,CAAC,GAAG,CAAC,IAAI,CAACA,SAAO,EAAE,MAAM,EAAE,GAAG,QAAQ,CAAC,CAAC;AAClD,aAAA;AACJ,SAAA;KACJ;IAED,KAAK,CAAC,GAAG,QAAa,EAAA;AAClB,QAAA,IAAI,QAAQ,EAAE;AACV,YAAA,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,OAAO,EAAE,CAAC,GAAG,QAAQ,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC;AAC/D,SAAA;AAAM,aAAA;AACH,YAAA,IAAI,IAAI,CAAC,OAAO,IAAIA,SAAO,CAAC,KAAK,EAAE;AAC/B,gBAAAA,SAAO,CAAC,KAAK,CAAC,IAAI,CAACA,SAAO,EAAE,MAAM,EAAE,GAAG,QAAQ,CAAC,CAAC;AACpD,aAAA;AACJ,SAAA;KACJ;IAED,MAAM,CAAC,GAAG,QAAa,EAAA;AACnB,QAAA,IAAI,IAAI,CAAC,OAAO,IAAIA,SAAO,CAAC,MAAM,EAAE;AAChC,YAAA,IAAI,SAAS,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;AAC5B,YAAA,IAAI,SAAS,GAAG,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC;AACxD,YAAA,SAAS,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;AAE1B,YAAAA,SAAO,CAAC,MAAM,CAAC,IAAI,CAACA,SAAO,EAAE,SAAS,EAAE,GAAG,SAAS,CAAC,CAAC;AACzD,SAAA;KACJ;IAED,IAAI,CAAC,GAAG,QAAa,EAAA;AACjB,QAAA,IAAI,QAAQ,EAAE;AACV,YAAA,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,MAAM,EAAE,CAAC,GAAG,QAAQ,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC;AAC9D,SAAA;AAAM,aAAA;YACH,IAAI,IAAI,CAAC,OAAO,EAAE;AACd,gBAAAA,SAAO,CAAC,IAAI,CAAC,IAAI,CAACA,SAAO,EAAE,MAAM,EAAE,GAAG,QAAQ,CAAC,CAAC;AACnD,aAAA;AACJ,SAAA;KACJ;IAED,KAAK,CAAC,GAAG,QAAa,EAAA;AAClB,QAAA,IAAI,QAAQ,EAAE;AACV,YAAA,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,OAAO,EAAE,CAAC,GAAG,QAAQ,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC;AAC/D,SAAA;AAAM,aAAA;YACH,IAAI,IAAI,CAAC,OAAO,EAAE;AACd,gBAAAA,SAAO,CAAC,KAAK,CAAC,IAAI,CAACA,SAAO,EAAE,MAAM,EAAE,GAAG,QAAQ,CAAC,CAAC;AACpD,aAAA;AACJ,SAAA;KACJ;AACJ,CAAA;AAED,IAAI,MAAM,GAAG,IAAI,MAAM,EAAE;;AC1FzB;;;;AAIG;AASH,MAAM,MAAO,SAAQ,YAAY,CAAA;AAC7B,IAAA,WAAA,GAAA;AACI,QAAA,KAAK,EAAE,CAAC;KACX;AAED;;;AAGG;AACH,IAAA,IAAI,CAAC,WAAmB,EAAA;AACpB,QAAA,IAAI,CAAC,EAAE,CAAC,OAAO,EAAE,YAAA;YACb,WAAW,CAAC,KAAK,EAAE,CAAC;AACxB,SAAC,CAAC,CAAC;AAEH,QAAA,IAAI,CAAC,EAAE,CAAC,MAAM,EAAE,UAAU,IAAI,EAAA;AAC1B,YAAA,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AAC3B,SAAC,CAAC,CAAC;AAEH,QAAA,IAAI,CAAC,EAAE,CAAC,MAAM,EAAE,UAAU,WAAW,EAAA;AACjC,YAAA,WAAW,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC;AACnC,SAAC,CAAC,CAAC;AAEH,QAAA,OAAO,WAAW,CAAC;KACtB;AAED;;AAEG;IACH,MAAM,GAAA;AACF,QAAA,IAAI,CAAC,kBAAkB,CAAC,OAAO,CAAC,CAAC;AACjC,QAAA,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC;AAChC,QAAA,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC;AAEhC,QAAA,OAAO,IAAI,CAAC;KACf;AAED;;;AAGG;IACH,IAAI,CAAC,IAAS,EAAE,IAAe,EAAA;AAG3B,QAAA,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;KAC3B;AAED;;;AAGG;AACH,IAAA,KAAK,CAAC,WAAmB,EAAA;AACrB,QAAA,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC;KAClC;IAED,KAAK,GAAA;AACD,QAAA,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;KACtB;AACJ;;ACtED;;;;AAIG;AAS2B,MAAA,WAAY,SAAQ,MAAM,CAAA;AAE1C,IAAA,aAAa,CAAe;AAC5B,IAAA,IAAI,CAAU;AACd,IAAA,QAAQ,CAAgB;AACxB,IAAA,aAAa,CAAc;IAE3B,gBAAgB,GAAA;AACtB,QAAA,IAAI,CAAC,aAAa,GAAG,IAAI,YAAY,EAAE,CAAC;AAExC,QAAA,IAAI,CAAC,aAAa;aACb,EAAE,CAAC,IAAI,CAAC,SAAS,EAAE,MAAM,EAAE,CAAC,IAAI,KAAI;YACjC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;AACvC,SAAC,CAAC;aACD,EAAE,CAAC,IAAI,CAAC,SAAS,EAAE,MAAM,EAAE,CAAC,IAAI,KAAI;YACjC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;AACjC,SAAC,CAAC;aACD,EAAE,CAAC,IAAI,CAAC,IAAI,EAAE,OAAO,EAAE,CAAC,IAAI,KAAI;YAC7B,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;AAClC,SAAC,CAAC,CAAC;KACV;AAED,IAAA,WAAA,CAAY,UAAyB,EAAE,EAAA;AACnC,QAAA,KAAK,EAAE,CAAC;QAER,IAAI,OAAO,CAAC,KAAK,EAAE;AACf,YAAA,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC;AACxB,SAAA;AAED,QAAA,IAAI,CAAC,IAAI,GAAG,IAAI,OAAO,EAAE,CAAC;AAC1B,QAAA,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;AACxB,QAAA,IAAI,CAAC,aAAa,GAAG,IAAI,WAAW,EAAE,CAAC;KAC1C;AASD;;;AAGG;AACO,IAAA,mBAAmB,CAAC,GAA6B,EAAA;QACvD,IAAI,MAAM,GAAG,IAAI,CAAC;QAClB,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,EAAE;AAC3C,YAAA,MAAM,CAAC,KAAK,CAAC,oDAAoD,GAAG,CAAA,CAAE,CAAC,CAAC;AACxE,YAAA,OAAO,MAAM,CAAC;AACjB,SAAA;AAED,QAAA,IAAI,aAAa,CAAC,GAAG,CAAC,EAAE;AACpB,YAAA,MAAM,GAAG,IAAI,UAAU,CAAC,GAAG,CAAC,CAAC;AAChC,SAAA;AAAM,aAAA;YACH,MAAM,GAAG,GAAG,CAAC;AAChB,SAAA;AAED,QAAA,OAAO,MAAM,CAAC;KACjB;AAED,IAAA,KAAK,MAAW;IAEhB,OAAO,GAAA;QACH,IAAI,CAAC,MAAM,EAAE,CAAC;AACd,QAAA,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,CAAC;AAExB,QAAA,IAAI,CAAC,aAAa,CAAC,SAAS,EAAE,CAAC;KAClC;AACJ;;AClFD;;;;AAIG;AAEH;;;AAGG;AACH,IAAK,KAMJ,CAAA;AAND,CAAA,UAAK,KAAK,EAAA;AACN,IAAA,KAAA,CAAA,KAAA,CAAA,kBAAA,CAAA,GAAA,CAAA,CAAA,GAAA,kBAAoB,CAAA;AACpB,IAAA,KAAA,CAAA,KAAA,CAAA,sBAAA,CAAA,GAAA,CAAA,CAAA,GAAA,sBAAoB,CAAA;AACpB,IAAA,KAAA,CAAA,KAAA,CAAA,cAAA,CAAA,GAAA,CAAA,CAAA,GAAA,cAAY,CAAA;AACZ,IAAA,KAAA,CAAA,KAAA,CAAA,oBAAA,CAAA,GAAA,CAAA,CAAA,GAAA,oBAAkB,CAAA;AAClB,IAAA,KAAA,CAAA,KAAA,CAAA,gCAAA,CAAA,GAAA,CAAA,CAAA,GAAA,gCAA8B,CAAA;AAClC,CAAC,EANI,KAAK,KAAL,KAAK,GAMT,EAAA,CAAA,CAAA,CAAA;AAED,mBAAe,KAAK;;AClBpB;;;;AAIG;AAIH;;AAEG;MACU,UAAU,CAAA;;;;;;;;;;AAUnB,IAAA,QAAQ,CAA2B;;AAGnC,IAAA,WAAA,CAAY,MAAkB,EAAA;;;;;;;;AAY1B,QAAA,IAAI,cAAc,GAAG,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,IAAI,KAAK,CAAC,IAAI,MAAM,CAAC,CAAC,CAAC,CAAC;;;;;;;;;;;AAmB3D,QAAA,IAAI,CAAC,GAAG,CAAC,EACL,WAAW,CAAC;;QAEhB,IAAI,GAAG,GAAG,cAAc,GAAG,CAAC,GAAG,CAAC,CAAC;AAEjC,QAAA,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;;AAEnB,QAAA,OAAO,CAAC,GAAG,GAAG,EAAE,CAAC,IAAI,CAAC,EAAE;AACpB,YAAA,WAAW,GAAG,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,IAAI,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;;YAGnD,IAAI,WAAW,IAAI,IAAI,EAAE;gBACrB,IAAI,WAAW,GAAG,CAAC,CAAC,MAAM,CAAC,EAAE,GAAG,CAAC,CAAC,GAAG,IAAI,KAAK,CAAC,IAAI,MAAM,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC;;;AAKlE,gBAAA,MAAM,CAAC,GAAG,CAAC,8BAA8B,EAAE,WAAW,CAAC,CAAC;AAC3D,aAAA;AAAM,iBAAA;AACH,gBAAA,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC;AACf,oBAAA,UAAU,EAAE,WAAW;oBACvB,eAAe,EAAE,CAAC,CAAC,MAAM,CAAC,EAAE,GAAG,CAAC,CAAC,GAAG,IAAI,KAAK,CAAC,IAAI,MAAM,CAAC,EAAE,GAAG,CAAC,CAAC;AACnE,iBAAA,CAAC,CAAC;;;;;;;AAQN,aAAA;AACJ,SAAA;;;;;;;KAQJ;AACJ;;AC/FD;;;;AAIG;AAOH;;AAEG;MACU,UAAU,CAAA;;;;;;;;;;AAUnB,IAAA,SAAS,CAA2B;;AAGpC,IAAA,WAAA,CAAY,MAAkB,EAAA;;;;;;;;AAY1B,QAAA,IAAI,cAAc,GAAG,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,IAAI,KAAK,CAAC,IAAI,MAAM,CAAC,CAAC,CAAC,CAAC;;;;;;;;;;;;;;;AAwB3D,QAAA,MAAM,mBAAmB,GAAG,CAAC,CAAC,MAAM,CAAC,EAAE,CAAC,GAAG,IAAI,KAAK,CAAC,IAAI,MAAM,CAAC,EAAE,CAAC,CAAC;QAEpE,IAAI,mBAAmB,GAAG,CAAC,EAAE;YACzB,OAAO;AACV,SAAA;aAAM,IAAI,mBAAmB,GAAG,CAAC,EAAE;YAChC,IAAI,CAAC,GAAG,CAAC,CAAC;YAEV,OAAO,CAAC,GAAG,mBAAmB,EAAE;;gBAE5B,IAAI,iBAAiB,GAAG,MAAM,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC;;gBAGvC,CAAC,IAAI,iBAAiB,CAAC;AAC1B,aAAA;AACJ,SAAA;AAED,QAAA,IAAI,cAAc,GAAG,EAAE,GAAG,mBAAmB,CAAC;QAC9C,IAAI,cAAc,GAAG,cAAc,GAAG,mBAAmB,GAAG,CAAC,GAAG,CAAC,CAAC;AAClE,QAAA,IAAI,cAAc,GAAG,cAAc,GAAG,cAAc,CAAC;QAErD,IAAI,cAAc,IAAI,cAAc,EAAE;YAClC,MAAM,CAAC,IAAI,CAAC,CAAA,gCAAA,EAAmC,cAAc,CAAK,EAAA,EAAA,cAAc,CAAE,CAAA,CAAC,CAAC;YACpF,OAAO;AACV,SAAA;AAED,QAAA,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;QAEpB,IAAI,CAAC,GAAG,CAAC,CAAC;QACV,OAAO,CAAC,GAAG,cAAc,EAAE;AACvB,YAAA,IAAI,OAAO,GAAG,cAAc,GAAG,CAAC,CAAC;AACjC,YAAA,IAAI,WAAW,GAAG,MAAM,CAAC,OAAO,CAAC,CAAC;YAClC,IAAI,cAAc,GAAG,CAAC,CAAC,MAAM,CAAC,OAAO,GAAG,CAAC,CAAC,IAAI,CAAC,IAAI,MAAM,CAAC,OAAO,GAAG,CAAC,CAAC,IAAI,MAAM,CAAC;YACjF,IAAI,cAAc,GAAG,CAAC,CAAC,MAAM,CAAC,OAAO,GAAG,CAAC,CAAC,IAAI,CAAC,IAAI,MAAM,CAAC,OAAO,GAAG,CAAC,CAAC,IAAI,MAAM,CAAC;AAEjF,YAAA,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC;AAChB,gBAAA,UAAU,EAAE,WAAW;AACvB,gBAAA,GAAG,EAAE,cAAc;AACtB,aAAA,CAAC,CAAC;;;;;;;;;;;AAeH,YAAA,CAAC,IAAI,cAAc,GAAG,CAAC,CAAC;AAC3B,SAAA;;;;;;;KAQJ;AACJ;;AC7HD;;;;AAIG;AAEH;;;;AAIG;AAEH;;;;AAIG;AACI,MAAM,OAAO,GAAG,MAAM,CAAC;AACvB,MAAM,OAAO,GAAG,MAAM,CAAC;AACvB,MAAM,QAAQ,GAAG,MAAM,CAAC;AAC/B;AACO,MAAM,OAAO,GAAG,MAAM;;ACrB7B;;;;AAIG;AAuDH;AACA;AACA;AACA;MAEa,GAAG,CAAA;AACZ,IAAA,WAAA,GAAA;;AAEI,QAAA,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;AACpB,QAAA,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;KACzB;;;IAIO,SAAS,CAA2B;IACpC,WAAW,CAA6B;AAEhD;;AAEG;AACH,IAAA,IAAI,iBAAiB,GAAA;QACjB,IAAI,OAAO,GAAG,EAAE,CAAC;AAEjB,QAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AAC5C,YAAA,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;AACvC,SAAA;AAED,QAAA,OAAO,OAAO,CAAC,MAAM,GAAG,CAAC,GAAG,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;KAC/C;AAED,IAAA,IAAI,MAAM,GAAA;QACN,OAAO,IAAI,CAAC,WAAW,CAAC;KAC3B;;;;AAMD;;;;;AAKG;IACH,KAAK,GAAA;;AAED,QAAA,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;AAChD,QAAA,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;KACvD;AAED;;AAEG;AACH,IAAA,KAAK,CAAC,MAAc,EAAA;QAChB,MAAM,IAAI,GAAG,IAAI,CAAC;;AAGlB,QAAA,IAAI,OAAO,KAAK,MAAM,CAAC,GAAG,EAAE;;AAExB,YAAA,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;AAC1B,SAAA;AAAM,aAAA,IAAI,OAAO,KAAK,MAAM,CAAC,GAAG,EAAE,CAElC;AAAM,aAAA,IAAI,QAAQ,KAAK,MAAM,CAAC,GAAG,EAAE,CAEnC;aAAM,IAAI,MAAM,IAAI,MAAM,CAAC,GAAG,IAAI,MAAM,CAAC,GAAG,IAAI,MAAM,EAAE,CAExD;AAAM,aAAA,IAAI,OAAO,KAAK,MAAM,CAAC,GAAG,EAAE,CAGlC;AAAM,aAAA,IAAI,MAAM,CAAC,GAAG,KAAK,IAAI,CAAC,iBAAiB,EAAE;;AAE9C,YAAA,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;AAC1B,SAAA;;;;;;KAMJ;;;;;;;;;;;;;AAeD;;AAEG;AACH,IAAA,SAAS,CAAC,GAAW,EAAA;QACjB,IAAI,OAAO,GAAG,IAAI,CAAC;AACnB,QAAA,IAAI,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC;AAE/B,QAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACrC,IAAI,OAAO,CAAC,CAAC,CAAC,CAAC,EAAE,KAAK,GAAG,EAAE;AACvB,gBAAA,OAAO,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;gBACrB,MAAM;AACT,aAAA;AACJ,SAAA;AAED,QAAA,OAAO,OAAO,CAAC;KAClB;AAED;;;AAGG;AACK,IAAA,SAAS,CAAC,IAAY,EAAA;AAC1B,QAAA,IAAI,IAAgB,CAAC;QAErB,IAAI,IAAI,CAAC,4BAA4B,EAAE;;YAEnC,IAAI,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;YAE9B,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,OAAO,GAAG,CAAC,CAAC,CAAC;AAC7C,SAAA;AAAM,aAAA;AACH,YAAA,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC;AACvB,SAAA;AAED,QAAA,IAAI,GAAG,GAAG,IAAI,UAAU,CAAC,IAAI,CAAC,CAAC;;;AAI/B,QAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YAC1C,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,UAAU,EAAE,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC;AACrF,SAAA;AAED,QAAA,OAAO,GAAG,CAAC;KACd;AAED;;;;AAIG;IACK,eAAe,CAAC,SAAiB,EAAE,GAAW,EAAA;AAClD,QAAA,IAAI,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC;QAE3B,SAAS,OAAO,CAAC,EAAU,EAAA;AACvB,YAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,IAAuB,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AAC5D,gBAAA,IAAI,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;AAChB,gBAAA,IAAI,IAAI,CAAC,EAAE,KAAK,EAAE,EAAE;oBAChB,OAAO;AACH,wBAAA,GAAG,EAAE,CAAC;wBACN,IAAI;qBACP,CAAC;AACL,iBAAA;AACJ,aAAA;AACD,YAAA,OAAO,IAAI,CAAC;SACf;AAED,QAAA,IAAI,CAAC,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC;QAC3B,IAAI,CAAC,CAAC,EAAE;YACJ,KAAK,CAAC,IAAI,CAAC;AACP,gBAAA,EAAE,EAAE,SAAS;AACb,gBAAA,GAAG,EAAE,GAAG;AACX,aAAA,CAAC,CAAC;AACN,SAAA;KACJ;AAED;;;AAGG;AACK,IAAA,SAAS,CAAC,IAAY,EAAA;AAC1B,QAAA,IAAI,IAAgB,CAAC;QAErB,IAAI,IAAI,CAAC,4BAA4B,EAAE;;YAEnC,IAAI,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;YAE9B,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,OAAO,GAAG,CAAC,CAAC,CAAC;AAC7C,SAAA;AAAM,aAAA;AACH,YAAA,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC;AACvB,SAAA;AAED,QAAA,IAAI,GAAG,GAAG,IAAI,UAAU,CAAC,IAAI,CAAC,CAAC;AAE/B,QAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YAC3C,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;AAC1C,SAAA;AAED,QAAA,OAAO,GAAG,CAAC;KACd;AAED;;;AAGG;IACK,eAAe,CAAC,MAAyB,yBAAuB;AACpE,QAAA,IAAI,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC;QAE/B,SAAS,WAAW,CAAC,EAAU,EAAA;AAC3B,YAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,IAAyB,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AAChE,gBAAA,IAAI,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;AAClB,gBAAA,IAAI,IAAI,CAAC,EAAE,KAAK,EAAE,EAAE;oBAChB,OAAO;AACH,wBAAA,GAAG,EAAE,CAAC;wBACN,IAAI;qBACP,CAAC;AACL,iBAAA;AACJ,aAAA;AACD,YAAA,OAAO,IAAI,CAAC;SACf;QAED,IAAI,CAAC,GAAG,WAAW,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;QAChC,IAAI,CAAC,CAAC,EAAE;YACJ,OAAO,CAAC,IAAI,CAAC;gBACT,EAAE,EAAE,MAAM,CAAC,GAAG;gBACd,WAAW,EAAE,MAAM,CAAC,UAAU;AAC9B,gBAAA,QAAQ,EAAE,CAAC;AACX,gBAAA,GAAG,EAAE,EAAE;AACP,gBAAA,GAAG,EAAE,EAAE;AACP,gBAAA,UAAU,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;AAClB,gBAAA,SAAS,EAAE,KAAK;AAChB,gBAAA,KAAK,EAAE,CAAC;AACR,gBAAA,MAAM,EAAE,CAAC;AACZ,aAAA,CAAC,CAAC;AACN,SAAA;KACJ;AA2BJ;;ACxTD;AACA;AACA;AACA;AACA;AAQA;AACA,MAAM,iBAAiB,SAAS,MAAM,CAAC;AACvC,IAAI,WAAW,CAAC,GAAG,EAAE,GAAG,EAAE;AAC1B,QAAQ,KAAK,EAAE,CAAC;AAChB;AACA;AACA,QAAQ,IAAI,CAAC,OAAO,GAAG,GAAG,CAAC;AAC3B;AACA;AACA,QAAQ,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;AACvB;AACA;AACA,QAAQ,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;AAC/B;AACA;AACA,QAAQ,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;AAC/B;AACA;AACA,QAAQ,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;AACjC;AACA;AACA,KAAK;AACL;AACA,IAAI,IAAI,CAAC,IAAI,EAAE;AACf,QAAQ,IAAI,MAAM,GAAG,IAAI,CAAC;AAC1B;AACA,QAAQ,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,KAAK,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACvD,YAAY,KAAK,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;AAC9B;AACA,YAAY,QAAQ,KAAK,CAAC,IAAI;AAC9B,gBAAgB,KAAK,OAAO;AAC5B;AACA,oBAAoB,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;AAC9C,oBAAoB,MAAM;AAC1B,gBAAgB,KAAK,OAAO;AAC5B,oBAAoB,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;AAC9C,oBAAoB,MAAM;AAC1B,gBAAgB,KAAK,SAAS;AAC9B,oBAAoB,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC;AAChD,oBAAoB,MAAM;AAC1B,aAAa;AACb,SAAS;AACT,KAAK;AACL;AACA,IAAI,KAAK,GAAG;AACZ,QAAQ,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;AAC1B;AACA,QAAQ,IAAI,CAAC,YAAY,EAAE,CAAC;AAC5B,KAAK;AACL;AACA,IAAI,KAAK,GAAG;AACZ,QAAQ,IAAI,CAAC,YAAY,EAAE,CAAC;AAC5B;AACA;AACA;AACA,KAAK;AACL;AACA,IAAI,YAAY,GAAG;AACnB,QAAQ,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;AAC/B,QAAQ,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;AAC/B,QAAQ,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;AACjC,KAAK;AACL;AACA,IAAI,aAAa,CAAC,IAAI,EAAE;AACxB,QAAQ,IAAI,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AACrD;AACA,QAAQ,IAAI,KAAK,EAAE;AACnB,YAAY,KAAK,CAAC,IAAI,GAAG,OAAO,CAAC;AACjC,YAAY,KAAK,CAAC,IAAI,GAAG,IAAI,CAAC;AAC9B,YAAY,KAAK,CAAC,QAAQ,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC;AAC5C,YAAY,KAAK,CAAC,QAAQ,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC;AAC5C;AACA;AACA,YAAY,KAAK,CAAC,QAAQ,GAAG,MAAM,CAAC,iBAAiB,CAAC;AACtD;AACA,YAAY,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;AACpC;AACA,YAAY,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;AAC9B,gBAAgB,UAAU,EAAE,IAAI,CAAC,UAAU;AAC3C,aAAa,CAAC,CAAC;AACf,SAAS;AACT,KAAK;AACL;AACA,IAAI,aAAa,CAAC,MAAM,EAAE;AAC1B,QAAQ,IAAI,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;AACvD;AACA,QAAQ,IAAI,KAAK,EAAE;AACnB,YAAY,KAAK,CAAC,IAAI,GAAG,OAAO,CAAC;AACjC,YAAY,KAAK,CAAC,MAAM,GAAG,MAAM,CAAC;AAClC,YAAY,KAAK,CAAC,QAAQ,GAAG,KAAK,CAAC,QAAQ,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC;AAC5D;AACA;AACA;AACA,YAAY,KAAK,CAAC,QAAQ,GAAG,MAAM,CAAC,iBAAiB,CAAC;AACtD;AACA,YAAY,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;AACpC;AACA,YAAY,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;AAC9B,gBAAgB,UAAU,EAAE,IAAI,CAAC,UAAU;AAC3C,aAAa,CAAC,CAAC;AACf,SAAS;AACT,KAAK;AACL;AACA,IAAI,eAAe,GAAG,EAAE;AACxB;;ACpHA;;;;AAIG;AASH;;;;;;;;;;;;;;;;;;AAkBG;AACH,MAAM,aAAa,GAAG,CAAC,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;AAEhH,qBAAe,CAAC,eAAuB,EAAE,sBAA8B,EAAE,YAAoB,KAAI;AAC7F,IAAA,IAAI,0BAA0B,CAAC;IAC/B,IAAI,mBAAmB,GAAG,eAAe,CAAC;AAC1C,IAAA,IAAI,MAAM,CAAC;AAEX,IAAA,IAAI,sBAAsB,GAAG,aAAa,CAAC,MAAM,GAAG,CAAC,EAAE;AACnD,QAAA,MAAM,CAAC,KAAK,CAAC,0BAA0B,sBAAsB,CAAA,CAAE,CAAC,CAAC;QACjE,OAAO;AACV,KAAA;IAED,eAAe,GAAG,CAAC,CAAC;AACpB,IAAA,MAAM,GAAG,IAAI,KAAK,CAAC,CAAC,CAAC,CAAC;;IAEtB,IAAI,sBAAsB,IAAI,CAAC,EAAE;;;;AAI7B,QAAA,0BAA0B,GAAG,sBAAsB,GAAG,CAAC,CAAC;AAC3D,KAAA;AAAM,SAAA;;;QAGH,IAAI,YAAY,KAAK,CAAC,EAAE;YACpB,eAAe,GAAG,CAAC,CAAC;AACpB,YAAA,MAAM,GAAG,IAAI,KAAK,CAAC,CAAC,CAAC,CAAC;AACzB,SAAA;QACD,0BAA0B,GAAG,sBAAsB,CAAC;AACvD,KAAA;AACD;;;;;;;;;;;;;;;;;AAiBM;;AAEN,IAAA,MAAM,CAAC,CAAC,CAAC,GAAG,eAAe,IAAI,CAAC,CAAC;;IAEjC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,sBAAsB,GAAG,IAAI,KAAK,CAAC,CAAC;IAClD,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,sBAAsB,GAAG,IAAI,KAAK,CAAC,CAAC;;AAElD,IAAA,MAAM,CAAC,CAAC,CAAC,IAAI,YAAY,IAAI,CAAC,CAAC;IAC/B,IAAI,eAAe,KAAK,CAAC,EAAE;;QAEvB,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,0BAA0B,GAAG,IAAI,KAAK,CAAC,CAAC;QACtD,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,0BAA0B,GAAG,IAAI,KAAK,CAAC,CAAC;;;AAGrD,QAAA,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AACpB,QAAA,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;AACjB,KAAA;IAED,OAAO;AACH,QAAA,MAAM,EAAE,MAAM;AACd,QAAA,UAAU,EAAE,aAAa,CAAC,sBAAsB,CAAC;AACjD,QAAA,YAAY,EAAE,YAAY;QAC1B,KAAK,EAAE,UAAU,GAAG,eAAe;QACnC,SAAS,EAAE,UAAU,GAAG,mBAAmB;KAC9C,CAAC;AACN,CAAC;;ACvGD;;;;AAIG;AAoBI,MAAM,wBAAwB,GAAG;IACpC,KAAK;IACL,KAAK;IACL,KAAK;IACL,KAAK;IACL,KAAK;IACL,KAAK;IACL,KAAK;IACL,KAAK;IACL,KAAK;IACL,KAAK;IACL,KAAK;IACL,IAAI;IACJ,IAAI;CACP;;ACtCD;;;;AAIG;AAeH;;AAEG;AACH,MAAM,SAAU,SAAQ,YAAY,CAAA;AAChC,IAAA,WAAA,GAAA;AACI,QAAA,KAAK,EAAE,CAAC;KACX;AAED,IAAA,IAAI,CAAC,IAAkB,EAAA;QACnB,IAAI,EAAE,GAAG,EAAE,GAAG,EAAE,OAAO,EAAE,GAAG,IAAI,CAAC;QACjC,IAAI,SAAS,GAAG,OAAO,CAAC;AACxB,QAAA,IAAI,CAAC,GAAG,CAAC,EACL,QAAQ,GAAG,CAAC,EACZ,WAAW,EACX,mBAAmB,EACnB,QAAQ,EACR,WAAW,EACX,iBAAiB,CAAC;AAEtB,QAAA,OAAO,CAAC,GAAG,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE;;AAE7B,YAAA,IAAI,SAAS,CAAC,CAAC,CAAC,KAAK,IAAI,IAAI,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,MAAM,IAAI,EAAE;;;AAG7D,gBAAA,CAAC,EAAE,CAAC;gBACJ,SAAS;AACZ,aAAA;;;AAID,YAAA,mBAAmB,GAAG,CAAC,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,IAAI,CAAC,CAAC;;;YAIrD,WAAW;AACP,gBAAA,CAAC,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,KAAK,EAAE,KAAK,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,KAAK,CAAC,CAAC,CAAC;AAEnG,YAAA,WAAW,GAAG,CAAC,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,IAAI,CAAC,IAAI,IAAI,CAAC;YACrD,iBAAiB,GAAG,CAAC,WAAW,GAAG,KAAK,IAAI,wBAAwB,CAAC,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,MAAM,CAAC,CAAC,CAAC;AAEtG,YAAA,QAAQ,GAAG,CAAC,GAAG,WAAW,CAAC;;;AAI3B,YAAA,IAAI,SAAS,CAAC,UAAU,GAAG,QAAQ,EAAE;gBACjC,OAAO;AACV,aAAA;AAED,YAAA,IAAI,QAAQ,GAAa;AACrB,gBAAA,GAAG,EAAE,GAAG,GAAG,QAAQ,GAAG,iBAAiB;AACvC,gBAAA,GAAG,EAAE,GAAG,GAAG,QAAQ,GAAG,iBAAiB;AACvC,gBAAA,WAAW,EAAE,WAAW;AACxB,gBAAA,eAAe,EAAE,CAAC,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,IAAI,IAAI,IAAI,CAAC;AACtD,gBAAA,YAAY,EAAE,CAAC,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,MAAM,CAAC,CAAC;AAC/E,gBAAA,UAAU,EAAE,wBAAwB,CAAC,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,MAAM,CAAC,CAAC;AACrE,gBAAA,sBAAsB,EAAE,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,MAAM,CAAC;;AAEvD,gBAAA,UAAU,EAAE,EAAE;AACd,gBAAA,IAAI,EAAE,SAAS,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,GAAG,mBAAmB,EAAE,QAAQ,CAAC;aAClE,CAAC;;AAEF,YAAA,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;;AAG7B,YAAA,IAAI,SAAS,CAAC,UAAU,KAAK,QAAQ,EAAE;gBACnC,SAAS,GAAG,SAAS,CAAC;AAEtB,gBAAA,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBAClB,OAAO;AACV,aAAA;AAED,YAAA,QAAQ,EAAE,CAAC;;AAGX,YAAA,SAAS,GAAG,SAAS,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;AAC5C,SAAA;KACJ;AACJ;;AChGD;;;;AAIG;AAaH,MAAM,UAAW,SAAQ,MAAM,CAAA;AACnB,IAAA,GAAG,CAAM;AACT,IAAA,OAAO,CAAU;AACjB,IAAA,KAAK,CAAY;AACjB,IAAA,MAAM,CAAiB;AAE/B,IAAA,WAAA,CAAY,GAAQ,EAAA;AAChB,QAAA,KAAK,EAAE,CAAC;AAER,QAAA,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;AACf,QAAA,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;;AAGpB,QAAA,IAAI,CAAC,KAAK,GAAG,IAAI,SAAS,EAAE,CAAC;QAE7B,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,KAAe,KAAI;AACvC,YAAA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YACxB,IAAI,CAAC,MAAM,CAAC,UAAU,IAAI,KAAK,CAAC,IAAI,CAAC,UAAU,CAAC;YAChD,IAAI,CAAC,MAAM,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;AACvC,SAAC,CAAC,CAAC;QAEH,IAAI,CAAC,UAAU,EAAE,CAAC;KACrB;AAED,IAAA,IAAI,CAAC,IAAuB,EAAA;AACxB,QAAA,IAAI,IAAI,CAAC,WAAW,KAAA,EAAA,yBAAuB;AACvC,YAAA,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC;AAExB,YAAA,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC;AACZ,gBAAA,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,GAAG;AACjB,gBAAA,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,GAAG;AACjB,gBAAA,OAAO,EAAE,IAAI,CAAC,GAAG,CAAC,SAAS;AAC9B,aAAA,CAAC,CAAC;AACN,SAAA;KACJ;IAED,KAAK,GAAA;AACD,QAAA,IAAI,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,EAAE;AACxB,YAAA,IAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC;YAC/B,IAAI,UAAU,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;YAChC,IAAI,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC;AACvC,YAAA,IAAI,YAAY,GAAG,CAAC,SAAS,CAAC,UAAU,GAAG,SAAS,CAAC,WAAW,IAAI,KAAK,CAAC;YAE1E,IAAI,CAAC,MAAM,CAAC,QAAQ,GAAG,UAAU,CAAC,GAAG,CAAC;YACtC,IAAI,CAAC,MAAM,CAAC,QAAQ,GAAG,UAAU,CAAC,GAAG,CAAC;YAEtC,IAAI,KAAK,KAAK,CAAC,EAAE;AACb,gBAAA,IAAI,CAAC,MAAM,CAAC,QAAQ,GAAG,YAAY,CAAC;AACvC,aAAA;AAAM,iBAAA;AACH,gBAAA,IAAI,CAAC,MAAM,CAAC,QAAQ,GAAG,YAAY,IAAI,SAAS,CAAC,GAAG,GAAG,UAAU,CAAC,GAAG,CAAC,CAAC;AAC1E,aAAA;;;AAID,YAAA,IAAI,CAAC,gBAAgB,CAAC,UAAU,CAAC,CAAC;YAElC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;YAE/B,IAAI,CAAC,KAAK,EAAE,CAAC;AACb,YAAA,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;AACrB,SAAA;KACJ;IAED,KAAK,GAAA;AACD,QAAA,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QACpB,IAAI,CAAC,UAAU,EAAE,CAAC;KACrB;IAED,UAAU,GAAA;AACN,QAAA,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC;AACjB,QAAA,IAAI,CAAC,MAAM,CAAC,IAAI,GAAG,OAAO,CAAC;AAC3B,QAAA,IAAI,CAAC,MAAM,CAAC,UAAU,GAAG,CAAC,CAAC;AAC3B,QAAA,IAAI,CAAC,MAAM,CAAC,QAAQ,GAAG,CAAC,CAAC;AACzB,QAAA,IAAI,CAAC,MAAM,CAAC,QAAQ,GAAG,CAAC,CAAC;AACzB,QAAA,IAAI,CAAC,MAAM,CAAC,QAAQ,GAAG,CAAC,CAAC;KAC5B;AAED;;AAEG;AACH,IAAA,gBAAgB,CAAC,KAAe,EAAA;AAC5B,QAAA,IAAI,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AAC7C,QAAA,IAAI,MAAM,GAAG,cAAc,CAAC,KAAK,CAAC,eAAe,EAAE,KAAK,CAAC,sBAAsB,EAAE,KAAK,CAAC,YAAY,CAAC,CAAC;AACrG,QAAA,KAAK,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC;AAC7B,QAAA,KAAK,CAAC,UAAU,GAAG,MAAM,CAAC,UAAU,CAAC;QACrC,KAAK,CAAC,cAAc,GAAG,KAAK,CAAC,cAAc,IAAI,KAAK,CAAC,SAAS,CAAC;AAC/D,QAAA,KAAK,CAAC,SAAS,GAAG,MAAM,CAAC,UAAU,CAAC;AACpC,QAAA,KAAK,CAAC,YAAY,GAAG,MAAM,CAAC,YAAY,CAAC;AACzC,QAAA,KAAK,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC;AAC3B,QAAA,KAAK,CAAC,SAAS,GAAG,MAAM,CAAC,SAAS,CAAC;AACnC,QAAA,KAAK,CAAC,KAAK,GAAG,IAAI,CAAC;KACtB;AACJ;;AC7GD;;;;AAIG;AAEH;;AAEG;AAEH,SAAS,IAAI,CAAC,GAA6B,EAAA;IACvC,IAAI,UAAU,GAAG,CAAC,CAAC;AAEnB,IAAA,IAAI,WAAW,CAAC,MAAM,CAAC,GAAG,CAAC,EAAE;AACzB,QAAA,UAAU,GAAG,GAAG,CAAC,UAAU,CAAC;AAC5B,QAAA,GAAG,GAAG,GAAG,CAAC,MAAM,CAAC;AACpB,KAAA;AAED,IAAA,OAAO,IAAI,QAAQ,CAAC,GAAG,EAAE,UAAU,CAAC,CAAC;AACzC,CAAC;AAED,MAAM,cAAc,CAAA;AAChB,IAAA,WAAA,GAAA,GAAgB;AAEhB;;;;;AAKG;IACH,SAAS,CAAC,MAAgC,EAAE,UAAkB,EAAA;QAC1D,OAAO,IAAI,CAAC,MAAM,CAAC,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;KAC5C;AAED;;;;;;AAMG;AACH,IAAA,UAAU,CAAC,MAAgC,EAAE,UAAU,EAAE,eAAwB,KAAK,EAAA;QAClF,OAAO,IAAI,CAAC,MAAM,CAAC,CAAC,SAAS,CAAC,UAAU,EAAE,YAAY,CAAC,CAAC;KAC3D;AAED;;;;;;AAMG;AACH,IAAA,UAAU,CAAC,MAAgC,EAAE,UAAkB,EAAE,eAAwB,KAAK,EAAA;QAC1F,OAAO,IAAI,CAAC,MAAM,CAAC,CAAC,SAAS,CAAC,UAAU,EAAE,YAAY,CAAC,CAAC;KAC3D;AACJ;;ACvDD;;;;AAIG;AAEH;;;AAGG;AACqB,SAAA,WAAW,CAAC,IAAgB,EAAA;IAChD,IAAI,MAAM,GAAG,IAAI,CAAC,UAAU,EACxB,iCAAiC,GAAG,EAAE,EACtC,CAAC,GAAG,CAAC,EACL,SAAiB,EACjB,OAAO,GAAG,IAAI,UAAU,CAAC,CAAC,CAAC,CAAC;;AAGhC,IAAA,OAAO,CAAC,GAAG,MAAM,GAAG,CAAC,EAAE;QACnB,IAAI,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,IAAI,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,KAAK,IAAI,EAAE;AAC5D,YAAA,iCAAiC,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;YAC9C,CAAC,IAAI,CAAC,CAAC;AACV,SAAA;AAAM,aAAA;AACH,YAAA,CAAC,EAAE,CAAC;AACP,SAAA;AACJ,KAAA;;;AAID,IAAA,IAAI,iCAAiC,CAAC,MAAM,KAAK,CAAC,EAAE;AAChD,QAAA,OAAO,IAAI,CAAC;AACf,KAAA;;AAGD,IAAA,SAAS,GAAG,MAAM,GAAG,iCAAiC,CAAC,MAAM,CAAC;IAE9D,IAAI;AACA,QAAA,OAAO,GAAG,IAAI,UAAU,CAAC,SAAS,CAAC,CAAC;AACvC,KAAA;AAAC,IAAA,OAAO,CAAC,EAAE;QACR,MAAM,CAAA,qBAAA,EAAwB,SAAS,CAAA,CAAE,CAAC;AAC7C,KAAA;IACD,IAAI,WAAW,GAAG,CAAC,CAAC;AAEpB,IAAA,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,EAAE,WAAW,EAAE,EAAE,CAAC,EAAE,EAAE;AAC3C,QAAA,IAAI,WAAW,KAAK,iCAAiC,CAAC,CAAC,CAAC,EAAE;;AAEtD,YAAA,WAAW,EAAE,CAAC;;YAEd,iCAAiC,CAAC,KAAK,EAAE,CAAC;AAC7C,SAAA;QACD,OAAO,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC;AAClC,KAAA;AAED,IAAA,OAAO,OAAO,CAAC;AACnB;;ACtDA;;;;AAIG;AAEH;;;;AAIG;AAEH;;;;;;AAMG;AACG,SAAU,OAAO,CAAC,MAAkB,EAAE,SAAoB,GAAA,CAAC,EAAE,MAAA,GAAiB,CAAC,EAAA;IACjF,IAAI,SAAS,GAAG,CAAC,CAAC;IAClB,IAAI,eAAe,GAAG,CAAC,CAAC;IACxB,IAAI,GAAG,GAAG,CAAC,CAAC;AACZ,IAAA,IAAI,MAAM,GAAG,EAAE,EACX,MAAM,GAAG,CAAC,CAAC;AAEf,IAAA,KAAK,IAAI,CAAC,GAAG,SAAS,EAAE,CAAC,GAAG,SAAS,GAAG,MAAM,EAAE,CAAC,EAAE,EAAE;QACjD,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;QAC9B,eAAe,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;QAC9B,MAAM,GAAG,CAAC,MAAM,CAAC,SAAS,CAAC,IAAI,eAAe,IAAI,IAAI,CAAC;QAEvD,MAAM,IAAI,MAAM,CAAC;AACpB,KAAA;AAED,IAAA,GAAG,GAAG,QAAQ,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;AAE1B,IAAA,OAAO,GAAG,CAAC;AACf,CAAC;AAED;;;;AAIG;SACa,QAAQ,CAAC,MAAkB,EAAE,YAAoB,CAAC,EAAA;IAC9D,OAAO,OAAO,CAAC,MAAM,EAAE,SAAS,EAAE,CAAC,CAAC,CAAC;AACzC,CAAC;AAED;;;;AAIG;SACa,OAAO,CAAC,MAAkB,EAAE,YAAoB,CAAC,EAAA;IAC7D,IAAI,YAAY,GAAG,EAAE,CAAC;AACtB,IAAA,IAAI,SAAS,GAAG,MAAM,CAAC,UAAU,GAAG,CAAC,CAAC;IACtC,IAAI,QAAQ,GAAG,KAAK,CAAC;IACrB,IAAI,SAAS,GAAG,CAAC,CAAC;IAClB,IAAI,eAAe,GAAG,CAAC,CAAC;IACxB,IAAI,MAAM,GAAG,CAAC,CAAC;IACf,IAAI,KAAK,GAAG,EAAE,CAAC;;IAGf,KAAK,IAAI,CAAC,GAAG,SAAS,EAAE,CAAC,GAAG,SAAS,EAAE,CAAC,EAAE,EAAE;QACxC,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;QAC9B,eAAe,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;QAE9B,MAAM,GAAG,CAAC,MAAM,CAAC,SAAS,CAAC,IAAI,eAAe,IAAI,IAAI,CAAC;QAEvD,IAAI,CAAC,QAAQ,EAAE;YACX,IAAI,MAAM,KAAK,CAAC,EAAE;AACd,gBAAA,YAAY,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;AACxB,aAAA;AAAM,iBAAA;gBACH,QAAQ,GAAG,IAAI,CAAC;gBAChB,SAAS,GAAG,CAAC,CAAC;gBACd,MAAM;AACT,aAAA;AACJ,SAAA;AACJ,KAAA;AAED,IAAA,IAAI,aAAa,GAAG,YAAY,CAAC,MAAM,GAAG,CAAC,CAAC;;AAG5C,IAAA,KAAK,IAAI,CAAC,GAAG,SAAS,EAAE,CAAC,GAAG,SAAS,GAAG,aAAa,EAAE,CAAC,EAAE,EAAE;QACxD,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;QAC9B,eAAe,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;QAC9B,MAAM,GAAG,CAAC,MAAM,CAAC,SAAS,CAAC,IAAI,eAAe,IAAI,IAAI,CAAC;QAEvD,KAAK,IAAI,MAAM,CAAC;AACnB,KAAA;IAED,OAAO;AACH,QAAA,SAAS,EAAE,YAAY,CAAC,MAAM,GAAG,aAAa;QAC9C,KAAK,EAAE,QAAQ,CAAC,KAAK,EAAE,CAAC,CAAC,GAAG,CAAC;KAChC,CAAC;AACN,CAAC;AAED;;;;AAIG;SACa,OAAO,CAAC,MAAkB,EAAE,YAAoB,CAAC,EAAA;IAC7D,IAAI,GAAG,GAAG,OAAO,CAAC,MAAM,EAAE,SAAS,CAAC,CAAC;AACrC,IAAA,IAAI,OAAO,GAAG,GAAG,CAAC,KAAK,CAAC;IAExB,IAAI,WAAW,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,OAAO,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC,CAAC;IAErE,OAAO;QACH,SAAS,EAAE,GAAG,CAAC,SAAS;AACxB,QAAA,KAAK,EAAE,WAAW;KACrB,CAAC;AACN,CAAC;AAED,gBAAe;IACX,OAAO;IACP,OAAO;IACP,OAAO;IACP,QAAQ;CACX;;ACvHD;;;;AAIG;AAIH,IAAI,SAAS,GAAG,CAAC,CAAC;AAuBlB;;;;AAIG;AACH,SAAS,YAAY,CAAC,WAAW,EAAE,IAAI,EAAA;IACnC,IAAI,SAAS,GAAG,CAAC,CAAC;IAClB,IAAI,SAAS,GAAG,CAAC,CAAC;AAClB,IAAA,IAAI,WAAW,CAAC;IAEhB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,EAAE,CAAC,EAAE,EAAE;QAC3B,IAAI,SAAS,IAAI,CAAC,EAAE;YAChB,WAAW,GAAG,SAAS,CAAC,OAAO,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;AACxD,YAAA,SAAS,IAAI,WAAW,CAAC,SAAS,CAAC;AAEnC,YAAA,SAAS,GAAG,CAAC,SAAS,GAAG,WAAW,CAAC,KAAK,GAAG,GAAG,IAAI,GAAG,CAAC;AAC3D,SAAA;AAED,QAAA,SAAS,GAAG,WAAW,CAAC,CAAC,CAAC,CAAC;AAC9B,KAAA;AACL,CAAC;AAED;;;AAGG;AACG,SAAU,SAAS,CAAC,OAAmB,EAAA;IACzC,SAAS,GAAG,CAAC,CAAC;AAEd,IAAA,IAAI,WAAW,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;AAC7B,IAAA,IAAI,qBAAqB,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;AACvC,IAAA,IAAI,SAAS,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;IAC3B,IAAI,YAAY,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;AACvC,IAAA;;IAEI,+BAA+B,GAAG,CAAC,CAAC;AACxC,IAAA,IAAI,UAAU,CAAC;AACf,IAAA;AACI,IAAA,QAAQ,EACR,SAAS,EACT,WAAW,CAAC;IAChB,IAAI,UAAU,GAAqB,CAAC,CAAC,EAAE,CAAC,CAAC,EACrC,UAAU,GAAG,CAAC,CAAC;AACnB,IAAA,IAAI,YAAoB,CAAC;IACzB,IAAI,GAAG,GAAG,CAAC,EACP,iBAAyB,EACzB,UAAkB,EAClB,qBAAqB,GAAY,IAAI,CAAC;;IAG1C,IAAI,MAAM,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AACxD,IAAA,SAAS,IAAI,MAAM,CAAC,SAAS,CAAC;IAE9B,IACI,WAAW,IAAI,GAAG;AAClB,QAAA,WAAW,IAAI,GAAG;AAClB,QAAA,WAAW,IAAI,GAAG;AAClB,QAAA,WAAW,IAAI,GAAG;AAClB,QAAA,WAAW,IAAI,EAAE;AACjB,QAAA,WAAW,IAAI,EAAE;AACjB,QAAA,WAAW,IAAI,EAAE;AACjB,QAAA,WAAW,IAAI,GAAG;QAClB,WAAW,IAAI,GAAG,EACpB;;QAEE,IAAI,WAAW,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AAC7D,QAAA,SAAS,IAAI,WAAW,CAAC,SAAS,CAAC;AAEnC,QAAA,IAAI,WAAW,CAAC,KAAK,IAAI,CAAC,EAAE;;YAExB,SAAS,IAAI,CAAC,CAAC;AAClB,SAAA;;QAGD,IAAI,SAAS,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AAC3D,QAAA,SAAS,IAAI,SAAS,CAAC,SAAS,CAAC;;QAGjC,IAAI,SAAS,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AAC3D,QAAA,SAAS,IAAI,SAAS,CAAC,SAAS,CAAC;;;QAIjC,SAAS,IAAI,CAAC,CAAC;;QAGf,+BAA+B,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;QAC7E,SAAS,IAAI,CAAC,CAAC;AAEf,QAAA,IAAI,+BAA+B,EAAE;YACjC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,WAAW,CAAC,KAAK,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE;gBACxD,IAAI,6BAA6B,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;gBAC/E,SAAS,IAAI,CAAC,CAAC;AAEf,gBAAA,IAAI,6BAA6B,EAAE;oBAC/B,IAAI,CAAC,GAAG,CAAC,EAAE;AACP,wBAAA,YAAY,CAAC,YAAY,EAAE,EAAE,CAAC,CAAC;AAClC,qBAAA;AAAM,yBAAA;AACH,wBAAA,YAAY,CAAC,YAAY,EAAE,EAAE,CAAC,CAAC;AAClC,qBAAA;AACJ,iBAAA;AACJ,aAAA;AACJ,SAAA;AACJ,KAAA;;IAGD,IAAI,QAAQ,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AAC1D,IAAA,SAAS,IAAI,QAAQ,CAAC,SAAS,CAAC;;IAGhC,IAAI,OAAO,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AACzD,IAAA,IAAI,kBAAkB,GAAG,OAAO,CAAC,KAAK,CAAC;AACvC,IAAA,SAAS,IAAI,OAAO,CAAC,SAAS,CAAC;IAE/B,IAAI,kBAAkB,KAAK,CAAC,EAAE;;QAE1B,UAAU,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AACxD,QAAA,SAAS,IAAI,UAAU,CAAC,SAAS,CAAC;AACrC,KAAA;SAAM,IAAI,kBAAkB,KAAK,CAAC,EAAE;;QAEjC,SAAS,IAAI,CAAC,CAAC;;QAGf,QAAQ,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AACtD,QAAA,SAAS,IAAI,QAAQ,CAAC,SAAS,CAAC;;QAGhC,SAAS,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AACvD,QAAA,SAAS,IAAI,SAAS,CAAC,SAAS,CAAC;;QAGjC,WAAW,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AACzD,QAAA,SAAS,IAAI,WAAW,CAAC,SAAS,CAAC;;AAGnC,QAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,IAAI,EAAE,CAAC,GAAG,WAAW,CAAC,KAAK,EAAE,CAAC,EAAE,EAAE;YAC9C,IAAI,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AAClD,YAAA,SAAS,IAAI,IAAI,CAAC,SAAS,CAAC;;AAG/B,SAAA;AACJ,KAAA;;;;IAKD,IAAI,OAAO,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AACzD,IAAA,SAAS,IAAI,OAAO,CAAC,SAAS,CAAC;;;IAI/B,SAAS,IAAI,CAAC,CAAC;;IAGf,IAAI,WAAW,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AAC7D,IAAA,SAAS,IAAI,WAAW,CAAC,SAAS,CAAC;;IAGnC,IAAI,YAAY,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AAC9D,IAAA,SAAS,IAAI,YAAY,CAAC,SAAS,CAAC;;;;IAKpC,IAAI,mBAAmB,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;IACrE,SAAS,IAAI,CAAC,CAAC;IAEf,IAAI,CAAC,mBAAmB,EAAE;;;QAGtB,SAAS,IAAI,CAAC,CAAC;AAClB,KAAA;;;IAID,SAAS,IAAI,CAAC,CAAC;;IAGf,IAAI,mBAAmB,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;IACrE,SAAS,IAAI,CAAC,CAAC;AAEf,IAAA,IAAI,QAAQ,GAAG,CAAC,EACZ,SAAS,GAAG,CAAC,EACb,OAAO,GAAG,CAAC,EACX,UAAU,GAAG,CAAC,CAAC;AACnB,IAAA,IAAI,mBAAmB,EAAE;QACrB,IAAI,OAAO,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AACzD,QAAA,SAAS,IAAI,OAAO,CAAC,SAAS,CAAC;AAC/B,QAAA,QAAQ,GAAG,OAAO,CAAC,KAAK,CAAC;QAEzB,IAAI,OAAO,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AACzD,QAAA,SAAS,IAAI,OAAO,CAAC,SAAS,CAAC;AAC/B,QAAA,SAAS,GAAG,OAAO,CAAC,KAAK,CAAC;QAE1B,IAAI,OAAO,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AACzD,QAAA,SAAS,IAAI,OAAO,CAAC,SAAS,CAAC;AAC/B,QAAA,OAAO,GAAG,OAAO,CAAC,KAAK,CAAC;QAExB,IAAI,OAAO,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AACzD,QAAA,SAAS,IAAI,OAAO,CAAC,SAAS,CAAC;AAC/B,QAAA,UAAU,GAAG,OAAO,CAAC,KAAK,CAAC;AAC9B,KAAA;;IAGD,IAAI,2BAA2B,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;IAC7E,SAAS,IAAI,CAAC,CAAC;AAEf,IAAA,IAAI,2BAA2B,EAAE;;;;QAK7B,IAAI,8BAA8B,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;QAChF,SAAS,IAAI,CAAC,CAAC;AAEf,QAAA,IAAI,8BAA8B,EAAE;YAChC,MAAM,cAAc,GAAG,SAAS,CAAC,QAAQ,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;YACnE,SAAS,IAAI,CAAC,CAAC;AAEf,YAAA,QAAQ,cAAc;AAClB,gBAAA,KAAK,CAAC;AACF,oBAAA,UAAU,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;oBACpB,MAAM;AACV,gBAAA,KAAK,CAAC;AACF,oBAAA,UAAU,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;oBACtB,MAAM;AACV,gBAAA,KAAK,CAAC;AACF,oBAAA,UAAU,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;oBACtB,MAAM;AACV,gBAAA,KAAK,CAAC;AACF,oBAAA,UAAU,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;oBACtB,MAAM;AACV,gBAAA,KAAK,CAAC;AACF,oBAAA,UAAU,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;oBACtB,MAAM;AACV,gBAAA,KAAK,CAAC;AACF,oBAAA,UAAU,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;oBACtB,MAAM;AACV,gBAAA,KAAK,CAAC;AACF,oBAAA,UAAU,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;oBACtB,MAAM;AACV,gBAAA,KAAK,CAAC;AACF,oBAAA,UAAU,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;oBACtB,MAAM;AACV,gBAAA,KAAK,CAAC;AACF,oBAAA,UAAU,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;oBACtB,MAAM;AACV,gBAAA,KAAK,EAAE;AACH,oBAAA,UAAU,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;oBACtB,MAAM;AACV,gBAAA,KAAK,EAAE;AACH,oBAAA,UAAU,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;oBACtB,MAAM;AACV,gBAAA,KAAK,EAAE;AACH,oBAAA,UAAU,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;oBACtB,MAAM;AACV,gBAAA,KAAK,EAAE;AACH,oBAAA,UAAU,GAAG,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;oBACvB,MAAM;AACV,gBAAA,KAAK,EAAE;AACH,oBAAA,UAAU,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;oBACpB,MAAM;AACV,gBAAA,KAAK,EAAE;AACH,oBAAA,UAAU,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;oBACpB,MAAM;AACV,gBAAA,KAAK,EAAE;AACH,oBAAA,UAAU,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;oBACpB,MAAM;gBACV,KAAK,GAAG,EAAE;oBACN,IAAI,MAAM,GAAG,SAAS,CAAC,QAAQ,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;oBACzD,SAAS,IAAI,CAAC,CAAC;oBACf,IAAI,MAAM,GAAG,SAAS,CAAC,QAAQ,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;oBACzD,SAAS,IAAI,CAAC,CAAC;oBACf,IAAI,OAAO,GAAG,SAAS,CAAC,QAAQ,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;oBAC1D,SAAS,IAAI,CAAC,CAAC;oBACf,IAAI,OAAO,GAAG,SAAS,CAAC,QAAQ,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;oBAC1D,SAAS,IAAI,CAAC,CAAC;AACf,oBAAA,UAAU,GAAG,CAAC,CAAC,MAAM,IAAI,CAAC,IAAI,MAAM,EAAE,CAAC,OAAO,IAAI,CAAC,IAAI,OAAO,CAAC,CAAC;oBAChE,MAAM;AACT,iBAAA;AACJ,aAAA;AAED,YAAA,IAAI,UAAU,EAAE;gBACZ,UAAU,GAAG,UAAU,CAAC,CAAC,CAAC,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC;AAC9C,aAAA;YAED,IAAI,cAAc,KAAK,GAAG,EAAE;;gBAExB,SAAS,IAAI,EAAE,CAAC;;gBAEhB,SAAS,IAAI,EAAE,CAAC;AACnB,aAAA;AACJ,SAAA;QAED,IAAI,0BAA0B,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;QAC5E,SAAS,IAAI,CAAC,CAAC;AAEf,QAAA,IAAI,0BAA0B,EAAE;YAC5B,SAAS,IAAI,CAAC,CAAC;;AAElB,SAAA;QAED,IAAI,8BAA8B,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;QAChF,SAAS,IAAI,CAAC,CAAC;AAEf,QAAA,IAAI,8BAA8B,EAAE;AAChC;;;;;;;;;;;AAWG;YACH,YAAY,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,EAAE,CAAC,CAAC,CAAC;YAC7D,SAAS,IAAI,CAAC,CAAC;;;;YAMf,SAAS,IAAI,CAAC,CAAC;YAEf,IAAI,+BAA+B,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;YACjF,SAAS,IAAI,CAAC,CAAC;AAEf,YAAA,IAAI,+BAA+B,EAAE;;;;gBAIjC,SAAS,IAAI,EAAE,CAAC;AACnB,aAAA;AACJ,SAAA;QAED,IAAI,4BAA4B,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;QAC9E,SAAS,IAAI,CAAC,CAAC;AAEf,QAAA,IAAI,4BAA4B,EAAE;YAC9B,IAAI,gCAAgC,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AAClF,YAAA,SAAS,IAAI,gCAAgC,CAAC,SAAS,CAAC;YAExD,IAAI,mCAAmC,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AACrF,YAAA,SAAS,IAAI,mCAAmC,CAAC,SAAS,CAAC;AAC9D,SAAA;QAED,IAAI,wBAAwB,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;QAC1E,SAAS,IAAI,CAAC,CAAC;AAEf,QAAA,IAAI,wBAAwB,EAAE;YAC1B,iBAAiB,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,EAAE,EAAE,CAAC,CAAC;YACnE,SAAS,IAAI,EAAE,CAAC;YAEhB,UAAU,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,EAAE,EAAE,CAAC,CAAC;YAC5D,SAAS,IAAI,EAAE,CAAC;YAEhB,qBAAqB,GAAG,CAAC,CAAC,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;YACrE,SAAS,IAAI,CAAC,CAAC;YAEf,GAAG,GAAG,UAAU,IAAI,iBAAiB,GAAG,CAAC,CAAC,CAAC;AAC9C,SAAA;;;AAIJ,KAAA;;;IAKD,OAAO;AACH,QAAA,OAAO,EAAE,YAAY;QAErB,WAAW;QACX,qBAAqB;QACrB,SAAS;QACT,MAAM,EAAE,MAAM,CAAC,KAAK;QACpB,yBAAyB,EAAE,OAAO,CAAC,KAAK;QACxC,kBAAkB;QAClB,iCAAiC,EAAE,UAAU,GAAG,UAAU,CAAC,KAAK,GAAG,CAAC;QAEpE,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,WAAW,CAAC,KAAK,GAAG,CAAC,IAAI,EAAE,GAAG,QAAQ,GAAG,CAAC,GAAG,SAAS,GAAG,CAAC,IAAI,UAAU,CAAC;QAC5F,MAAM,EAAE,CAAC,CAAC,GAAG,mBAAmB,KAAK,YAAY,CAAC,KAAK,GAAG,CAAC,CAAC,GAAG,EAAE,GAAG,OAAO,GAAG,CAAC,GAAG,UAAU,GAAG,CAAC;QAEhG,UAAU;QACV,YAAY;QAEZ,GAAG;AACH,QAAA,QAAQ,EAAE,qBAAqB;KAClC,CAAC;AACN;;ACvaA;;;;AAIG;AAQH;;;AAGG;AACG,SAAU,SAAS,CAAC,OAAmB,EAAA;IACzC,IAAI,SAAS,GAAG,CAAC,CAAC;IAElB,IAAI,YAAY,GAAG,OAAO,CAAC;AAC3B,IAAA;IACI,aAAa,GAAG,EAAE,CAAC;IACvB,IAAI,QAAQ,EAAE,UAAU,CAAC;IACzB,IAAI,CAAC,GAAG,CAAC,CAAC;;IAGV,IAAI,MAAM,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AACxD,IAAA,SAAS,IAAI,MAAM,CAAC,SAAS,CAAC;;IAG9B,IAAI,MAAM,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AACxD,IAAA,SAAS,IAAI,MAAM,CAAC,SAAS,CAAC;;;;;IAM9B,SAAS,IAAI,CAAC,CAAC;;;IAIf,SAAS,IAAI,CAAC,CAAC;;IAGf,IAAI,aAAa,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AAC/D,IAAA,SAAS,IAAI,aAAa,CAAC,SAAS,CAAC;AAErC,IAAA,IAAI,aAAa,CAAC,KAAK,GAAG,CAAC,EAAE;;QAEzB,IAAI,OAAO,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AACzD,QAAA,SAAS,IAAI,OAAO,CAAC,SAAS,CAAC;AAE/B,QAAA,IAAI,MAAM,GAAG,CAAC,EACV,OAAO,CAAC;QAEZ,QAAQ,OAAO,CAAC,KAAK;AACjB,YAAA,KAAK,CAAC;AACF,gBAAA,KAAK,MAAM,GAAG,CAAC,EAAE,MAAM,IAAI,OAAO,CAAC,KAAK,EAAE,MAAM,EAAE,EAAE;;oBAEhD,OAAO,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AACrD,oBAAA,SAAS,IAAI,OAAO,CAAC,SAAS,CAAC;AAClC,iBAAA;gBACD,MAAM;AACV,YAAA,KAAK,CAAC;AACF,gBAAA,KAAK,MAAM,GAAG,CAAC,EAAE,MAAM,IAAI,OAAO,CAAC,KAAK,EAAE,MAAM,EAAE,EAAE;;oBAEhD,OAAO,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AACrD,oBAAA,SAAS,IAAI,OAAO,CAAC,SAAS,CAAC;;oBAE/B,OAAO,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AACrD,oBAAA,SAAS,IAAI,OAAO,CAAC,SAAS,CAAC;AAClC,iBAAA;gBACD,MAAM;AACV,YAAA,KAAK,CAAC,CAAC;AACP,YAAA,KAAK,CAAC,CAAC;AACP,YAAA,KAAK,CAAC;;;gBAGF,SAAS,IAAI,CAAC,CAAC;;gBAEf,QAAQ,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AACtD,gBAAA,SAAS,IAAI,QAAQ,CAAC,SAAS,CAAC;gBAChC,MAAM;AACV,YAAA,KAAK,CAAC;AACF,gBAAA;;oBAEI,UAAU,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AACxD,oBAAA,SAAS,IAAI,UAAU,CAAC,SAAS,CAAC;AAElC,oBAAA,IAAI,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC;AAC3D,oBAAA,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,UAAU,CAAC,KAAK,EAAE,CAAC,EAAE,EAAE;;AAEpC,wBAAA,aAAa,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,EAAE,MAAM,CAAC,CAAC,CAAC;wBACvE,SAAS,IAAI,MAAM,CAAC;AACvB,qBAAA;AACJ,iBAAA;gBACD,MAAM;AACb,SAAA;AACJ,KAAA;;IAGD,IAAI,WAAW,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AAC7D,IAAA,SAAS,IAAI,WAAW,CAAC,SAAS,CAAC;;IAGnC,IAAI,WAAW,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AAC7D,IAAA,SAAS,IAAI,WAAW,CAAC,SAAS,CAAC;;;IAInC,SAAS,IAAI,CAAC,CAAC;;;IAIf,SAAS,IAAI,CAAC,CAAC;;IAGf,IAAI,OAAO,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AACzD,IAAA,SAAS,IAAI,OAAO,CAAC,SAAS,CAAC;;IAE/B,IAAI,OAAO,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AACzD,IAAA,SAAS,IAAI,OAAO,CAAC,SAAS,CAAC;;IAE/B,IAAI,OAAO,GAAG,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AACzD,IAAA,SAAS,IAAI,OAAO,CAAC,SAAS,CAAC;;IAG/B,SAAS,IAAI,CAAC,CAAC;;IAEf,SAAS,IAAI,CAAC,CAAC;;IAEf,SAAS,IAAI,CAAC,CAAC;;;;IAMf,OAAO;AACH,QAAA,aAAa,EAAE,aAAa,CAAC,KAAK,GAAG,CAAC;KACzC,CAAC;AACN;;AC5IA;;;;AAIG;AAIH;;;AAGG;AACG,SAAU,SAAS,CAAC,OAAmB,EAAA;AAEzC,IAAA,OAAO,EAAE,CAAC;AACd;;ACfA;;;;AAIG;AASH;;;;AAIG;AACH,SAAS,UAAU,CAAC,OAAmB,EAAA;;;;;;;;;;;AAYnC,IAAA,OAAO,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;AAC3B,CAAC;AAEoB,MAAA,IAAK,SAAQ,cAAc,CAAA;AAC5C,IAAA,kBAAkB,CAAS;AAC3B,IAAA,OAAO,CAAS;AAChB,IAAA,SAAS,CAAS;AAClB,IAAA,IAAI,CAAa;AACjB,IAAA,OAAO,CAAa;AACpB,IAAA,GAAG,CAAW;AACd,IAAA,GAAG,CAAW;AACd,IAAA,GAAG,CAAW;AACd,IAAA,gBAAgB,CAAS;AACzB,IAAA,GAAG,CAAU;AACb,IAAA,GAAG,CAAU;AAEb,IAAA,WAAA,CAAY,MAAkB,EAAA;AAC1B,QAAA,KAAK,EAAE,CAAC;QAER,IAAI,CAAC,kBAAkB,GAAG,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;;AAGzC,QAAA,IAAI,CAAC,OAAO,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC;;QAGvC,IAAI,CAAC,SAAS,GAAG,MAAM,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC;AAElC,QAAA,IAAI,CAAC,IAAI,GAAG,WAAW,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;AAC5C,QAAA,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;QAEtB,QAAQ,IAAI,CAAC,SAAS;AAClB,YAAA,KAAA,CAAA;gBACI,MAAM;YACV,KAAyB,CAAA,2BAAA;YACzB,KAAyB,CAAA,2BAAA;AACzB,YAAA,KAAA,CAAA;;gBAEI,MAAM;AACV,YAAA,KAAA,CAAA;;gBAEI,MAAM;AACV,YAAA,KAAA,CAAA;gBACI,IAAI,CAAC,GAAG,GAAG,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBAChC,MAAM;AACV,YAAA,KAAA,CAAA;gBACI,IAAI,CAAC,GAAG,GAAG,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBAChC,MAAM;AACV,YAAA,KAAA,CAAA;gBACI,IAAI,CAAC,GAAG,GAAG,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBAChC,MAAM;AACV,YAAA,KAAA,CAAA;gBACI,IAAI,CAAC,gBAAgB,GAAG,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBAC9C,MAAM;AACb,SAAA;KACJ;AACJ;;ACrFD;;;;AAIG;AA6BG,MAAO,QAAS,SAAQ,YAAY,CAAA;IAC9B,SAAS,GAAkB,IAAI,CAAC;IAChC,QAAQ,GAAS,IAAI,CAAC;IACtB,aAAa,GAAkB,IAAI,CAAC;AAEpC,IAAA,SAAS,CAAC,KAAiB,EAAE,GAAW,EAAE,GAAW,EAAA;AACzD,QAAA,IAAI,IAAI,GAAS,IAAI,IAAI,CAAC,KAAK,CAAC,CAAC;AAEjC,QAAA,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;AACf,QAAA,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;AAEf,QAAA,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;AACrB,QAAA,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;KAC3B;AAED,IAAA,IAAI,CAAC,IAAkB,EAAA;AACnB,QAAA,MAAM,EAAE,SAAS,EAAE,aAAa,EAAE,GAAG,IAAI,CAAC;QAC1C,IAAI,CAAC,GAAG,CAAC,EACL,cAAc,GAAG,CAAC,CAAC,EACnB,EAAE,GAAG,EAAE,GAAG,EAAE,OAAO,EAAE,cAAc,EAAE,GAAG,IAAI,CAAC;QAEjD,IAAI,CAAC,cAAc,EAAE;;AAEjB,YAAA,IAAI,CAAC,GAAG,OAAO,CAAC,UAAU,GAAG,CAAC,CAAC;YAC/B,IAAI,eAAe,GAAG,CAAC,CAAC;;;YAIxB,GAAG;AACC,gBAAA,IAAI,OAAO,CAAC,CAAC,CAAC,KAAK,IAAI,EAAE;AACrB,oBAAA,eAAe,EAAE,CAAC;AACrB,iBAAA;AAAM,qBAAA;oBACH,MAAM;AACT,iBAAA;AAED,gBAAA,CAAC,EAAE,CAAC;aACP,QAAQ,CAAC,GAAG,CAAC,EAAE;YAEhB,IAAI,eAAe,IAAI,CAAC,EAAE;;gBAEtB,OAAO,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC;AACxC,aAAA;AAED,YAAA,MAAM,GAAG,GAAG,OAAO,CAAC,MAAM,CAAC;YAE3B,IAAI,KAAK,GAAkB,CAAC,CAAC;YAC7B,GAAG;AACC,gBAAA,IAAI,KAAK,GAAG,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC;;gBAGzB,IAAI,KAAK,KAAK,CAAC,EAAE;oBACb,KAAK,GAAG,KAAK,GAAG,CAAC,GAAG,CAAC,CAAC;oBACtB,SAAS;AACZ,iBAAA;qBAAM,IAAI,KAAK,KAAK,CAAC,EAAE;oBACpB,KAAK,GAAG,KAAK,GAAG,CAAC,GAAG,CAAC,CAAC;oBACtB,SAAS;AACZ,iBAAA;;gBAGD,IAAI,CAAC,KAAK,EAAE;oBACR,KAAK,GAAG,CAAC,CAAC;AACb,iBAAA;qBAAM,IAAI,KAAK,KAAK,CAAC,EAAE;oBACpB,IAAI,cAAc,IAAI,CAAC,EAAE;AACrB,wBAAA,IAAI,CAAC,aAAa,GAAG,KAAK,CAAC;wBAC3B,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,QAAQ,CAAC,cAAc,EAAE,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;AAC7E,qBAAA;AAAM,yBAAA;;;;;AAKH,wBAAA,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;AAC/B,wBAAA,IAAI,QAAQ,EAAE;AACV,4BAAA,IAAI,SAAS,IAAI,CAAC,IAAI,CAAC,GAAG,SAAS,EAAE;;;;AAIjC,gCAAA,IAAI,aAAa,EAAE;;AAEf,oCAAA,QAAQ,CAAC,OAAO,GAAG,QAAQ,CAAC,OAAO,CAAC,QAAQ,CACxC,CAAC,EACD,QAAQ,CAAC,OAAO,CAAC,UAAU,GAAG,SAAS,CAC1C,CAAC;AACL,iCAAA;AACJ,6BAAA;;;;AAKD,4BAAA,IAAI,QAAQ,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,CAAC;4BAC7B,IAAI,QAAQ,GAAG,CAAC,EAAE;gCACd,MAAM,CAAC,GAAG,CAAC,CAAwB,qBAAA,EAAA,QAAQ,CAAI,CAAA,EAAA,GAAG,CAAI,CAAA,EAAA,GAAG,CAAE,CAAA,CAAC,CAAC;AAC7D,gCAAA,IAAI,EAAE,GAAG,IAAI,WAAW,EAAE,CAAC;AAE3B,gCAAA,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;AAC5B,gCAAA,EAAE,CAAC,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,CAAC;AACzC,gCAAA,IAAI,KAAK,GAAG,EAAE,CAAC,UAAU,EAAE,CAAC;AAC5B,gCAAA,EAAE,CAAC,KAAK,EAAE,CAAC;AAEX,gCAAA,QAAQ,CAAC,OAAO,GAAG,KAAK,CAAC;AAC5B,6BAAA;AACJ,yBAAA;AACJ,qBAAA;;oBAGD,IAAI,CAAC,GAAG,GAAG,EAAE;;wBAET,cAAc,GAAG,CAAC,CAAC;wBACnB,KAAK,GAAG,CAAC,CAAC;AACb,qBAAA;AACJ,iBAAA;AAAM,qBAAA;oBACH,KAAK,GAAG,CAAC,CAAC;AACb,iBAAA;aACJ,QAAQ,CAAC,GAAG,GAAG,EAAE;AAElB,YAAA,IAAI,cAAc,IAAI,CAAC,IAAI,KAAK,IAAI,CAAC,EAAE;AACnC,gBAAA,IAAI,CAAC,aAAa,GAAG,KAAK,CAAC;AAC3B,gBAAA,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,QAAQ,CAAC,cAAc,EAAE,GAAG,CAAC,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;AACnE,aAAA;AAED,YAAA,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;AAC1B,SAAA;AAAM,aAAA;AACH,YAAA,IAAI,QAAQ,GAAG,CAAC,EACZ,IAAI,GAAG,CAAC,EACR,MAAM,GAAG,CAAC,EACV,UAAU,GAAG,OAAO,CAAC,MAAM,CAAC;YAChC,GAAG;gBACC,IAAI,GAAG,CAAC,CAAC;gBACT,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,cAAc,EAAE,CAAC,EAAE,EAAE;oBACrC,IAAI,GAAG,IAAI,IAAI,OAAO,CAAC,QAAQ,GAAG,CAAC,CAAC,KAAK,CAAC,cAAc,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;AAC3E,iBAAA;;gBAED,QAAQ,IAAI,cAAc,CAAC;AAC3B,gBAAA,MAAM,GAAG,QAAQ,GAAG,IAAI,CAAC;gBACzB,IAAI,MAAM,GAAG,UAAU,EAAE;oBACrB,MAAM,GAAG,UAAU,CAAC;AACvB,iBAAA;AAED,gBAAA,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,QAAQ,CAAC,QAAQ,EAAE,MAAM,CAAC,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;gBAC7D,QAAQ,GAAG,MAAM,CAAC;aACrB,QAAQ,QAAQ,GAAG,UAAU,EAAE;AACnC,SAAA;AAED,QAAA,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;KACrB;IAED,KAAK,GAAA;AACD,QAAA,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;AACtB,QAAA,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;AACrB,QAAA,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;KAC7B;AACJ;;ACvLD;;;;AAIG;AAGH;AAEA;;;AAGG;AACH,mBAAe,CAAC,GAAa,0BAAyB;AAClD,IAAA,IAAI,WAAW,GAAG,GAAG,CAAC,WAAW,CAAC;AAClC,IAAA,IAAI,qBAAqB,GAAG,GAAG,CAAC,qBAAqB,CAAC;AACtD,IAAA,IAAI,SAAS,GAAG,GAAG,CAAC,SAAS,CAAC;IAC9B,IAAI,WAAW,GAAG,OAAO,CAAC;IAE1B,IAAI,GAAG,GAAG,CAAC,WAAW,EAAE,qBAAqB,EAAE,SAAS,CAAC,CAAC;AAC1D,IAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QACjC,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;AAC5B,QAAA,IAAI,CAAC,CAAC,MAAM,GAAG,CAAC,EAAE;AACd,YAAA,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC;AACf,SAAA;QACD,WAAW,IAAI,CAAC,CAAC;AACpB,KAAA;IAED,OAAO;AACH,QAAA,KAAK,EAAE,WAAW;KACrB,CAAC;AACN,CAAC;;AC/BD;;;;AAIG;AAeH,MAAM,UAAW,SAAQ,MAAM,CAAA;AACnB,IAAA,GAAG,CAAM;AACT,IAAA,OAAO,CAAU;AACjB,IAAA,YAAY,CAAW;AACvB,IAAA,SAAS,CAAW;AACpB,IAAA,KAAK,CAAW;AAChB,IAAA,GAAG,CAAM;AACT,IAAA,IAAI,CAAY;AAExB,IAAA,WAAA,CAAY,GAAQ,EAAA;AAChB,QAAA,KAAK,EAAE,CAAC;AAER,QAAA,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;AACf,QAAA,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;;AAGpB,QAAA,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;;AAGvB,QAAA,IAAI,CAAC,KAAK,GAAG,IAAI,QAAQ,EAAE,CAAC;QAE5B,IAAI,CAAC,OAAO,EAAE,CAAC;QACf,IAAI,CAAC,QAAQ,EAAE,CAAC;QAEhB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,MAAM,EAAE,CAAC,IAAU,KAAI;AACjC,YAAA,IAAI,IAAI,CAAC,SAAS,KAAA,CAAA,sBAAoB;AAClC,gBAAA,IAAI,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;gBAC7C,IAAI,MAAM,GAAG,YAAY,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;;AAGpC,gBAAA,KAAK,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC;gBAC3B,KAAK,CAAC,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC;gBAC7B,KAAK,CAAC,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC;gBAC/B,KAAK,CAAC,UAAU,GAAG,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC;gBACxC,KAAK,CAAC,oBAAoB,GAAG,IAAI,CAAC,GAAG,CAAC,qBAAqB,CAAC;gBAC5D,KAAK,CAAC,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC;gBACpC,KAAK,CAAC,UAAU,GAAG,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC;gBACvC,KAAK,CAAC,GAAG,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AAC9B,aAAA;AAAM,iBAAA,IAAI,IAAI,CAAC,SAAS,KAAA,CAAA,sBAAoB;AACzC,gBAAA,IAAI,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;gBAC7C,KAAK,CAAC,GAAG,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AAC9B,aAAA;AAED,YAAA,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;AACzB,SAAC,CAAC,CAAC;KACN;AAED;;;AAGG;AACH,IAAA,IAAI,CAAC,IAAuB,EAAA;QACxB,MAAM,EAAE,WAAW,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC;AACvC,QAAA,IAAI,WAAW,KAAA,EAAA,2BAAyB,WAAW,gCAAuB;AACtE,YAAA,IAAI,CAAC,OAAO,GAAG,GAAG,CAAC;AAEnB,YAAA,IAAI,OAAO,GAAiB;gBACxB,GAAG,EAAE,GAAG,CAAC,GAAG;gBACZ,GAAG,EAAE,GAAG,CAAC,GAAG;gBACZ,OAAO,EAAE,GAAG,CAAC,SAAS;aACzB,CAAC;AAEF,YAAA,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AAC5B,SAAA;KACJ;IAED,KAAK,GAAA;;AAED,QAAA,IAAI,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,CAAC,EAAE;;AAE9B,YAAA,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,QAAQ,IAAI,IAAI,CAAC,YAAY,CAAC,QAAQ,IAAI,CAAC,EAAE;AAChE,gBAAA,IAAI,CAAC,YAAY,CAAC,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC,QAAQ,IAAI,CAAC,CAAC;AAC7D,aAAA;YAED,IAAI,CAAC,iBAAiB,EAAE,CAAC;AACzB,YAAA,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;AAC1B,SAAA;;AAGD,QAAA,IAAI,IAAI,CAAC,GAAG,CAAC,MAAM,GAAG,CAAC,EAAE;YACrB,IAAI,CAAC,iBAAiB,EAAE,CAAC;AAC5B,SAAA;KACJ;IAED,KAAK,GAAA;AACD,QAAA,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;AAEnB,QAAA,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;QACvB,IAAI,CAAC,OAAO,EAAE,CAAC;QACf,IAAI,CAAC,QAAQ,EAAE,CAAC;KACnB;AAED;;;;AAIG;AACH,IAAA,SAAS,CAAC,UAAU,EAAA;AAChB,QAAA,IAAI,UAAU,CAAC,SAAS,KAAA,CAAA,sBAAoB;AACxC,YAAA,IAAI,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,CAAC,EAAE;AAC9B,gBAAA,IAAI,CAAC,YAAY,CAAC,QAAQ,GAAG,UAAU,CAAC,GAAG,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC;AAEpE,gBAAA,IAAI,IAAI,CAAC,GAAG,CAAC,MAAM,GAAG,CAAC,IAAI,IAAI,CAAC,YAAY,CAAC,QAAQ,EAAE;oBACnD,IAAI,CAAC,GAAG,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;oBAEhC,IAAI,CAAC,iBAAiB,EAAE,CAAC;AAC5B,iBAAA;;;AAID,gBAAA,IAAI,IAAI,CAAC,YAAY,CAAC,QAAQ,IAAI,IAAI,CAAC,GAAG,CAAC,MAAM,GAAG,CAAC,EAAE;oBACnD,IAAI,CAAC,iBAAiB,EAAE,CAAC;AAC5B,iBAAA;AAAM,qBAAA;AACH,oBAAA,MAAM,CAAC,IAAI,CAAC,CAAA,qBAAA,CAAuB,CAAC,CAAC;AACxC,iBAAA;AACJ,aAAA;AAED,YAAA,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,YAAY,CAAC;;AAGnC,YAAA,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;AACvB,YAAA,IAAI,CAAC,YAAY,CAAC,QAAQ,GAAG,KAAK,CAAC;AACnC,YAAA,IAAI,CAAC,YAAY,CAAC,UAAU,GAAG,CAAC,CAAC;AACjC,YAAA,IAAI,CAAC,YAAY,CAAC,SAAS,GAAG,CAAC,CAAC;YAChC,IAAI,CAAC,YAAY,CAAC,GAAG,GAAG,UAAU,CAAC,GAAG,CAAC;YACvC,IAAI,CAAC,YAAY,CAAC,GAAG,GAAG,UAAU,CAAC,GAAG,CAAC;AAC1C,SAAA;AAAM,aAAA;AACH,YAAA,IAAI,UAAU,CAAC,SAAS,KAAA,CAAA,4BAA0B;AAC9C,gBAAA,IAAI,CAAC,YAAY,CAAC,QAAQ,GAAG,IAAI,CAAC;AACrC,aAAA;YAED,IAAI,CAAC,YAAY,CAAC,UAAU,IAAI,UAAU,CAAC,OAAO,CAAC,UAAU,CAAC;AAC9D,YAAA,IAAI,CAAC,YAAY,CAAC,SAAS,EAAE,CAAC;AAC9B,YAAA,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;AACtC,SAAA;AAED,QAAA,IAAI,CAAC,YAAY,CAAC,QAAQ,GAAG,UAAU,CAAC,GAAG,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC;KACvE;IAED,OAAO,GAAA;AACH,QAAA,IAAI,CAAC,GAAG,GAAG,EAAE,CAAC;AAEd,QAAA,IAAI,CAAC,GAAG,CAAC,QAAQ,GAAG,CAAC,CAAC;AACtB,QAAA,IAAI,CAAC,GAAG,CAAC,SAAS,GAAG,CAAC,CAAC;AACvB,QAAA,IAAI,CAAC,GAAG,CAAC,UAAU,GAAG,CAAC,CAAC;KAC3B;IAED,iBAAiB,GAAA;;QAEb,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QACjC,IAAI,CAAC,GAAG,CAAC,QAAQ,IAAI,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC;QAChD,IAAI,CAAC,GAAG,CAAC,UAAU,IAAI,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC;QACpD,IAAI,CAAC,GAAG,CAAC,SAAS,IAAI,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC;KACrD;IAED,QAAQ,GAAA;AACJ,QAAA,IAAI,CAAC,IAAI,GAAG,EAAE,CAAC;AACf,QAAA,IAAI,CAAC,IAAI,CAAC,IAAI,GAAG,OAAO,CAAC;AACzB,QAAA,IAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,CAAC,CAAC;AACvB,QAAA,IAAI,CAAC,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC;AACxB,QAAA,IAAI,CAAC,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC;AACzB,QAAA,IAAI,CAAC,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC;AAC1B,QAAA,IAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,CAAC,CAAC;KAC1B;IAED,iBAAiB,GAAA;QACb,IAAI,UAAU,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;;QAE7B,IAAI,CAAC,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;QACjC,IAAI,CAAC,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC;QACxC,IAAI,CAAC,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC;QAC5C,IAAI,CAAC,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC;QAC1C,IAAI,CAAC,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC;QACzC,IAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,UAAU,CAAC,GAAG,CAAC;QACpC,IAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,UAAU,CAAC,GAAG,CAAC;QAEpC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAEzB,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;QAE7B,IAAI,CAAC,OAAO,EAAE,CAAC;QACf,IAAI,CAAC,QAAQ,EAAE,CAAC;AAEhB,QAAA,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;KACrB;AACJ;;AC5MD;;;;AAIG;AAkBH,MAAM,gBAAiB,SAAQ,MAAM,CAAA;AACzB,IAAA,OAAO,CAAU;AACjB,IAAA,GAAG,CAAM;AACT,IAAA,OAAO,CAAgB;AACvB,IAAA,MAAM,CAAmB;AACzB,IAAA,UAAU,CAAa;AACvB,IAAA,SAAS,CAAY;AACrB,IAAA,OAAO,CAA0B;AAEzC,IAAA,WAAA,CAAY,GAAY,EAAE,GAAQ,EAAE,UAAyB,EAAE,EAAA;AAC3D,QAAA,KAAK,EAAE,CAAC;AAER,QAAA,IAAI,CAAC,OAAO,GAAG,GAAG,CAAC;AACnB,QAAA,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;AACf,QAAA,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;AACvB,QAAA,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC;QACjB,IAAI,CAAC,UAAU,GAAG,IAAI,UAAU,CAAC,GAAG,CAAC,CAAC;QACtC,IAAI,CAAC,SAAS,GAAG,IAAIE,UAAS,CAAC,GAAG,CAAC,CAAC;AACpC,QAAA,IAAI,CAAC,OAAO,GAAG,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;QAEjD,IAAI,OAAO,CAAC,WAAW,EAAE;YACrB,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,EAAE,CAAC,IAAe,KAAI;AAC1C,gBAAA,IAAI,QAAQ,GAAG,OAAO,CAAC,MAAM,CAAC,QAAQ,CAAC;AAEvC,gBAAA,IAAI,QAAQ,CAAC,QAAQ,CAAC,EAAE;AACpB,oBAAA,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,IAAI,KAAK,CAAC;oBAClD,IAAI,GAAG,GAAG,QAAQ,EAAE;AAChB,wBAAA,MAAM,CAAC,IAAI,CAAC,CAAA,iCAAA,EAAoC,IAAI,CAAC,QAAQ,CAAA,CAAA,EAAI,GAAG,CAAA,CAAA,EAAI,QAAQ,CAAA,CAAA,CAAG,CAAC,CAAC;wBACrF,OAAO;AACV,qBAAA;AACJ,iBAAA;AAED,gBAAA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACvB,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;AAC/B,gBAAA,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC;AACjB,gBAAA,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE,CAAC;AAC5B,aAAC,CAAC,CAAC;YAEH,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,MAAM,EAAE,CAAC,IAAI,KAAI;AAChC,gBAAA,IAAI,QAAQ,GAAG,OAAO,CAAC,MAAM,CAAC,QAAQ,CAAC;AAEvC,gBAAA,IAAI,QAAQ,CAAC,QAAQ,CAAC,EAAE;AACpB,oBAAA,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,IAAI,KAAK,CAAC;oBAClD,IAAI,GAAG,GAAG,QAAQ,EAAE;AAChB,wBAAA,MAAM,CAAC,IAAI,CAAC,CAAA,8BAAA,EAAiC,IAAI,CAAC,QAAQ,CAAA,CAAA,EAAI,GAAG,CAAA,CAAA,EAAI,QAAQ,CAAA,CAAA,CAAG,CAAC,CAAC;wBAClF,OAAO;AACV,qBAAA;AACJ,iBAAA;AAED,gBAAA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACvB,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;AAC/B,gBAAA,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC;AACrB,aAAC,CAAC,CAAC;AACN,SAAA;KACJ;AAED;;;AAGG;AACH,IAAA,IAAI,CAAC,IAAuB,EAAA;QACxB,MAAM,EAAE,OAAO,EAAE,UAAU,EAAE,SAAS,EAAE,GAAG,IAAI,CAAC;AAChD,QAAA,IAAI,EAAE,WAAW,EAAE,GAAG,IAAI,CAAC;QAE3B,IAAI,OAAO,CAAC,WAAW,EAAE;AACrB,YAAA,QAAQ,WAAW;gBACf,KAAsB,EAAA,wBAAA;AACtB,gBAAA,KAAA,EAAA;AACI,oBAAA,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;oBACrB,MAAM;AACV,gBAAA,KAAA,EAAA;AACI,oBAAA,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;oBACtB,MAAM;AACV,gBAAA;AACI,oBAAA,MAAM,CAAC,IAAI,CAAC,+CAA+C,WAAW,CAAA,CAAE,CAAC,CAAC;AACjF,aAAA;AACJ,SAAA;AAAM,aAAA;AACH,YAAA,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;AAC3B,SAAA;KACJ;IAED,KAAK,GAAA;AACD,QAAA,IAAI,EAAE,OAAO,EAAE,MAAM,EAAE,GAAG,IAAI,CAAC;AAC/B,QAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AAC1C,YAAA,IAAI,MAAM,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;YAExB,MAAM,CAAC,KAAK,EAAE,CAAC;AAClB,SAAA;AAED,QAAA,IAAI,MAAM,CAAC,MAAM,GAAG,CAAC,EAAE;AACnB,YAAA,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;AAC7B,SAAA;AAED,QAAA,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAElB,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC;KACnC;IAED,KAAK,GAAA;AACD,QAAA,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC;AAEjB,QAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YAC1C,IAAI,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;YAE7B,MAAM,CAAC,KAAK,EAAE,CAAC;AAClB,SAAA;AAED,QAAA,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;KACtB;AACJ;;ACnID;;;;AAIG;AAEH;;AAEG;MACU,GAAG,CAAA;;;;;;;;;;;;AAYZ,IAAA,GAAG,CAAS;AACZ,IAAA,GAAG,CAAS;AACZ,IAAA,SAAS,CAAa;AAEtB,IAAA,WAAA,CAAY,MAAkB,EAAA;;;;;;;;;;;;;QAkB1B,IAAI,aAAa,GAAG,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;;;;;;;;;AAgBnC,QAAA,IAAI,kBAAkB,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;AAEnC,QAAA,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC;AACb,QAAA,IAAI,CAAC,aAAa,GAAG,IAAI,KAAK,IAAI,EAAE;YAChC,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;AAC7C,SAAA;;;AAID,QAAA,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC;AAEpB,QAAA,IAAI,CAAC,aAAa,GAAG,IAAI,KAAK,IAAI,EAAE;YAChC,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,cAAc,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;AAC9C,SAAA;;;;;;;;;;;;;;QAgBD,IAAI,CAAC,SAAS,GAAG,MAAM,CAAC,QAAQ,CAAC,CAAC,GAAG,kBAAkB,CAAC,CAAC;;KAG5D;AAED;;;AAGG;IACK,cAAc,CAAC,MAAkB,EAAE,KAAa,EAAA;;QAEpD;;;QAGI,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,IAAI,IAAI,SAAS;aACjC,MAAM,CAAC,KAAK,GAAG,CAAC,CAAC,IAAI,EAAE,CAAC;AACzB,aAAC,CAAC,MAAM,CAAC,KAAK,GAAG,CAAC,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;aAC/B,MAAM,CAAC,KAAK,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC;aACvB,MAAM,CAAC,KAAK,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,EAC1B;KACL;AAWJ;;ACvHD;;;;AAIG;AAaH,MAAM,SAAU,SAAQ,MAAM,CAAA;AAClB,IAAA,OAAO,CAAU;AACjB,IAAA,GAAG,CAAM;AACT,IAAA,GAAG,CAAU;AACb,IAAA,YAAY,CAAc;IAElC,WAAY,CAAA,GAAY,EAAE,GAAQ,EAAA;AAC9B,QAAA,KAAK,EAAE,CAAC;AAER,QAAA,IAAI,CAAC,OAAO,GAAG,GAAG,CAAC;AACnB,QAAA,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;AACf,QAAA,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC;AAChB,QAAA,IAAI,CAAC,YAAY,GAAG,IAAI,WAAW,EAAE,CAAC;KACzC;AAED;;AAEG;AACH,IAAA,IAAI,CAAC,MAAc,EAAA;QACf,MAAM,IAAI,GAAG,IAAI,CAAC;;;;QAKlB,IAAI,MAAM,CAAC,GAAG,GAAG,MAAM,IAAI,MAAM,CAAC,GAAG,GAAG,MAAM,EAAE;YAC5C,IAAI,IAAI,CAAC,GAAG,CAAC,iBAAiB,IAAI,CAAC,CAAC,EAAE;AAClC,gBAAA,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;AAC5B,aAAA;iBAAM,IAAI,IAAI,CAAC,GAAG,CAAC,iBAAiB,KAAK,MAAM,CAAC,GAAG,EAAE;AAClD,gBAAA,IAAI,MAAM,CAAC,4BAA4B,KAAK,CAAC,EAAE;oBAC3C,IAAI,CAAC,eAAe,EAAE,CAAC;AAC1B,iBAAA;AAED,gBAAA,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;AAC5B,aAAA;AACJ,SAAA;KACJ;IAED,KAAK,GAAA;QACD,MAAM,IAAI,GAAG,IAAI,CAAC;;QAGlB,IAAI,CAAC,eAAe,EAAE,CAAC;AAEvB,QAAA,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;KACrB;IAED,KAAK,GAAA;QACD,IAAI,CAAC,YAAY,EAAE,CAAC;AAEpB,QAAA,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;KACtB;IAED,YAAY,GAAA;AACR,QAAA,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC;AAChB,QAAA,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE,CAAC;KAC7B;AAED,IAAA,WAAW,CAAC,CAAC,EAAA;AACT,QAAA,IAAI,KAAK,GAAG,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC;;AAGpC,QAAA,IAAI,KAAK,IAAI,CAAC,CAAC,4BAA4B,KAAK,CAAC,EAAE;YAC/C,OAAO;AACV,SAAA;AAED,QAAA,IAAI,KAAK,EAAE;AACP,YAAA,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,CAAC;AACpB,SAAA;QAED,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC;KACvC;IAED,eAAe,GAAA;QACX,MAAM,IAAI,GAAG,IAAI,CAAC;AAElB,QAAA,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE;AAC1B,YAAA,IAAI,KAAK,CAAC;YAEV,IAAI;AACA,gBAAA,KAAK,GAAG,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,CAAC;AAC1C,aAAA;AAAC,YAAA,OAAO,CAAC,EAAE;AACR,gBAAA,MAAM,qBAAqB,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,CAAC;AAC7D,aAAA;AAED,YAAA,IAAI,OAAO,GAAG,IAAI,GAAG,CAAC,KAAK,CAAC,CAAC;AAC7B,YAAA,IAAI,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;;AAIzC,YAAA,IAAI,KAAK,EAAE;AACP,gBAAA,IAAI,IAAI,GAAsB;oBAC1B,GAAG,EAAE,KAAK,CAAC,EAAE;oBACb,WAAW,EAAE,KAAK,CAAC,WAAW;;AAE9B,oBAAA,GAAG,EAAE,OAAO;iBACf,CAAC;;AAEF,gBAAA,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;AAC3B,aAAA;YAED,IAAI,CAAC,YAAY,EAAE,CAAC;AACvB,SAAA;KACJ;AACJ;;ACxHD;;;;AAIG;AAEH,MAAM,SAAS,GAAG,IAAI,CAAC;AAEvB;;AAEG;MACU,MAAM,CAAA;AACf,IAAA,SAAS,CAAS;;AAElB,IAAA,4BAA4B,CAAS;;AAErC,IAAA,GAAG,CAAS;;AAEZ,IAAA,GAAG,CAAS;;AAEZ,IAAA,WAAW,CAAS;AACpB,IAAA,cAAc,CAAS;;AAEvB,IAAA,OAAO,CAAa;AAEpB;;AAEG;AACH,IAAA,WAAA,CAAY,MAAkB,EAAA;AAC1B,QAAA,IAAI,CAAC,SAAS,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;;;;;AAO3B,QAAA,IAAI,CAAC,4BAA4B,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;QAoCzD,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,MAAM,CAAC,CAAC,CAAC,IAAI,MAAM,CAAC;;;;;;;;;AAWnD,QAAA,IAAI,CAAC,GAAG,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;;;;QAMhC,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC;QAChC,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC;;;QAInC,IAAI,IAAI,CAAC,WAAW,EAAE;YAClB,IAAI,IAAI,CAAC,cAAc,EAAE;AACrB,gBAAA,IAAI,uBAAuB,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;gBACxC,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC,QAAQ,CAAC,CAAC,GAAG,uBAAuB,CAAC,CAAC;AAC/D,aAAA;AAAM,iBAAA;gBACH,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;AACrC,aAAA;AACJ,SAAA;KACJ;IAED,KAAK,GAAA;QACD,OAAO,IAAI,CAAC,SAAS,KAAK,SAAS,IAAI,IAAI,CAAC,WAAW,KAAK,CAAC,CAAC;KACjE;AACJ;;AC3GD;;;;AAIG;AAeH,MAAM,iBAAiB,GAAG,GAAG,CAAC;AAIxB,MAAO,OAAQ,SAAQ,WAAW,CAAA;AAC5B,IAAA,IAAI,CAAM;AACV,IAAA,UAAU,CAAY;AACtB,IAAA,iBAAiB,CAAmB;AACpC,IAAA,cAAc,CAAoB;AAE1C,IAAA,WAAA,CAAY,UAAyB,EAAE,EAAA;QACnC,KAAK,CAAC,OAAO,CAAC,CAAC;AAEf,QAAA,IAAI,CAAC,IAAI,GAAG,IAAI,GAAG,EAAE,CAAC;AACtB,QAAA,IAAI,CAAC,UAAU,GAAG,IAAI,SAAS,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;AACtD,QAAA,IAAI,CAAC,iBAAiB,GAAG,IAAI,gBAAgB,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;AAC7E,QAAA,IAAI,CAAC,cAAc,GAAG,IAAI,iBAAiB,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;;AAGlE,QAAA,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QAC3B,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;QAC7C,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QAEjD,KAAK,CAAC,gBAAgB,EAAE,CAAC;KAC5B;AAED;;AAEG;AACH,IAAA,IAAI,SAAS,GAAA;AACT,QAAA,IAAI,MAAM,GAAoB,IAAI,CAAC,iBAAiB,CAAC;AAErD,QAAA,IAAI,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE;AAC3B,YAAA,MAAM,GAAG,IAAI,CAAC,cAAc,CAAC;AAChC,SAAA;AAED,QAAA,OAAO,MAAM,CAAC;KACjB;AAED;;;;;AAKG;AACH,IAAA,IAAI,CAAC,MAAgC,EAAE,IAAA,GAAiB,EAAE,EAAA;AACtD,QAAA,MAAM,EAAE,IAAI,EAAE,GAAG,IAAI,CAAC;QACtB,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,aAAa,EAAE,IAAI,EAAE,GAAG,IAAI,CAAC;QACrD,IAAI,MAAM,GAAe,KAAK,CAAC,mBAAmB,CAAC,MAAM,CAAC,CAAC;AAC3D,QAAA,IAAI,eAAe,GAAG,aAAa,CAAC,UAAU,CAAC;QAC/C,IAAI,UAAU,GAAG,IAAI,CAAC;AAEtB,QAAA,QAAQ,CAAC,MAAM,GAAG,IAAI,CAAC;QAEvB,MAAM,CAAC,GAAG,CACN,CAAA,mBAAA,EAAsB,MAAM,CAAC,UAAU,iBAAiB,eAAe,CAAA,QAAA,EAAW,IAAI,GAAG,YAAY,GAAG,EAAE,CAAE,CAAA,CAC/G,CAAC;AAEF,QAAA,aAAa,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;AAE7B,QAAA,OAAO,aAAa,CAAC,UAAU,IAAI,iBAAiB,EAAE;YAClD,IAAI,KAAK,GAAG,aAAa,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC;;AAGjD,YAAA,IAAI,KAAK,EAAE;AACP,gBAAA,IAAI,MAAM,GAAG,IAAI,MAAM,CAAC,KAAK,CAAC,CAAC;AAE/B,gBAAA,IAAI,MAAM,CAAC,KAAK,EAAE,EAAE;AAChB,oBAAA,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;AAEnB,oBAAA,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;AAC7B,iBAAA;AAAM,qBAAA;AACH,oBAAA,IAAI,MAAM,GAAG,CAAA,2CAAA,EAA8C,KAAK,CAAC,MAAM,mBAAmB,IAAI,CAAC,aAAa,CAAC,UAAU,kBAAkB,MAAM,CAAC,WAAW,CAAW,QAAA,EAAA,KAAK,GAAG,CAAC;AAE/K,oBAAA,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;oBAErB,IAAI,CAAC,KAAK,EAAE,CAAC;oBAEb,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,YAAY,CAAC,YAAY,EAAE,MAAM,EAAE;AAClD,wBAAA,SAAS,EAAE,UAAU;AACrB,wBAAA,OAAO,EAAE,UAAU,GAAG,KAAK,CAAC,UAAU;AACzC,qBAAA,CAAC,CAAC;oBACH,MAAM;AACT,iBAAA;AAED,gBAAA,UAAU,IAAI,KAAK,CAAC,UAAU,CAAC;AAClC,aAAA;AACJ,SAAA;AAED,QAAA,IAAI,aAAa,CAAC,KAAK,IAAI,IAAI,EAAE;;AAE7B,YAAA,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;AACrB,SAAA;KACJ;IAED,KAAK,GAAA;AACD,QAAA,IAAI,CAAC,aAAa,CAAC,KAAK,EAAE,CAAC;AAE3B,QAAA,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;KACtB;AACJ;;;;"}